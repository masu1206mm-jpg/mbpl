<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>えむびーてぃーあいPlus</title>
  <meta name="description" content="えむびーてぃーあいPlus｜思考パターンを100問で詳細化する診断" />

  <style>
    :root{
      --bg0:#0b1020;
      --bg1:#0a0f1d;
      --card: rgba(255,255,255,.08);
      --card2: rgba(255,255,255,.12);
      --stroke: rgba(255,255,255,.14);
      --stroke2: rgba(255,255,255,.20);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.70);
      --muted2: rgba(255,255,255,.58);

      --accent:#bda6ff;
      --accent2:#6ef2ff;
      --accent3:#ff7ca7;

      --shadow: 0 18px 60px rgba(0,0,0,.45);
      --r: 22px;
      --r2: 16px;
      --max: 980px;
    }

    *{ box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Hiragino Sans", "Noto Sans JP", Arial;
      color: var(--text);
      background:
        radial-gradient(1100px 680px at 16% 8%, rgba(189,166,255,.20), transparent 60%),
        radial-gradient(900px 560px at 86% 12%, rgba(110,242,255,.16), transparent 60%),
        radial-gradient(900px 700px at 50% 105%, rgba(255,124,167,.10), transparent 60%),
        linear-gradient(180deg, var(--bg1) 0%, var(--bg0) 50%, var(--bg1) 100%);
      padding: 16px;
      padding-bottom: 44px;
    }

    .wrap{ max-width:var(--max); margin:0 auto; }

    /* ===== Top ===== */
    .top{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 12px;
      margin-top: 6px;
      margin-bottom: 12px;
    }
    .brand{ display:flex; flex-direction:column; gap:8px; }
    .brandRow{ display:flex; align-items:center; gap:10px; }
    .appIcon{
      width:40px; height:40px; border-radius: 14px;
      background: linear-gradient(135deg, rgba(189,166,255,.95), rgba(110,242,255,.80));
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
      border:1px solid rgba(255,255,255,.22);
      display:grid; place-items:center;
      color:#0b1020;
      font-weight: 1000;
      user-select:none;
    }
    .title{
      margin:0;
      font-weight: 1000;
      line-height: 1.10;
      font-size: clamp(20px, 3.6vw, 34px);
      background: linear-gradient(90deg, var(--accent3), var(--accent), var(--accent2));
      -webkit-background-clip:text;
      background-clip:text;
      color: transparent;
      letter-spacing: .01em;
    }
    .subtitle{
      margin:0;
      font-size: 13px;
      color: var(--muted);
      line-height: 1.55;
      max-width: 54ch;
    }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      padding: 9px 10px;
      border-radius: 999px;
      font-size: 12px;
      color: var(--muted);
      user-select:none;
      backdrop-filter: blur(10px);
      white-space:nowrap;
    }
    .pillDot{
      width:7px; height:7px; border-radius:99px;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      box-shadow: 0 0 0 3px rgba(189,166,255,.12);
      flex: 0 0 auto;
    }

    /* ===== Card ===== */
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      border:1px solid var(--stroke);
      border-radius: var(--r);
      box-shadow: var(--shadow);
      overflow:hidden;
      backdrop-filter: blur(12px);
    }
    .cardHead{
      padding: 14px 14px 12px;
      border-bottom:1px solid rgba(255,255,255,.10);
      display:flex; align-items:center; justify-content:space-between; gap:12px;
    }
    .progressWrap{ display:flex; flex-direction:column; gap:8px; width:100%; }
    .metaRow{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      color: var(--muted);
      font-size: 12px;
    }
    .metaLeft{ display:flex; align-items:center; gap:10px; }
    .chip{
      display:inline-flex; align-items:center; gap:6px;
      padding: 6px 10px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.78);
      font-size: 12px;
      user-select:none;
    }
    .bar{
      height: 11px;
      border-radius: 999px;
      background: rgba(255,255,255,.08);
      overflow:hidden;
      border: 1px solid rgba(255,255,255,.12);
    }
    .bar > div{
      height: 100%;
      width: 0%;
      border-radius: 999px;
      background: linear-gradient(90deg, rgba(189,166,255,.95), rgba(110,242,255,.95));
      transition: width .22s ease;
    }
    .content{ padding: 14px; }

    /* ===== Intro ===== */
    .hero{
      display:flex; flex-direction:column; gap:10px;
      padding: 12px;
      border-radius: var(--r2);
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
    }
    .q{
      font-size: clamp(16px, 2.9vw, 20px);
      line-height: 1.55;
      font-weight: 950;
      margin:0;
      letter-spacing: .01em;
    }
    .sub{
      margin:0;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.6;
    }

    .grid2{ display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-top:12px; }
    @media (max-width: 760px){ .grid2{ grid-template-columns:1fr; } }

    .panel{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      border-radius: 16px;
      padding: 12px;
    }
    .panel h3{
      margin:0 0 8px 0;
      font-size: 14px;
      letter-spacing:.02em;
      color: rgba(255,255,255,.90);
    }
    .panel p, .panel li{
      color: var(--muted);
      font-size: 13px;
      line-height: 1.6;
    }
    .panel ul{ margin: 8px 0 0 18px; padding:0; }
    .note{
      margin-top:8px;
      font-size: 11px;
      color: rgba(255,255,255,.55);
      line-height: 1.55;
    }

    /* ===== Buttons ===== */
    .controls{
      margin-top: 14px;
      display:flex; flex-wrap:wrap; gap:10px;
      justify-content:space-between;
      align-items:center;
    }
    .smallBtns{ display:flex; gap:10px; flex-wrap:wrap; }

    .ghost{
      padding: 11px 12px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.72);
      cursor:pointer;
      font-size: 13px;
    }
    .primary{
      padding: 12px 14px;
      border-radius: 999px;
      border: none;
      background: linear-gradient(90deg, rgba(189,166,255,.95), rgba(110,242,255,.95));
      color: #0b1020;
      font-weight: 1000;
      cursor:pointer;
      font-size: 13px;
      min-width: 160px;
      text-align:center;
    }

    /* ===== Quiz ===== */
    .choices{ display:grid; grid-template-columns:1fr; gap:10px; margin-top: 10px; }
    .btn{
      width:100%;
      padding: 14px 14px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.07);
      color: var(--text);
      text-align:left;
      font-size: 16px;
      line-height: 1.3;
      cursor:pointer;
      display:flex; align-items:flex-start; gap:10px;
    }
    .tag{
      font-size: 12px;
      color: rgba(255,255,255,.82);
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.06);
      padding: 3px 8px;
      border-radius: 999px;
      margin-top: 2px;
      flex: 0 0 auto;
      user-select:none;
    }
    .btnText{ flex:1; }
    .help{
      margin-top: 10px;
      color: var(--muted2);
      font-size: 12px;
      line-height: 1.55;
      padding: 10px 12px;
      border-radius: 14px;
      border:1px dashed rgba(255,255,255,.14);
      background: rgba(255,255,255,.04);
    }

    /* ===== Result ===== */
    .resultTitle{
      font-size: clamp(20px, 4vw, 34px);
      font-weight: 1000;
      margin: 4px 0 10px;
      line-height: 1.12;
      background: linear-gradient(90deg, var(--accent3), var(--accent), var(--accent2));
      -webkit-background-clip:text;
      background-clip:text;
      color: transparent;
      letter-spacing:.01em;
    }
    .badgeRow{ display:flex; flex-wrap:wrap; gap:8px; margin: 6px 0 12px; }
    .badge{
      display:inline-flex; align-items:center; gap:8px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.07);
      padding: 7px 10px;
      border-radius: 999px;
      font-size: 12px;
      color: rgba(255,255,255,.82);
      user-select:none;
    }

    .hide{ display:none !important; }

    .toast{
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%);
      background: rgba(0,0,0,.78);
      color: rgba(255,255,255,.92);
      border: 1px solid rgba(255,255,255,.18);
      border-radius: 999px;
      padding: 10px 14px;
      font-size: 12px;
      opacity: 0;
      pointer-events: none;
      transition: opacity .18s ease, transform .18s ease;
      backdrop-filter: blur(10px);
      z-index: 50;
      box-shadow: 0 10px 40px rgba(0,0,0,.35);
    }
    .toast.show{
      opacity: 1;
      transform: translateX(-50%) translateY(-4px);
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <div class="brand">
        <div class="brandRow">
          <div class="appIcon">＋</div>
          <h1 class="title">えむびーてぃーあいPlus</h1>
        </div>
        <p class="subtitle">
          えむびーてぃーあいPlusは、とある診断を強化・拡張した診断です。<br>
          高性能AIと研究結果をもとに、あなたの思考パターンを100問で詳細化します。
        </p>
      </div>

      <div class="pill">
        <span class="pillDot"></span>
        スマホ最適化 / 途中保存対応
      </div>
    </div>

    <div class="card" id="app">
      <div class="cardHead">
        <div class="progressWrap">
          <div class="metaRow">
            <div class="metaLeft">
              <div id="stepText">準備中…</div>
              <span class="chip"><span>💾</span><span id="saveText">保存: ON</span></span>
            </div>
            <div class="chip"><span>🧠</span>3択 × 100問</div>
          </div>
          <div class="bar"><div id="barFill"></div></div>
        </div>
      </div>

      <!-- Intro -->
      <div class="content" id="screenIntro">
        <div class="hero">
          <p class="q">診断開始前に：すべて「自分が主人公」として想像して、直感で選んでください。</p>
          <p class="sub">迷った場合は「中立」でOK。背伸びせず、普段の自分に近い方を選んでください。</p>
        </div>

        <div class="grid2">
          <div class="panel">
            <h3>✅ 回答形式（3択）</h3>
            <ul>
              <li><b>否定</b>：しない／避ける／言わない</li>
              <li><b>中立</b>：状況次第／様子を見る／相談する</li>
              <li><b>肯定</b>：する／向き合う／言う</li>
            </ul>
          </div>

          <div class="panel">
            <h3>📌 この診断の狙い</h3>
            <p>
              「性格＝気分」じゃなく、緊急時・対人・判断が必要な場面で出る
              “反応パターン”を拾います。
            </p>
            <div class="note">
              ※娯楽目的です。医療・心理の専門的判断の代替にはなりません。
            </div>
          </div>
        </div>

        <div class="controls">
          <div class="smallBtns">
            <button class="ghost" id="resetAll">最初から（データ削除）</button>
          </div>
          <button class="primary" id="startBtn">診断を開始する（100問）</button>
        </div>
      </div>

      <!-- Quiz -->
      <div class="content hide" id="screenQuiz">
        <p class="q" id="qText">質問</p>

        <div class="choices" id="choices"></div>

        <div class="help" id="helpText">
          迷った場合は「中立」でOK。素直に、普段の自分に近い回答を選んでください。
        </div>

        <div class="controls">
          <div class="smallBtns">
            <button class="ghost" id="backBtn">1つ戻る</button>
            <button class="ghost" id="skipBtn">保留（中立で進む）</button>
          </div>
          <button class="primary" id="toResultBtn">結果を見る</button>
        </div>
      </div>

      <!-- Result -->
      <div class="content hide" id="screenResult">
        <div class="badgeRow" id="badges"></div>
        <div class="resultTitle" id="resultTitle">結果</div>

        <div class="grid2">
          <div class="panel">
            <h3>思考傾向</h3>
            <p id="desc"></p>
          </div>
          <div class="panel">
            <h3>向いている職業</h3>
            <p id="job"></p>
          </div>
          <div class="panel">
            <h3>向いていない職業</h3>
            <p id="love"></p>
          </div>
          <div class="panel">
            <h3>成長するためには</h3>
            <p id="media"></p>
          </div>
        </div>

        <div class="controls">
          <div class="smallBtns">
            <button class="ghost" id="shareBtn">結果テキストをコピー</button>
            <button class="ghost" id="restartBtn">もう一度やる</button>
          </div>
          <button class="primary" id="homeBtn">トップへ</button>
        </div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast">コピーしました</div>

  <!-- ここに PART2 を貼る -->
  <!-- ここに PART3 を貼る -->
</body>
</html>
<script>
/* =========================
   えむびーてぃーあいPlus - PART2
   質問100問 / シャッフル / 保存 / 戻る
========================= */

(function(){

/* =========================
   基本設定
========================= */
const STORAGE_KEY = "mbti_plus_part2";

const $ = (id) => document.getElementById(id);

/* =========================
   質問データ（100問）
========================= */

/*
  cat:
  SNS   = SNS・承認欲求界隈
  GLAM  = 夜職・盛り・自己価値界隈
  GACHI = メガネ真面目くん界隈
  LOVE  = 恋愛至上主義界隈
  KAGE  = 自分を持ってるインキャラ界隈
*/

const QUESTIONS_RAW = [

/* ===== SNS界隈 1-20 ===== */
{cat:"SNS", q:"バズっている投稿を見ると、いいね数やコメント数を必ず確認する", a:"ほぼ見ない", b:"たまに見る", c:"必ずチェックする"},
{cat:"SNS", q:"自分の投稿の反応が少ないと少し落ち込む", a:"全く気にならない", b:"少し気になる", c:"かなり気になる"},
{cat:"SNS", q:"ストーリーを上げた後、誰が見たか確認する", a:"確認しない", b:"たまに確認", c:"必ず確認"},
{cat:"SNS", q:"友達の投稿が伸びていると理由を考える", a:"考えない", b:"少し考える", c:"分析する"},
{cat:"SNS", q:"SNSでの自分の立ち位置を意識している", a:"意識しない", b:"たまに意識", c:"常に意識"},
{cat:"SNS", q:"炎上している話題を最初から追ってしまう", a:"追わない", b:"気になる時だけ", c:"最後まで追う"},
{cat:"SNS", q:"フォロワー数で人の影響力を判断してしまう", a:"しない", b:"少しある", c:"よくある"},
{cat:"SNS", q:"投稿する時間帯を気にする", a:"気にしない", b:"たまに", c:"かなり気にする"},
{cat:"SNS", q:"SNSで承認されていないと不安になる", a:"ならない", b:"少しなる", c:"よくなる"},
{cat:"SNS", q:"他人の投稿に無意識で比較してしまう", a:"しない", b:"たまに", c:"よくする"},
{cat:"SNS", q:"バズっている理由を考えるのが好きだ", a:"興味ない", b:"少し好き", c:"かなり好き"},
{cat:"SNS", q:"自分の発言がどう受け取られるか気になる", a:"気にしない", b:"少し気にする", c:"かなり気にする"},
{cat:"SNS", q:"SNSの数字は自分の評価だと感じる", a:"思わない", b:"少し思う", c:"強く思う"},
{cat:"SNS", q:"裏垢やコメント欄で意見を書くことがある", a:"ほぼない", b:"たまにある", c:"よくある"},
{cat:"SNS", q:"他人の炎上を見て学ぼうとする", a:"しない", b:"少しする", c:"かなりする"},
{cat:"SNS", q:"自分の投稿を何度も見返す", a:"見返さない", b:"1回は見る", c:"何度も見る"},
{cat:"SNS", q:"いいね数が少ないと投稿を消したくなる", a:"ならない", b:"少し思う", c:"消したくなる"},
{cat:"SNS", q:"自撮りを投稿することがある", a:"ほぼない", b:"たまに", c:"よくある"},
{cat:"SNS", q:"SNSがないと情報に遅れると感じる", a:"感じない", b:"少し感じる", c:"かなり感じる"},
{cat:"SNS", q:"SNSはいかに反応を取るかが重要だ", a:"思わない", b:"まあ思う", c:"強く思う"},

/* ===== GLAM界隈 21-40 ===== */
{cat:"GLAM", q:"見た目は努力でどうにかなると思う", a:"思わない", b:"半分思う", c:"強く思う"},
{cat:"GLAM", q:"第一印象で損したくない", a:"気にしない", b:"少し気にする", c:"絶対損したくない"},
{cat:"GLAM", q:"ナメられたと感じると強く反発したくなる", a:"ならない", b:"少しなる", c:"かなりなる"},
{cat:"GLAM", q:"可愛い・かっこいいと言われると自信が出る", a:"変わらない", b:"少し出る", c:"かなり出る"},
{cat:"GLAM", q:"自分を安売りしても欲しいものがある", a:"ない", b:"場合による", c:"ある"},
{cat:"GLAM", q:"整形は努力だと思う", a:"思わない", b:"場合による", c:"思う"},
{cat:"GLAM", q:"プライドは高い方だ", a:"低い", b:"普通", c:"高い"},
{cat:"GLAM", q:"他人にどう見られているか常に気になる", a:"気にならない", b:"たまに", c:"常に"},
{cat:"GLAM", q:"ブランドや肩書きに価値を感じる", a:"感じない", b:"少し感じる", c:"強く感じる"},
{cat:"GLAM", q:"自分より下だと感じる人を見ると安心する", a:"しない", b:"少しある", c:"ある"},
{cat:"GLAM", q:"見た目にお金をかけるのは正解だと思う", a:"思わない", b:"まあ思う", c:"思う"},
{cat:"GLAM", q:"異性に舐められたくない気持ちが強い", a:"弱い", b:"普通", c:"強い"},
{cat:"GLAM", q:"外見で評価される世界は残酷だと思う", a:"思わない", b:"少し思う", c:"強く思う"},
{cat:"GLAM", q:"自分を高く見せるのは悪いことじゃない", a:"悪い", b:"場合による", c:"悪くない"},
{cat:"GLAM", q:"お金＝自由だと感じる", a:"思わない", b:"少し思う", c:"強く思う"},
{cat:"GLAM", q:"負け組だと思われたくない", a:"思わない", b:"少し思う", c:"強く思う"},
{cat:"GLAM", q:"自分の価値は環境で決まると思う", a:"思わない", b:"半分思う", c:"思う"},
{cat:"GLAM", q:"強い人間に憧れる", a:"憧れない", b:"少し", c:"かなり"},
{cat:"GLAM", q:"上下関係を意識するタイプだ", a:"しない", b:"少し", c:"かなり"},
{cat:"GLAM", q:"勝ち負けで物事を見てしまう", a:"見ない", b:"たまに", c:"よく見る"},

/* ===== GACHI界隈 41-60 ===== */
{cat:"GACHI", q:"約束の時間は必ず守る", a:"守らない", b:"基本守る", c:"絶対守る"},
{cat:"GACHI", q:"段取りが崩れるとイライラする", a:"しない", b:"少しする", c:"かなりする"},
{cat:"GACHI", q:"ミスをすると原因を考える", a:"考えない", b:"少し考える", c:"徹底的に考える"},
{cat:"GACHI", q:"無責任な人を見ると腹が立つ", a:"立たない", b:"少し立つ", c:"かなり立つ"},
{cat:"GACHI", q:"LINEの誤字脱字が気になる", a:"気にならない", b:"少し", c:"かなり"},
{cat:"GACHI", q:"計画通りに進めたい", a:"気にしない", b:"まあ", c:"強く思う"},
{cat:"GACHI", q:"損得を計算して行動する", a:"しない", b:"少し", c:"かなり"},
{cat:"GACHI", q:"コツコツ積み上げるのが得意だ", a:"苦手", b:"普通", c:"得意"},
{cat:"GACHI", q:"ルールは守るべきだと思う", a:"思わない", b:"場合による", c:"思う"},
{cat:"GACHI", q:"感情より合理性を優先する", a:"しない", b:"半々", c:"する"},
{cat:"GACHI", q:"遅刻する人が苦手だ", a:"気にならない", b:"少し", c:"かなり"},
{cat:"GACHI", q:"先のリスクを考えて動く", a:"考えない", b:"少し", c:"かなり"},
{cat:"GACHI", q:"無駄な出費は避けたい", a:"避けない", b:"少し避ける", c:"かなり避ける"},
{cat:"GACHI", q:"正しいことをしたい気持ちが強い", a:"弱い", b:"普通", c:"強い"},
{cat:"GACHI", q:"責任ある立場を任されることが多い", a:"ない", b:"たまに", c:"よくある"},
{cat:"GACHI", q:"自分に厳しい方だ", a:"甘い", b:"普通", c:"厳しい"},
{cat:"GACHI", q:"再発防止を考える癖がある", a:"ない", b:"少し", c:"かなり"},
{cat:"GACHI", q:"他人のミスが気になる", a:"気にならない", b:"少し", c:"かなり"},
{cat:"GACHI", q:"長期目線で物事を見る", a:"見ない", b:"半々", c:"見る"},
{cat:"GACHI", q:"感情論より理屈が好きだ", a:"好きじゃない", b:"普通", c:"好き"},

/* ===== LOVE界隈 61-80 ===== */
{cat:"LOVE", q:"恋愛は人生に大きく影響する", a:"影響しない", b:"少しする", c:"かなりする"},
{cat:"LOVE", q:"恋人とは一体感を求めたい", a:"求めない", b:"場合による", c:"求めたい"},
{cat:"LOVE", q:"曖昧な関係は不安になる", a:"ならない", b:"少し", c:"かなり"},
{cat:"LOVE", q:"返信速度で愛情を測る", a:"測らない", b:"たまに", c:"測る"},
{cat:"LOVE", q:"恋人の交友関係が気になる", a:"気にならない", b:"少し", c:"かなり"},
{cat:"LOVE", q:"束縛されると愛を感じる", a:"感じない", b:"少し", c:"感じる"},
{cat:"LOVE", q:"相手に依存しやすい", a:"しない", b:"たまに", c:"しやすい"},
{cat:"LOVE", q:"相手の言動に一喜一憂する", a:"しない", b:"少し", c:"かなり"},
{cat:"LOVE", q:"恋人が最優先になりやすい", a:"ならない", b:"たまに", c:"なりやすい"},
{cat:"LOVE", q:"ニコイチの存在になりたい", a:"なりたくない", b:"どちらでも", c:"なりたい"},
{cat:"LOVE", q:"安心感がないと不安になる", a:"ならない", b:"少し", c:"かなり"},
{cat:"LOVE", q:"嫉妬しやすい", a:"しない", b:"たまに", c:"しやすい"},
{cat:"LOVE", q:"恋人の行動を把握したい", a:"したくない", b:"ほどほど", c:"把握したい"},
{cat:"LOVE", q:"恋愛で生活が乱れることがある", a:"ない", b:"たまに", c:"ある"},
{cat:"LOVE", q:"恋人の存在が心の支えだ", a:"そうでもない", b:"まあ", c:"強くそう思う"},
{cat:"LOVE", q:"恋愛に全力になりやすい", a:"ならない", b:"たまに", c:"なりやすい"},
{cat:"LOVE", q:"一人になるのが怖い", a:"怖くない", b:"少し", c:"怖い"},
{cat:"LOVE", q:"恋人の一言で気分が変わる", a:"変わらない", b:"少し", c:"かなり"},
{cat:"LOVE", q:"恋愛がうまくいかないと全てがダメに感じる", a:"感じない", b:"少し", c:"感じる"},
{cat:"LOVE", q:"恋愛は自分を成長させると思う", a:"思わない", b:"少し思う", c:"思う"},

/* ===== KAGE界隈 81-99 ===== */
{cat:"KAGE", q:"一人の時間がないと疲れる", a:"疲れない", b:"少し", c:"かなり"},
{cat:"KAGE", q:"群れるより少人数が楽だ", a:"楽じゃない", b:"半々", c:"楽"},
{cat:"KAGE", q:"学生時代、群れている人が苦手だった", a:"苦手じゃない", b:"少し", c:"苦手"},
{cat:"KAGE", q:"自分の世界を大事にしたい", a:"気にしない", b:"まあ", c:"大事にしたい"},
{cat:"KAGE", q:"無理にテンションを上げたくない", a:"上げる", b:"場合による", c:"上げたくない"},
{cat:"KAGE", q:"静かな場所が落ち着く", a:"落ち着かない", b:"普通", c:"落ち着く"},
{cat:"KAGE", q:"人に踏み込まれすぎるとしんどい", a:"平気", b:"少し", c:"しんどい"},
{cat:"KAGE", q:"自分のペースを乱されたくない", a:"気にしない", b:"少し", c:"乱されたくない"},
{cat:"KAGE", q:"感情をあまり表に出さない", a:"出す", b:"場合による", c:"出さない"},
{cat:"KAGE", q:"深く狭い人間関係が好きだ", a:"広く浅く", b:"半々", c:"深く狭く"},
{cat:"KAGE", q:"空気を読むより距離を取る", a:"空気読む", b:"半々", c:"距離取る"},
{cat:"KAGE", q:"無駄な人間関係を減らしたい", a:"減らしたくない", b:"まあ", c:"減らしたい"},
{cat:"KAGE", q:"一人で考える時間が必要だ", a:"必要ない", b:"たまに", c:"必要"},
{cat:"KAGE", q:"自分の価値観を曲げたくない", a:"曲げられる", b:"場合による", c:"曲げたくない"},
{cat:"KAGE", q:"人付き合いは消耗することが多い", a:"消耗しない", b:"少し", c:"かなり"},
{cat:"KAGE", q:"自分の居場所は少数でいい", a:"そう思わない", b:"少し思う", c:"思う"},
{cat:"KAGE", q:"騒がしい場所は苦手だ", a:"苦手じゃない", b:"少し", c:"苦手"},
{cat:"KAGE", q:"一人でいるときが一番素だ", a:"そうでもない", b:"半々", c:"そう"},
{cat:"KAGE", q:"人と距離を取るのは悪いことじゃない", a:"思わない", b:"少し思う", c:"思う"},

];

/* ===== 100問目（固定） ===== */
const FINAL_QUESTION = {
  q: `最後の質問です。

あなたの目の前に、ひとつのボタンがあります。
そのボタンを渡せば、あなたの大切な友達は1億円を手に入れます。

ただし、あなたはこの世界から消えます。

それでも、このボタンを渡しますか？`,
  a: "渡す",
  b: "渡さない"
};

/* =========================
   シャッフル処理
========================= */
function shuffle(array){
  const arr = array.slice();
  for(let i = arr.length - 1; i > 0; i--){
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

/* =========================
   状態管理
========================= */
let state = {
  order: [],
  idx: 0,
  answers: [],
  scores: {SNS:0, GLAM:0, GACHI:0, LOVE:0, KAGE:0}
};

function save(){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
}
function load(){
  const raw = localStorage.getItem(STORAGE_KEY);
  if(raw){
    state = JSON.parse(raw);
    return true;
  }
  return false;
}

/* =========================
   描画
========================= */
function render(){
  const qEl = $("qText");
  const cEl = $("choices");
  const stepEl = $("stepText");
  const barEl = $("barFill");

  stepEl.textContent = `Q${state.idx + 1} / 100`;
  barEl.style.width = `${(state.idx / 100) * 100}%`;

  cEl.innerHTML = "";

  if(state.idx < 99){
    const q = QUESTIONS[state.order[state.idx]];
    qEl.textContent = q.q;

    [
      {t:"否定", txt:q.a, v:-1},
      {t:"中立", txt:q.b, v:0},
      {t:"肯定", txt:q.c, v:1},
    ].forEach(o=>{
      const btn = document.createElement("button");
      btn.className = "btn";
      btn.innerHTML = `<span class="tag">${o.t}</span><div class="btnText">${o.txt}</div>`;
      btn.onclick = ()=>answer(o.v, q.cat);
      cEl.appendChild(btn);
    });

  }else{
    qEl.textContent = FINAL_QUESTION.q;
    [
      {t:"A", txt:FINAL_QUESTION.a, v:0},
      {t:"B", txt:FINAL_QUESTION.b, v:1},
    ].forEach(o=>{
      const btn = document.createElement("button");
      btn.className = "btn";
      btn.innerHTML = `<span class="tag">${o.t}</span><div class="btnText">${o.txt}</div>`;
      btn.onclick = ()=>finalAnswer(o.v);
      cEl.appendChild(btn);
    });
  }
}

function answer(val, cat){
  state.answers[state.idx] = val;
  state.scores[cat] += val;
  state.idx++;
  save();
  render();
}

function finalAnswer(val){
  state.answers[99] = val;
  save();
  alert("ここからPART3（結果編）へ");
}

/* =========================
   初期化
========================= */
let QUESTIONS = [];

function init(){
  if(!load()){
    state.order = shuffle([...Array(99).keys()]);
    save();
  }
  QUESTIONS = QUESTIONS_RAW;
  render();
}

$("backBtn").onclick = ()=>{
  if(state.idx > 0){
    state.idx--;
    save();
    render();
  }
};

$("skipBtn").onclick = ()=>{
  answer(0, QUESTIONS[state.order[state.idx]].cat);
};

$("startBtn") && $("startBtn").addEventListener("click", ()=>{
  $("screenIntro").classList.add("hide");
  $("screenQuiz").classList.remove("hide");
  init();
});

init();

})();
</script>

<!-- =========================
  (偽)えむびーてぃーあいPlus - PART3
  結果表示・長文解釈パート
========================= -->
<script>
(function(){
  const $ = (id)=>document.getElementById(id);

  // PART2 から渡されるデータ
  const data = window.__MBTI2__;
  if(!data || !data.scores){
    console.warn("PART3: PART2のデータが見つかりません");
    return;
  }

  /* =========================
     界隈定義
  ========================= */
  const AREAS = {
    SNS: {
      name: "SNS・承認欲求界隈",
      desc: "反応・数字・他人の視線に強く影響される思考パターン",
      types: [
        "承認モンスター",
        "数字中毒者",
        "炎上ウォッチャー"
      ]
    },
    GLAM: {
      name: "夜職・盛り・自己価値界隈",
      desc: "格・扱われ方・プライドで世界を判断する思考パターン",
      types: [
        "夜職プライド鬼高ウーマン",
        "ホスト王",
        "面食いハンター"
      ]
    },
    GACHI: {
      name: "メガネ真面目くん界隈",
      desc: "段取り・再現性・責任感を重視する思考パターン",
      types: [
        "ど素直ストレート男",
        "堅実ガチ勢",
        "正論製造機"
      ]
    },
    LOVE: {
      name: "恋愛至上主義界隈",
      desc: "安心・一体感・関係性を最優先する思考パターン",
      types: [
        "恋愛脳モンスター",
        "ニコイチ信者",
        "依存グラビティ人間"
      ]
    },
    KAGE: {
      name: "自分を持ってるインキャラ界隈",
      desc: "距離感・自分軸・静けさを重視する思考パターン",
      types: [
        "チー牛さん",
        "省エネ隠居型",
        "孤高の観察者"
      ]
    }
  };

  /* =========================
     トップ界隈判定
  ========================= */
  const scores = data.scores;
  let topArea = "SNS";
  let max = -Infinity;
  Object.keys(scores).forEach(k=>{
    if(scores[k] > max){
      max = scores[k];
      topArea = k;
    }
  });

  const area = AREAS[topArea];

  /* =========================
     タイプ名（ランダム）
  ========================= */
  const typeName =
    area.types[Math.floor(Math.random()*area.types.length)];

  /* =========================
     最後の質問（100問目）
     0 = 渡す / 1 = 渡さない / null = 沈黙
  ========================= */
  const finalAnswer = data.answers?.[99];

  function finalEssay(ans){
    if(ans === 0){
      return `
【最後の質問について】

ボタンを「渡す」と答えた場合

その「信用」は、ただの押し付けだ。

あなたは、
「あの人なら、絶対にボタンを押さない」
そう信じて、ボタンを渡したのかもしれません。

しかし、それは本当に“信頼”でしょうか。

想像してください。
渡された側の友達は、一生そのボタンを見るたびに、
「これを押せば1億円が手に入る」
という誘惑と戦い続けることになります。

あなたは「信用している」という綺麗な言葉を盾にして、
一番大切な人に、
**一生続く傲慢**をプレゼントしただけではありませんか。

「信じているから渡す」という行為。
それは裏を返せば、
「もし押したら、お前が悪い」
という呪いをかけているのと同じです。

相手を試さずにはいられない。
その傲慢な確認作業を、
あなたは「友情」と呼んでいるのです。

【結論：この問いの正体】

この質問は、
友情の深さを測るためのものではありません。

暴かれているのは、
あなたの **「信用の汚さ」** です。

・渡せば  
　相手に「踏み絵」を踏ませる、傲慢な試練。

・渡さなければ  
　相手の理性を疑う、冷ややかな侮蔑。

どちらを選んでも、
あなたは「1億円」という紙切れ一枚で、
あの人との絆を汚してしまった。

この問いが突きつけているのは、
友情ではなく、
**あなた自身の“人の信じ方”** なのです。


`;
    }

    if(ans === 1){
      return `
【最後の質問について】

ボタンを「渡さない」と答えた場合

あなたは、友人を「見くびっている」。

あなたは「渡さない」を選びました。

「あの人を人殺しにしたくない」
「迷わせたくない」

そうやって、自分を納得させているのかもしれません。
しかし、本当の理由は違いますよね。

あなたは、
あの人が「1億円」という金額に負けて、
あなたを殺してしまう可能性を、
どこかで確信している。

「どうせ渡せば、あいつは迷うだろう」
「もしかしたら、押してしまうかもしれない」

あなたは、
一番大切なはずの友達の人間性を、
たった1億円程度の価値だと見積もっているのです。

渡さなかったのは、優しさではありません。
それは、
**相手の理性を信じられなかった**
あなた自身の、冷徹な「諦め」です。

【結論：この問いの正体】

この質問は、
友情の深さを測るためのものではありません。

暴かれているのは、
あなたの **「信用の汚さ」** です。

・渡せば  
　相手に「踏み絵」を踏ませる、傲慢な試練。

・渡さなければ  
　相手の理性を疑う、冷ややかな侮蔑。

どちらを選んでも、
あなたは「1億円」という紙切れ一枚で、
あの人との絆を汚してしまった。

この問いが突きつけているのは、
友情ではなく、
**あなた自身の“人の信じ方”** なのです。

    }

    return `
【最後の質問について】

【沈黙】あなたはどちらのボタンも選ばなかった。

あるいは、「選ばないこと」を選んだ。

それは迷いではありません。  
**「あの人と1億円を、同じ天秤に載せること自体を拒否した」**  
という、唯一の誠実な回答です。

────────────────────

1. 思考の放棄ではなく、天秤の破壊

「渡す」を選べば相手を試し、  
「渡さない」を選べば相手を疑う。

その汚い二択を突きつけられたとき、  
あなたは静かに、時間が過ぎるのを待った。

それは、1億円という数字が、  
あなたとあの人の間に入り込む余地を  
一切与えなかったということです。

────────────────────

2. 計算を捨てた瞬間に残るもの

「もし渡したら？」「もし押されたら？」

そんな計算を巡らせている間、  
人は相手を“駒”として見ています。

しかし、沈黙したあなたの頭の中にあったのは、  
損得勘定ではなく、  
ただ「友達」そのものだったはずです。

なぜなら、あなたとあの人の絆は、  
ボタン一つで壊れるほど安っぽくないと、  
理解しているからです。

────────────────────

【この問いの正体】

この質問において、用意された二つのボタンは「罠」でした。

・「渡す」は、信頼を盾にした傲慢。  
・「渡さない」は、不信を隠した諦め。

そして、  
あなたの「沈黙」だけが、唯一の正解でした。

人生には2択のようで2択ではない問題が存在します。
人はいつだって、何かを分類し、区別し、ジャンル分けしたがる生き物です。
複雑な人間関係を「MBTI」や「タイプ」という小さな箱に押し込み、ラベルを貼ることで、
わかった気になって安心したいものです。
この診断も、その愚かさの上に成り立っています。
あなたに100の質問を浴びせ、記号へと変換し、どこかの界隈へと閉じ込める。
それは、あなたという個性を剥ぎ取り、記号として処理するだけの残酷な作業です。

沈黙と答えたあなたは、
自分を枠にハメなくていい。
正解を選ぼうとしなくていい。
その不器用で、優しくて、型破りな感性を、どうか一生大切にしてください。





`;
  }

  /* =========================
     結果文章
  ========================= */
  const tendency = `
【思考傾向】
あなたは「${area.name}」に属します。
${area.desc}

物事を感覚ではなく、
自分なりの基準や反応パターンで判断する傾向があります。
`;

  const goodJob = `
【向いている職業】
・${topArea === "SNS" ? "マーケティング / 広報 / 編集" :
  topArea === "GLAM" ? "営業 / PR / 美容・接客" :
  topArea === "GACHI" ? "管理職 / 事務 / 品質管理" :
  topArea === "LOVE" ? "接客 / 教育 / 支援職" :
  "研究 / 制作 / エンジニア"}
`;

  const badJob = `
【向いていない職業】
・評価基準が曖昧な仕事
・感情労働が過剰な環境
・自分の軸を持てない組織
`;

  const grow = `
【成長するために】
・自分の価値を他人の反応で決めない
・関係性を「我慢」で維持しない
・沈黙ではなく言語化を選ぶ
`;

  /* =========================
     画面に流し込む
  ========================= */
  $("resultTitle").textContent =
    `${area.name} / ${typeName}`;

  $("desc").textContent =
    tendency +
    finalEssay(finalAnswer) +
    grow;

  $("job").textContent = goodJob;
  $("love").textContent = badJob;
  $("media").textContent = "（このタイプは人間観察系・考察系コンテンツを好む傾向があります）";

})();
</script>