<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>えむびーてぃーあいPlus | 究極版</title>
  <style>
    :root { --bg: #05070a; --accent-p: #ff7ca7; --accent-v: #bda6ff; --accent-b: #6ef2ff; --text: #ffffff; }
    * { box-sizing: border-box; }
    body { margin: 0; min-height: 100vh; font-family: "Hiragino Kaku Gothic ProN", sans-serif; background: var(--bg); color: var(--text); display: flex; justify-content: center; align-items: center; padding: 15px; overflow-x: hidden; }
    .container { max-width: 600px; width: 100%; transition: 0.5s; }
    .card { background: rgba(255,255,255,0.06); border-radius: 32px; padding: 25px; backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
    .extreme-mode { background: #000 !important; border: 2px solid #ff4477 !important; animation: shake 0.5s infinite; }
    @keyframes shake { 0%, 100% { transform: translate(0,0); } 25% { transform: translate(1px,-1px); } 75% { transform: translate(-1px,1px); } }
    h1 { text-align: center; font-size: 1.5rem; background: linear-gradient(90deg, var(--accent-p), var(--accent-v)); -webkit-background-clip: text; color: transparent; margin-bottom: 20px; font-weight: 900; }
    .progress-bar { height: 4px; background: rgba(255,255,255,0.1); border-radius: 2px; margin: 15px 0; overflow: hidden; }
    .progress-fill { height: 100%; background: var(--accent-b); width: 0%; transition: 0.3s; }
    .question-text { font-size: 1.1rem; font-weight: bold; line-height: 1.6; min-height: 70px; margin-bottom: 25px; text-align: center; }
    .choices { display: grid; gap: 12px; }
    button { padding: 16px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); color: #fff; font-size: 0.95rem; font-weight: bold; cursor: pointer; transition: 0.2s; width: 100%; text-align: left; }
    button:active { transform: scale(0.98); background: rgba(255,255,255,0.1); }
    .timer { font-size: 4rem; text-align: center; color: #ff4477; font-weight: 900; margin-bottom: 10px; font-family: monospace; text-shadow: 0 0 20px #ff4477; }
    .res-area-name { font-size: 1.8rem; font-weight: 900; color: var(--accent-p); text-align:center; margin-bottom: 5px; }
    .res-type-name { font-size: 1rem; color: var(--accent-v); text-align: center; margin-bottom: 20px; font-weight: bold; }
    .section { background: rgba(255,255,255,0.04); border-radius: 20px; padding: 20px; margin-bottom: 15px; border-left: 4px solid var(--accent-v); }
    .sec-title { font-weight: 900; color: var(--accent-v); margin-bottom: 10px; font-size: 0.9rem; }
    .essay-text { line-height: 1.8; font-size: 0.9rem; white-space: pre-wrap; }
    .final-box { background: #111; border: 2px solid #ff4477; padding: 20px; border-radius: 20px; margin-top: 20px; line-height: 1.7; }
    .hide { display: none !important; }
    .sub-btn { background: transparent; border: 1px solid #444; color: #888; padding: 10px; font-size: 0.7rem; margin-top: 20px; border-radius: 12px; text-align: center; width: auto; flex: 1; }
    .highlight-box { background: #222; padding: 15px; border-radius: 12px; border: 1px solid #ff4477; color: #fff; margin: 15px 0; font-weight: bold; }
    .res-char-img { width: 100%; max-width: 240px; border-radius: 20px; margin: 0 auto 20px; display: block; border: 2px solid var(--accent-v); }
  </style>
</head>
<body>

<div class="container">
  <div id="screen-intro" class="card">
    <h1>えむびーてぃーあいPlus</h1>
    <p style="text-align:center; color:#bbb; font-size:0.9rem; line-height:1.6;">
      どこかの診断のような曖昧で無駄な5択質問を取り除き<br>
      具体化されたよりわかりやすい3択×100問で<br>
      あなたの思考パターンを徹底分析します
    </p>
    <button style="background:#fff; color:#000; margin-top:20px; text-align:center;" onclick="start(false)">診断を開始</button>
    <button id="resume-btn" class="hide" style="width:100%; margin-top:10px; border:1px solid #666; background:none; color:#fff; border-radius:16px; padding:16px; text-align:center;" onclick="start(true)">続きから再開</button>
  </div>

  <div id="screen-quiz" class="card hide">
    <div id="timer-ui" class="hide"><div id="timer-display" class="timer">45</div></div>
    <div style="font-size:0.8rem; color:var(--accent-b);">Q.<span id="q-num">1</span> / 100</div>
    <div class="progress-bar"><div id="progress-fill" class="progress-fill"></div></div>
    <div id="question-text" class="question-text"></div>
    <div id="extra-info" class="hide">
        <div class="highlight-box">「あの人にとって、1億円とあなたの命、どちらに価値があると思っているか」</div>
        という、あなたの傲慢さへの問いです。
    </div>
    <div id="choices" class="choices"></div>
    <div style="display:flex; gap:10px; width:100%;">
        <button class="sub-btn" onclick="goBack()">戻る</button>
        <button id="force-finish-btn" class="sub-btn" onclick="forceFinish()">途中で結果を見る</button>
        <button class="sub-btn" onclick="resetAll()">リセット</button>
    </div>
  </div>

  <div id="screen-result" class="card hide">
    <img id="res-image" class="res-char-img" src="" alt="result">
    <div id="res-area" class="res-area-name"></div>
    <div id="res-type" class="res-type-name"></div>
    
    <div class="section"><div class="sec-title">思考パターン</div><div id="res-thinking" class="essay-text"></div></div>
    <div class="section"><div class="sec-title">恋愛傾向</div><div id="res-love" class="essay-text"></div></div>
    <div class="section"><div class="sec-title">向いてる仕事</div><div id="res-job-yes" class="essay-text"></div></div>
    <div class="section"><div class="sec-title">向いてない仕事</div><div id="res-job-no" class="essay-text"></div></div>
    <div class="section"><div class="sec-title">レベルアップするには？</div><div id="res-levelup" class="essay-text"></div></div>

    <div id="final-box" class="final-box"></div>
    <button style="margin-top:20px; text-align:center;" onclick="resetAll()">トップへ戻る</button>
  </div>
</div>

<script>
const DB = [
  // ① SNS・承認欲求 (1-20)
  {cat:"SNS", q:"TikTokやX等でバズってる人を見ると、いいね数やコメント数を気にしてしまう", c:["つい数字を分析してしまう", "たまに見てしまう", "全く気にならない"]},
  {cat:"SNS", q:"友達の投稿が伸びていると、コメント欄やいいね数を全て確認する", c:["誰が反応してるか隅々まで見る", "少し覗く程度", "見ない"]},
  {cat:"SNS", q:"TikTokやX等でバズってる人を見るといいね数やコメント数を気にしてしまう", c:["自分の時と何が違うか考える", "いいなーと思う", "どうでもいい"]},
  {cat:"SNS", q:"炎上してる話題を一から調べて追う癖がある", c:["経緯をすべて把握したい", "たまに追いかける", "時間の無駄だと思う"]},
  {cat:"SNS", q:"ストーリーを上げた後、友達からの反応をずっと待っている", c:["通知が来るまで何度も開く", "たまにチェックする", "放置している"]},
  {cat:"SNS", q:"投稿する前に何回も文章や写真を見直す", c:["1ミリのミスも許さず見直す", "数回は確認する", "勢いで上げる"]},
  {cat:"SNS", q:"反応が少ないと投稿を消したくなる", c:["恥ずかしくて消す", "少し落ち込む", "そのままにする"]},
  {cat:"SNS", q:"自撮りを上げる事がある", c:["自信がある時や加工が盛れたら", "たまに記録として", "絶対上げない"]},
  {cat:"SNS", q:"フォロワー数で人を判断してしまうことがある", c:["数字＝その人の格だと思う", "少しは意識する", "中身で判断する"]},
  {cat:"SNS", q:"友達の幸せな報告には嫉妬することが多い", c:["正直、素直に喜べない", "少しモヤっとする", "全力で祝える"]},
  {cat:"SNS", q:"バズっている理由を分析するのが好きだ", c:["法則性を見つけたい", "なんとなく考える", "興味がない"]},
  {cat:"SNS", q:"SNSでの自分の立ち位置を意識している", c:["キャラ設定や見られ方を守る", "少しは気にする", "素のままでいる"]},
  {cat:"SNS", q:"承認されていないと不安になる", c:["誰かに認められないと価値がない", "たまに寂しくなる", "自分だけで満足"]},
  {cat:"SNS", q:"裏垢やコメント欄でニュースやその話題に対して自分の意見を良くいう", c:["匿名なら本音をぶつけられる", "たまに書き込む", "見るだけ"]},
  {cat:"SNS", q:"炎上している人を見て「自分ならこうする」と考える", c:["最善の火消し案が浮かぶ", "少し考える", "バカだなと思う"]},
  {cat:"SNS", q:"SNSでいいね数やコメント欄や友達の反応を気にして投稿する", c:["他人の目が全ての基準", "多少は意識して選ぶ", "自分の好きなものを出す"]},
  {cat:"SNS", q:"伸びる時間帯を気にする", c:["ゴールデンタイムを狙う", "多少は意識する", "いつでもいい"]},
  {cat:"SNS", q:"有名人に「好きです」などのdmを送った事がある", c:["想いを伝えたくて送った", "送ろうとしたことはある", "ない"]},
  {cat:"SNS", q:"他人の投稿に批判的なコメントをした事がある", c:["間違っているから指摘した", "イラっとして書いた", "ない"]},
  {cat:"SNS", q:"SNSはいかにいいねをたくさん貰うかが重要だ", c:["数字こそが正義", "多ければ嬉しい", "自己満足でいい"]},

  // ② 夜職・盛り・自己価値 (21-40)
  {cat:"GLAM", q:"見た目はお金でどうにかなる", c:["投資すれば必ず報われる", "ある程度はそう思う", "中身や素材が大事"]},
  {cat:"GLAM", q:"ここ1年は容姿を磨くことに1番お金をかけている", c:["美容が人生の最優先", "かなり使っている", "並程度"]},
  {cat:"GLAM", q:"可愛い・かっこいいと言われると自信が出る", c:["それが生きる糧", "素直に嬉しい", "お世辞だと思う"]},
  {cat:"GLAM", q:"第一印象で損したくない", c:["外見でナメられたら終わり", "身だしなみは整える", "愛嬌があればいい"]},
  {cat:"GLAM", q:"ナメられたくない気持ちが強い", c:["常に強気な外見でいたい", "少しはある", "どう思われてもいい"]},
  {cat:"GLAM", q:"整形は努力だと思う", c:["痛みと金をかける立派な努力", "一つの手段だと思う", "努力とは違う"]},
  {cat:"GLAM", q:"恋愛において自分の価値は高いと思う", c:["自分を安売りしたくない", "普通だと思う", "自信がない"]},
  {cat:"GLAM", q:"10万円以上のブランド品を複数所持している", c:["武装するために必要", "いくつか持っている", "興味がない"]},
  {cat:"GLAM", q:"メイクが上手く行かなくて遅刻した事がある", c:["完璧じゃない顔で外に出れない", "たまにある", "メイクより時間優先"]},
  {cat:"GLAM", q:"自分を安売りしても欲しいものがある", c:["目的のためなら手段を選ばない", "少しは譲歩する", "プライドは捨てない"]},
  {cat:"GLAM", q:"自分よりブサイクをみると安心する", c:["正直、優越感に浸る", "無意識に比較する", "何とも思わない"]},
  {cat:"GLAM", q:"整形をしている", c:["既にアップデート済み", "検討中・カウンセリング済み", "するつもりはない"]},
  {cat:"GLAM", q:"異性とのご飯は奢られたい", c:["それが自分の価値の証明", "奢られたら嬉しい", "割り勘でいい"]},
  {cat:"GLAM", q:"鏡を見てコンプレックスを感じる", c:["もっと直したい場所ばかり", "たまに気になる", "今の自分が好き"]},
  {cat:"GLAM", q:"異性とのご飯は奢りたい", c:["優位に立ちたい・かっこつけたい", "余裕があれば", "したくない"]},
  {cat:"GLAM", q:"自分を高く見せるのは悪いことじゃない", c:["セルフブランディングの基本", "たまには必要", "ありのままがいい"]},
  {cat:"GLAM", q:"恋愛は女性は顔と男性はお金だと思う", c:["それがこの世の真理", "一理あると思う", "愛が一番"]},
  {cat:"GLAM", q:"他人にどう見られているか常に気になる", c:["360度どこから見られても良くいたい", "多少は気になる", "気にしない"]},
  {cat:"GLAM", q:"自分を下げる発言は冗談でも、言われたら傷つく", c:["絶対許さない", "モヤっとする", "笑いに変える"]},
  {cat:"GLAM", q:"プライドは高い方だ", c:["折られるくらいなら死ぬ", "少し高いかも", "低いと思う"]},

  // ③ メガネ真面目くん (41-60)
  {cat:"GACHI", q:"約束の時間は絶対守るべきだ", c:["5分前行動が当たり前", "時間は守るようにしている", "多少の遅れは許してほしい"]},
  {cat:"GACHI", q:"計画通りに進まないとイライラする", c:["予定が狂うとパニック・怒り", "少し焦る", "臨機応変に楽しむ"]},
  {cat:"GACHI", q:"ミスをすると原因を考える", c:["再発防止を徹底的に分析", "反省する", "次から気をつける"]},
  {cat:"GACHI", q:"学校や会社での人の小さな言い間違いを訂正したくなる", c:["正しくないのが気持ち悪い", "たまに指摘する", "スルーする"]},
  {cat:"GACHI", q:"自分は信号無視をするタイプだ", c:["青になるまで絶対待つ", "車がいなければ行く", "急いでいれば渡る"]},
  {cat:"GACHI", q:"好きな人との夜ご飯は予約してて欲しい／したい", c:["段取りこそが誠意", "あれば嬉しい", "行き当たりばったりがいい"]},
  {cat:"GACHI", q:"段取りができていないと不安になる", c:["全行程を把握したい", "少し不安", "どうにかなる"]},
  {cat:"GACHI", q:"無責任な行動を見ると腹が立つ", c:["社会人・人間として許せない", "イラっとする", "人は人だと思う"]},
  {cat:"GACHI", q:"先のことを考えて動くタイプだ", c:["常にリスクヘッジを欠かさない", "計画は立てる", "今を生きる"]},
  {cat:"GACHI", q:"LINEでの誤字、脱字などの小さいミスが気になる", c:["送信前に何度も読み直す", "少し気になる", "気にせず送る"]},
  {cat:"GACHI", q:"バランスのよい食事を心掛けている", c:["栄養素を管理している", "意識はしている", "好きなものを食べる"]},
  {cat:"GACHI", q:"無駄な出費はできる限りしない", c:["1円単位で家計を管理", "貯金はしている", "浪費家だ"]},
  {cat:"GACHI", q:"学生の頃や社会で責任のある役割をした事がある", c:["リーダーや委員長を経験", "補佐などを経験", "ない"]},
  {cat:"GACHI", q:"バイトで無責任な人にイライラする", c:["給料泥棒だと思う", "仕事はしてほしい", "自分は自分と割り切る"]},
  {cat:"GACHI", q:"友達の秘密を言ってしまった事がある", c:["絶対言わない（口が堅い）", "ついうっかりあるかも", "つい話してしまう"]},
  {cat:"GACHI", q:"失敗を繰り返さないように努力する", c:["失敗ノートを作る勢いで徹底", "意識して気をつける", "またやってしまう"]},
  {cat:"GACHI", q:"恋愛では年上が好きだ", c:["落ち着きと教養を求めたい", "どちらかと言えば", "年下や同い年がいい"]},
  {cat:"GACHI", q:"電車の遅延などで予定が崩れると一気に疲れる", c:["その日すべてが台無しな気分", "かなりガッカリする", "仕方ないと思う"]},
  {cat:"GACHI", q:"利益が少しずつでもコツコツ積み立てれる", c:["複利の力を信じている", "貯金は得意", "すぐ使ってしまう"]},
  {cat:"GACHI", q:"眠い時は授業中でも友達の車でも寝る", c:["規律を守るため起きていたい", "たまに耐えられない", "すぐ寝る"]},

  // ④ 恋愛至上主義 (61-80)
  {cat:"LOVE", q:"好きな人の誕生日に3万円以上は使いたい", c:["喜ぶ顔のためなら惜しくない", "記念日なら頑張る", "1万円以下で十分"]},
  {cat:"LOVE", q:"恋愛が生活の中心になりやすい", c:["恋人が世界の中心", "仕事と恋愛半々", "趣味や友達が優先"]},
  {cat:"LOVE", q:"相手の言動に一喜一憂しがち", c:["LINE一通で天国と地獄", "多少は振り回される", "冷静でいられる"]},
  {cat:"LOVE", q:"返信速度で愛情を測ってしまう", c:["即レス＝愛、遅い＝不安", "少しは気にする", "忙しいだけだと思う"]},
  {cat:"LOVE", q:"曖昧な関係は苦手だ", c:["白黒はっきりさせたい", "少し不安になる", "ゆるい関係もアリ"]},
  {cat:"LOVE", q:"好きな人のわがままなら自分を曲げてでも聞きたい", c:["尽くすのが喜び", "できる範囲で", "嫌なものは断る"]},
  {cat:"LOVE", q:"相手に依存してしまうことがある", c:["24時間一緒にいたい", "たまに寄りかかりすぎる", "自立していたい"]},
  {cat:"LOVE", q:"恋人とはニコイチの存在になりたい", c:["一心同体でありたい", "仲良しでいたい", "別々の人間として過ごしたい"]},
  {cat:"LOVE", q:"失恋した時は予定を潰したことがある", c:["何も手につかなくなる", "1日くらいは休む", "仕事で紛らわす"]},
  {cat:"LOVE", q:"恋人の交友関係にも嫉妬をする", c:["自分以外の異性は全員敵", "少し気になる", "信頼している"]},
  {cat:"LOVE", q:"束縛されると愛されていると感じる", c:["縛られるほど安心する", "多少は嬉しい", "絶対嫌だ"]},
  {cat:"LOVE", q:"恋愛で安心感がないと不安になる", c:["常に愛を確認したい", "たまに不安", "信頼があれば平気"]},
  {cat:"LOVE", q:"曖昧な都合のいい関係は不安になる", c:["耐えられない（病む）", "寂しい時に揺らぐ", "割り切れる"]},
  {cat:"LOVE", q:"返信がない時は恋人の予定を知らないと落ち着かない", c:["今何してるか常に把握したい", "少し気になる", "信じて待つ"]},
  {cat:"LOVE", q:"相手に依存されたい", c:["必要とされるのが快感", "頼られたい", "自立した人がいい"]},
  {cat:"LOVE", q:"相手の行動を把握していたい", c:["隠し事は許さない", "ある程度は知りたい", "自由にしていい"]},
  {cat:"LOVE", q:"家に帰る時間などの束縛をされたい", c:["門限があるのが愛", "たまになら", "干渉されたくない"]},
  {cat:"LOVE", q:"恋人が最優先になる", c:["友達より恋人との約束", "状況による", "友達や家族も大事"]},
  {cat:"LOVE", q:"ニコイチの存在になりたい", c:["ペア画やペアルックをしたい", "たまにはいいかも", "恥ずかしい"]},
  {cat:"LOVE", q:"恋愛が人生を左右する", c:["恋次第で人生の質が変わる", "重要な要素ではある", "他にも大事なものはある"]},

  // ⑤ インキャラ (81-99)
  {cat:"KAGE", q:"一人の時間がないとしんどい", c:["一人でしか回復できない", "たまに欲しくなる", "誰かといたい"]},
  {cat:"KAGE", q:"群れるより少人数が楽", c:["2人か3人が限界", "4,5人くらいなら", "大人数が好き"]},
  {cat:"KAGE", q:"学生の頃は群れている人たちは苦手だった", c:["住む世界が違うと思っていた", "少し苦手意識があった", "仲良くしていた"]},
  {cat:"KAGE", q:"周りに合わせすぎるのが苦手", c:["自分を殺したくない", "たまに合わせる", "合わせるのが得意"]},
  {cat:"KAGE", q:"無理にテンションを上げたくない", c:["省エネでいたい", "時と場合による", "常に盛り上がりたい"]},
  {cat:"KAGE", q:"1人カフェなど静かな場所が好き", c:["読書や思考に耽りたい", "たまに行く", "退屈で無理"]},
  {cat:"KAGE", q:"自分の世界を大事にしたい", c:["聖域は誰にも侵されたくない", "趣味の時間は確保する", "オープンな人間だ"]},
  {cat:"KAGE", q:"人に踏み込まれすぎると疲れる", c:["心の壁がかなり厚い", "少し距離を置く", "歓迎する"]},
  {cat:"KAGE", q:"一人で考える時間が必要", c:["内省こそが生きがい", "たまに必要", "直感で動く"]},
  {cat:"KAGE", q:"自分のペースを乱されたくない", c:["急な誘いは基本NG", "少しイラっとする", "いつでも歓迎"]},
  {cat:"KAGE", q:"遊ぶ時に周りに合わせたファッションをする", c:["浮かないように同化する", "少し意識する", "自分の着たい服を着る"]},
  {cat:"KAGE", q:"空気を読むより距離を取る", c:["面倒な場には最初から行かない", "空気を読んで合わせる", "積極的に関わる"]},
  {cat:"KAGE", q:"無駄な人間関係を減らしたい", c:["連絡先を定期的に整理する", "少しは整理したい", "広い方がいい"]},
  {cat:"KAGE", q:"レジ接客や電話対応が苦手", c:["知らない人と話したくない", "少し緊張する", "平気"]},
  {cat:"KAGE", q:"感情は隠したい/知られたくない", c:["ポーカーフェイスでいたい", "あまり出さない", "顔に出るタイプ"]},
  {cat:"KAGE", q:"深く狭い人間関係が好き", c:["数少ない理解者がいればいい", "どちらかと言えばそう", "浅く広くがいい"]},
  {cat:"KAGE", q:"自分の価値観を曲げたくない", c:["頑固だと言われてもいい", "基本は譲らない", "柔軟に変えられる"]},
  {cat:"KAGE", q:"友達が怒っていたら理不尽なことでも謝る", c:["争うエネルギーが勿体ないので謝る", "納得いかなければ謝らない", "徹底的に話し合う"]},
  {cat:"KAGE", q:"勉強は家でやるよりもカフェや自習室の方が捗る", c:["適度な他人の目がある方がいい", "気分転換になれば", "家が一番いい"]}
];

const MASTER = {
  SNS: { 
    area: "SNS・承認欲求界隈", 
    type: "【デジタル承認モンスター型】",
    thinking: "あなたの思考は常に「客観視という名の他人の目」に支配されています。何を見ても『これは映えるか』『どう反論されるか』を先に考えてしまい、純粋な体験が難しくなっている状態です。情報の波を読む力は天才的ですが、その分、自分の核となる意見が空洞化しやすく、数字の増減でアイデンティティが崩壊する危うさを持っています。",
    love: "恋愛においても「見栄え」と「反応速度」を重視します。パートナーがSNSで自慢できる相手か、あるいは自分の投稿に真っ先に反応してくれるかが愛情の指標になりがちです。愛されている実感よりも、愛されているように周りに見えているか、という実感を優先してしまうため、本質的な孤独が埋まりにくい傾向があります。",
    jobYes: "SNS運用担当、PR・広報、トレンドアナリスト、メディア編集者、インフルエンサー。",
    jobNo: "地方公務員、工場での定型作業、顔出しNGの地味な事務職、アナログな伝統工芸。",
    levelup: "1日のうち数時間はデジタルデトックスを行い、誰にも見せない日記を書くことで『自分だけの言葉』を取り戻してください。"
  },
  GLAM: { 
    area: "夜職・盛り・自己価値界隈", 
    type: "【自己武装ハイグレード型】",
    thinking: "「自分は商品である」という冷徹かつストイックな思考の持ち主です。見た目や持ち物は自分を高く売るための投資であり、現状に満足せず常にアップデートを目指すエネルギーは凄まじいものがあります。しかし、その根底には『完璧でない自分には価値がない』という強烈な恐怖心が眠っており、休息を自分に許せない傾向があります。",
    love: "恋愛は「価値の交換」になりがちです。自分と同等かそれ以上のスペックを相手に求め、ナメられないための武装を恋人の前でも解けません。奢られることや高価なプレゼントを自分の価値の証明書として扱うため、本当の意味で弱音を吐ける関係性を築くのに時間がかかるタイプです。",
    jobYes: "不動産・高級車営業、美容外科カウンセラー、プロデューサー、夜職全般、芸能・モデル。",
    jobNo: "ボランティア団体、個性を消す制服業務、年功序列の古い企業、福祉関係。",
    levelup: "『何も持っていない、盛っていない自分』を肯定してくれる友人を一人でも持つことで、精神的な武装解除を覚えてください。"
  },
  GACHI: { 
    area: "メガネ真面目くん界隈", 
    type: "【規律の守護者・ジャッジ型】",
    thinking: "「正しさ」と「効率」を最優先する論理的思考です。世界はルール通りに動くべきだと考えており、そこから外れる人間や事象に対して強い不快感を抱きます。責任感が強く、あなたの周りは秩序が保たれますが、同時に「正論で人を追い詰める」という無自覚な暴力性を秘めており、周囲に緊張感を与えてしまうことがあります。",
    love: "計画的で安定した恋愛を好みます。デートの予約や将来設計などは完璧ですが、相手に「マナー」や「常識」を求めすぎるため、感情論で動くタイプとは衝突が絶えません。愛を数値や行動の積み重ねで判断するため、相手の『ただ寄り添ってほしい』という曖昧なニーズを見落としがちです。",
    jobYes: "エンジニア、会計士・税理士、法務・コンプライアンス、品質管理、公務員。",
    jobNo: "即興性が求められるお笑い芸人、ベンチャーの営業、芸術家、ルールが未整備な職場。",
    levelup: "『無駄なこと』や『非効率な遊び』に全力で取り組む時間を作り、許容範囲（遊び）を広げるトレーニングをしてください。"
  },
  LOVE: { 
    area: "恋愛至上主義界隈", 
    type: "【共依存・愛の重力型】",
    thinking: "人生の全ての意味を「他者との繋がり」に見出す思考パターンです。自分の幸せは自分ではなく、隣にいる誰かの機嫌によって決まります。感受性が豊かで共感能力が高い一方で、一人の時間を「虚無」と感じやすく、常に誰かと繋がっていないと自分の輪郭を保てないという脆さを持っています。",
    love: "愛すること＝同化することだと考えています。恋人の全てを知り、全てを共有し、ニコイチでいたいという欲求が強く、束縛を愛の証として歓迎します。しかし、その重すぎる愛情は時に相手の酸素を奪い、結果的に別れを早めてしまう、あるいは不健全な共依存関係に陥るリスクが高いです。",
    jobYes: "看護師・介護士、カウンセラー、ブライダル関係、ベビーシッター、ファンクラブ運営。",
    jobNo: "孤独な研究職、冷徹な判断を要する経営陣、短期的な数字を追うトレーダー、警備員。",
    levelup: "『一人の時間を楽しむ趣味』を死守してください。自分一人で機嫌を取れるようになれば、愛はもっと自由になります。"
  },
  KAGE: { 
    area: "自分を持ってるインキャラ界隈", 
    type: "【孤高の観測者・バリア型】",
    thinking: "内側に強固な「自分だけの王国」を築いている思考です。外界のノイズを嫌い、最小限のエネルギーで社会と接しようとします。物事を深く洞察する力がありますが、それを外に出すことを「野暮」だと感じたり、否定されることを恐れて隠したりします。他人に期待しないことで平穏を保つ、ある種の諦観を美学としています。",
    love: "精神的な深いつながりを重視しますが、パーソナルスペースを侵食されることを極端に嫌います。恋人であっても、自分の時間や思考を邪魔されるとスッと冷めてしまう瞬間があります。言葉にしなくても理解し合える関係を理想としますが、説明不足によるすれ違いで自ら関係を終わらせてしまうことも多いです。",
    jobYes: "作家・ライター、プログラマー、研究職、イラストレーター、図書館司書。",
    jobNo: "イベントMC、飛び込み営業、コールセンター、体育会系のチーム作業。",
    levelup: "自分の考えていることを、あえて『10%増し』で言葉にして伝えてみてください。世界は意外と、あなたを拒絶しません。"
  }
};

let state = { idx: 0, scores: {SNS:0, GLAM:0, GACHI:0, LOVE:0, KAGE:0}, history: [], ans: null, timerVal: 45 };

window.onload = () => {
  if (localStorage.getItem('mbti_plus_vfinal')) document.getElementById('resume-btn').classList.remove('hide');
};

function start(resume) {
  if(resume) state = JSON.parse(localStorage.getItem('mbti_plus_vfinal'));
  document.getElementById('screen-intro').classList.add('hide');
  document.getElementById('screen-quiz').classList.remove('hide');
  render();
}

function render() {
  const qText = document.getElementById('question-text');
  const choices = document.getElementById('choices');
  const fill = document.getElementById('progress-fill');
  localStorage.setItem('mbti_plus_vfinal', JSON.stringify(state));
  
  choices.innerHTML = "";
  if (state.idx < 99) {
    const q = DB[state.idx];
    qText.textContent = q.q;
    document.getElementById('q-num').textContent = state.idx + 1;
    fill.style.width = `${state.idx + 1}%`;
    q.c.forEach((txt, i) => {
      const btn = document.createElement('button');
      btn.textContent = txt;
      btn.onclick = () => {
        state.history.push({scores:{...state.scores}});
        state.scores[q.cat] += (i===0?2 : (i===1?0 : -1));
        state.idx++; render();
      };
      choices.appendChild(btn);
    });
  } else { renderFinal(); }
}

function renderFinal() {
  document.getElementById('screen-quiz').classList.add('extreme-mode');
  document.getElementById('timer-ui').classList.remove('hide');
  document.getElementById('extra-info').classList.remove('hide');
  document.getElementById('force-finish-btn').classList.add('hide');
  document.getElementById('q-num').textContent = "100";
  document.getElementById('progress-fill').style.width = "100%";
  
  const qText = document.getElementById('question-text');
  qText.innerHTML = `<span style="color:#ff4477; font-size:1.3rem;">究極の選択：不幸のボタン</span><br><br>想像してください。あなたの目の前に、ひとつの輝いたボタンがあります。それを押せば、あなたが大切に思っている「友達」の口座に、1億円が振り込まれます。ただし、その代わり。あなたはこの世から消えてなくなります。あなたは、このボタンを「あの人」に渡せますか？`;
  
  const choices = document.getElementById('choices');
  choices.innerHTML = "";
  ["あの人に渡す", "絶対に渡さない"].forEach((txt, i) => {
    const btn = document.createElement('button');
    btn.textContent = txt;
    btn.style.textAlign = "center";
    btn.onclick = () => { clearInterval(state.timer); state.ans = i; showResult(); };
    choices.appendChild(btn);
  });

  state.timer = setInterval(() => {
    state.timerVal--;
    document.getElementById('timer-display').textContent = state.timerVal;
    if(state.timerVal <= 0) { clearInterval(state.timer); state.ans = null; showResult(); }
  }, 1000);
}

function forceFinish() {
  if(confirm("【警告】\nまだ全ての質問に回答していません。このまま結果を見ると正確性が著しく落ちますが、よろしいですか？")) {
    showResult();
  }
}

function showResult() {
  document.getElementById('screen-quiz').classList.add('hide');
  document.getElementById('screen-result').classList.remove('hide');
  
  const top = Object.keys(state.scores).reduce((a,b)=> state.scores[a] > state.scores[b]? a : b);
  const info = MASTER[top];

  document.getElementById('res-image').src = `https://r.jina.ai/i/${info.area}`; 
  document.getElementById('res-area').textContent = info.area;
  document.getElementById('res-type').textContent = info.type;
  
  document.getElementById('res-thinking').textContent = info.thinking;
  document.getElementById('res-love').textContent = info.love;
  document.getElementById('res-job-yes').textContent = info.jobYes;
  document.getElementById('res-job-no').textContent = info.jobNo;
  document.getElementById('res-levelup').textContent = info.levelup;

  let finalMsg = "";
  if(state.idx < 99) {
    finalMsg = "【中断された結果】<br>100問全ての対話を終えていないため、深層分析はロックされています。";
  } else {
    if(state.ans === 0) finalMsg = "【ボタンを渡す】<br>―― その「信用」は、ただの押し付けだ。一番大切な人に「一生続く負い目」をプレゼントして、あなたは満足ですか？相手を試さずにはいられない。その確認作業を、あなたは友情と呼んでいる。";
    else if(state.ans === 1) finalMsg = "【ボタンを渡さない】<br>―― あなたは、あの人を「見くびっている」。あの人が1億円に負けて、あなたを忘れてしまう可能性を確信している。それは自分への執着ではなく、相手への冷徹な「諦め」です。";
    else finalMsg = "【沈黙】<br>どちらも選ばなかった。それは迷いではなく、あの人と金を同じ天秤に載せること自体を拒否した、唯一の誠実な回答です。";
  }
  
  document.getElementById('final-box').innerHTML = `<span style="color:#ff4477; font-weight:bold;">最後の回答への分析：</span><br><br>${finalMsg}`;
}

function goBack() { if(state.idx > 0) { state.idx--; state.scores = state.history.pop().scores; render(); } }
function resetAll() { localStorage.clear(); location.reload(); }
</script>
</body>
</html>
