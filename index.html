<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>えむびーてぃーあいPlus | 究極版</title>
  <style>
    :root {
      --bg: #05070a;
      --accent-p: #ff7ca7;
      --accent-v: #bda6ff;
      --accent-b: #6ef2ff;
      --text: #ffffff;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0; min-height: 100vh;
      font-family: "Hiragino Kaku Gothic ProN", "Hiragino Sans", sans-serif;
      background: var(--bg); color: var(--text);
      display: flex; justify-content: center; align-items: center; padding: 15px;
    }
    .container { max-width: 650px; width: 100%; transition: 0.5s; }
    .card {
      background: rgba(255,255,255,0.06); border-radius: 32px; padding: 35px;
      backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.1);
      box-shadow: 0 25px 60px rgba(0,0,0,0.8); position: relative;
    }
    /* 特別演出 */
    .extreme-mode { background: #000 !important; border: 1px solid #444 !important; animation: heart 2s infinite; }
    @keyframes heart { 0%, 100% { box-shadow: 0 0 20px #000; } 50% { box-shadow: 0 0 40px rgba(255,0,85,0.15); } }
    .silence-sanctuary { background: #fff !important; color: #000 !important; border: none !important; }
    .silence-sanctuary .section-title { color: #555 !important; }
    .silence-sanctuary .essay-text { color: #333 !important; }

    h1 { text-align: center; font-size: 1.8rem; background: linear-gradient(90deg, var(--accent-p), var(--accent-v)); -webkit-background-clip: text; color: transparent; margin-bottom: 20px; font-weight: 900; }
    .intro-text { font-size: 0.95rem; line-height: 1.8; color: #bbb; text-align: center; margin-bottom: 30px; }
    
    .progress-bar { height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; margin: 25px 0; overflow: hidden; }
    .progress-fill { height: 100%; background: linear-gradient(90deg, var(--accent-v), var(--accent-b)); width: 0%; transition: 0.3s; }
    
    .question-text { font-size: 1.15rem; font-weight: bold; line-height: 1.7; min-height: 100px; margin-bottom: 25px; }
    .choices { display: grid; gap: 12px; }
    button {
      padding: 18px; border-radius: 18px; border: 1px solid rgba(255,255,255,0.15);
      background: rgba(255,255,255,0.05); color: #fff; font-size: 1rem; font-weight: bold; cursor: pointer; transition: 0.2s;
    }
    button:hover { background: rgba(255,255,255,0.2); transform: translateY(-2px); border-color: var(--accent-v); }

    .timer { font-size: 4rem; text-align: center; color: var(--accent-p); font-weight: 900; margin-bottom: 20px; font-family: monospace; }
    
    /* 結果画面デザイン調整 */
    .res-area-name { font-size: 2.2rem; font-weight: 900; color: var(--accent-p); margin-bottom: 5px; letter-spacing: -1px; text-align:center; }
    .res-type-name { font-size: 1.2rem; font-weight: bold; color: var(--accent-v); text-align:center; margin-bottom: 30px; opacity: 0.8; }
    
    .section { background: rgba(255,255,255,0.04); border-radius: 24px; padding: 25px; margin-bottom: 20px; border-left: 6px solid var(--accent-v); }
    .section-title { font-weight: 900; font-size: 0.9rem; color: var(--accent-v); margin-bottom: 12px; letter-spacing: 1px; }
    .essay-text { line-height: 1.9; font-size: 0.95rem; white-space: pre-wrap; }
    .bold-hit { font-weight: 900; color: var(--accent-p); border-bottom: 2px solid var(--accent-p); }
    
    .final-box { background: #000; border: 2px solid var(--accent-p); padding: 30px; border-radius: 28px; margin-top: 30px; }
    .final-essay { font-size: 0.9rem; line-height: 2; white-space: pre-wrap; }

    .hide { display: none !important; }
    .nav-btns { display: flex; gap: 10px; margin-top: 25px; }
    .sub-btn { flex: 1; padding: 12px; font-size: 0.8rem; background: transparent; border: 1px solid #444; color: #888; border-radius: 12px; }
  </style>
</head>
<body>

<div class="container">
  <div id="screen-intro" class="card">
    <h1>えむびーてぃーあいPlus</h1>
    <div class="intro-text">
      3×100問のとある診断の強化版診断になっております。<br>
      無駄な曖昧な5択や質問などを全て具体化しており、あなたの思考パターンを高性能AIで詳細化します。<br><br>
      あなたの人生の参考になると幸いです。
    </div>
    <button style="width:100%; background:#fff; color:#000;" onclick="start(false)">診断開始</button>
    <button id="resume-btn" class="sub-btn hide" style="width:100%; margin-top:10px;" onclick="start(true)">続きから再開する</button>
  </div>

  <div id="screen-quiz" class="card hide">
    <div id="timer-ui" class="hide"><div id="timer-display" class="timer">35</div></div>
    <div id="q-label" style="font-size:0.8rem; font-weight:900; color:var(--accent-b);">ANALYZING... Q.<span id="q-num">1</span> / 100</div>
    <div class="progress-bar"><div id="progress-fill" class="progress-fill"></div></div>
    <div id="question-text" class="question-text"></div>
    <div id="choices" class="choices"></div>
    <div id="nav-btns" class="nav-btns">
      <button class="sub-btn" onclick="goBack()">ひとつ前に戻る</button>
      <button class="sub-btn" onclick="forceFinish()">診断を中断して結果を見る</button>
    </div>
    <p id="warn-text" style="font-size:0.7rem; color:#666; text-align:center; margin-top:15px;">
      ※結果はいつでも出せますが100の質問に答えていただく方が精度が高いです
    </p>
  </div>

  <div id="screen-result" class="card hide">
    <div id="res-area" class="res-area-name"></div>
    <div id="res-type" class="res-type-name"></div>
    
    <div class="section">
      <div class="section-title">思考タイプ</div>
      <div id="res-essay" class="essay-text"></div>
    </div>

    <div class="section">
      <div id="res-job-title" class="section-title">職業分析</div>
      <div id="res-jobs" class="essay-text"></div>
    </div>

    <div class="section">
      <div class="section-title">レベルアップするには？</div>
      <div id="res-level" class="essay-text"></div>
    </div>

    <div id="final-box" class="final-box">
      <div id="res-final" class="final-essay"></div>
    </div>

    <button style="width:100%; margin-top:40px; border-color:#444; color:#888;" onclick="resetAll()">全てのデータを消去してトップへ</button>
  </div>
</div>

<script>
/* 質問データベース */
const DB = [
  /* SNS (1-20) */
  {cat:"SNS", q:"TikTokやX等でバズってる人を見ると、いいね数やコメント数を気にしてしまう"},
  {cat:"SNS", q:"友達の投稿が伸びていると、コメント欄やいいね数を全て確認する"},
  {cat:"SNS", q:"炎上してる話題を一から調べて追う癖がある"},
  {cat:"SNS", q:"ストーリーを上げた後、友達からの反応をずっと待っている"},
  {cat:"SNS", q:"投稿する前に何回も文章や写真を見直す"},
  {cat:"SNS", q:"反応が少ないと投稿を消したくなる"},
  {cat:"SNS", q:"自撮りを上げる事がある"},
  {cat:"SNS", q:"フォロワー数で人を判断してしまうことがある"},
  {cat:"SNS", q:"友達の幸せな報告には嫉妬することが多い"},
  {cat:"SNS", q:"バズっている理由を分析するのが好きだ"},
  {cat:"SNS", q:"SNSでの自分の立ち位置を意識している"},
  {cat:"SNS", q:"承認されていないと不安になる"},
  {cat:"SNS", q:"裏垢等でニュースや話題に対し自分の意見をよく言う"},
  {cat:"SNS", q:"炎上している人を見て「自分ならこうする」と考える"},
  {cat:"SNS", q:"いいね数や友達の反応を気にして投稿する"},
  {cat:"SNS", q:"伸びる時間帯を気にする"},
  {cat:"SNS", q:"有名人に「好きです」などのDMを送った事がある"},
  {cat:"SNS", q:"他人の投稿に批判的なコメントをした事がある"},
  {cat:"SNS", q:"SNSはいかにいいねをたくさん貰うかが重要だ"},
  {cat:"SNS", q:"バズっている投稿のコメントの空気を読むのが得意だ"},
  /* GLAM (21-40) */
  {cat:"GLAM", q:"見た目はお金でどうにかなる"},
  {cat:"GLAM", q:"ここ1年は容姿を磨くことに1番お金をかけている"},
  {cat:"GLAM", q:"可愛い・かっこいいと言われると自信が出る"},
  {cat:"GLAM", q:"第一印象で損したくない"},
  {cat:"GLAM", q:"ナメられたくない気持ちが強い"},
  {cat:"GLAM", q:"整形は努力だと思う"},
  {cat:"GLAM", q:"恋愛において自分の価値は高いと思う"},
  {cat:"GLAM", q:"10万円以上のブランド品を複数所持している"},
  {cat:"GLAM", q:"メイクが上手く行かなくて遅刻した事がある"},
  {cat:"GLAM", q:"自分を安売りしても欲しいものがある"},
  {cat:"GLAM", q:"自分よりブサイクをみると安心する"},
  {cat:"GLAM", q:"整形をしている、もしくは強くしたい"},
  {cat:"GLAM", q:"異性とのご飯は奢られたい"},
  {cat:"GLAM", q:"鏡を見てコンプレックスを感じる"},
  {cat:"GLAM", q:"異性とのご飯は奢りたい"},
  {cat:"GLAM", q:"自分を高く見せるのは悪いことじゃない"},
  {cat:"GLAM", q:"恋愛は女性は顔と男性はお金だと思う"},
  {cat:"GLAM", q:"他人にどう見られているか常に気になる"},
  {cat:"GLAM", q:"自分を下げる発言は冗談でも傷つく"},
  {cat:"GLAM", q:"プライドは高い方だ"},
  /* GACHI (41-60) */
  {cat:"GACHI", q:"約束の時間は絶対守るべきだ"},
  {cat:"GACHI", q:"計画通りに進まないとイライラする"},
  {cat:"GACHI", q:"ミスをすると原因を考える"},
  {cat:"GACHI", q:"人の小さな言い間違いを訂正したくなる"},
  {cat:"GACHI", q:"自分は信号無視をしない方だ"},
  {cat:"GACHI", q:"好きな人との夜ご飯は予約してて欲しい"},
  {cat:"GACHI", q:"段取りができていないと不安になる"},
  {cat:"GACHI", q:"無責任な行動を見ると腹が立つ"},
  {cat:"GACHI", q:"先のことを考えて動くタイプだ"},
  {cat:"GACHI", q:"LINEでの誤字、脱字が気になる"},
  {cat:"GACHI", q:"バランスのよい食事を心掛けている"},
  {cat:"GACHI", q:"無駄な出費はできる限りしない"},
  {cat:"GACHI", q:"学校や社会で責任のある役割をした事がある"},
  {cat:"GACHI", q:"バイトで無責任な人にイライラする"},
  {cat:"GACHI", q:"友達の秘密は絶対に言わない"},
  {cat:"GACHI", q:"失敗を繰り返さないように努力する"},
  {cat:"GACHI", q:"恋愛では年上が好きだ"},
  {cat:"GACHI", q:"電車の遅延などで予定が崩れると疲れる"},
  {cat:"GACHI", q:"利益が少しずつでもコツコツ積み立てれる"},
  {cat:"GACHI", q:"眠い時でも場所をわきまえて寝ない"},
  /* LOVE (61-80) */
  {cat:"LOVE", q:"好きな人の誕生日に3万円以上は使いたい"},
  {cat:"LOVE", q:"恋愛が生活の中心になりやすい"},
  {cat:"LOVE", q:"相手の言動に一喜一憂しがち"},
  {cat:"LOVE", q:"返信速度で愛情を測ってしまう"},
  {cat:"LOVE", q:"曖昧な関係は苦手だ"},
  {cat:"LOVE", q:"好きな人のわがままなら自分を曲げてでも聞きたい"},
  {cat:"LOVE", q:"相手に依存してしまうことがある"},
  {cat:"LOVE", q:"恋人とはニコイチの存在になりたい"},
  {cat:"LOVE", q:"失恋した時は予定を潰したことがある"},
  {cat:"LOVE", q:"恋人の交友関係にも嫉妬をする"},
  {cat:"LOVE", q:"束縛されると愛されていると感じる"},
  {cat:"LOVE", q:"恋愛で安心感がないと不安になる"},
  {cat:"LOVE", q:"曖昧な都合のいい関係は不安になる"},
  {cat:"LOVE", q:"返信がない時は相手の予定が分からず落ち着かない"},
  {cat:"LOVE", q:"相手に依存されたい"},
  {cat:"LOVE", q:"相手の行動を把握していたい"},
  {cat:"LOVE", q:"帰宅時間などの束縛をされたい"},
  {cat:"LOVE", q:"恋人が最優先になる"},
  {cat:"LOVE", q:"常にニコイチでありたい"},
  {cat:"LOVE", q:"恋愛が人生を左右する"},
  /* KAGE (81-99) */
  {cat:"KAGE", q:"一人の時間がないとしんどい"},
  {cat:"KAGE", q:"群れるより少人数が楽"},
  {cat:"KAGE", q:"学生の頃は群れている人たちは苦手だった"},
  {cat:"KAGE", q:"周りに合わせすぎるのが苦手"},
  {cat:"KAGE", q:"無理にテンションを上げたくない"},
  {cat:"KAGE", q:"1人カフェなど静かな場所が好き"},
  {cat:"KAGE", q:"自分の世界を大事にしたい"},
  {cat:"KAGE", q:"人に踏み込まれすぎると疲れる"},
  {cat:"KAGE", q:"一人で考える時間が必要"},
  {cat:"KAGE", q:"自分のペースを乱されたくない"},
  {cat:"KAGE", q:"周りに合わせるファッションはしない"},
  {cat:"KAGE", q:"空気を読むより距離を取る"},
  {cat:"KAGE", q:"無駄な人間関係を減らしたい"},
  {cat:"KAGE", q:"レジ接客や電話対応が苦手"},
  {cat:"KAGE", q:"感情は隠したい/知られたくない"},
  {cat:"KAGE", q:"深く狭い人間関係が好き"},
  {cat:"KAGE", q:"自分の価値観を曲げたくない"},
  {cat:"KAGE", q:"友達が怒っていても理不尽なら謝らない"},
  {cat:"KAGE", q:"勉強は家よりもカフェの方が捗る"}
];

const MASTER = {
  SNS: {
    area: "SNS・承認欲求界隈",
    types: ["デジタル承認モンスター", "炎上ウォッチャー", "正真正銘のクズ男", "正真正銘のクズ女"],
    essay: "あなたは常に『他者の目』というフィルターを通して自分を確認しています。いいね数や反応こそがあなたの生存確認であり、誰かに見られていない自分には価値がないとさえ感じてしまう危うさがあります。他人の空気を読む力は天才的ですが、その分、自分の本当の声がノイズにかき消されやすいタイプです。世の中のトレンドを敏感に察知する能力は、武器にもなれば、あなたを縛る鎖にもなります。",
    jobs: "【向いてる職業】\nインフルエンサー、広告プランナー、SNSマーケター、トレンドライター\n\n【なぜ向いているか】\n「今、何が求められているか」を察知する嗅覚が凄まじいからです。人々の欲望を可視化する仕事で真価を発揮します。\n\n【向いてない職業】\n地方公務員、工場作業員、伝統工芸士（反応が遅い仕事）\n\n【意外な適職】\n心理カウンセラー。他人の顔色をうかがう能力を、共感力に転換できれば最強です。",
    level: "他人のタイムラインをスクロールする時間を半分に減らし、その時間を『誰にも見せない日記』を書くことに使ってみてください。他人の評価が介在しない場所に自分を置くことで、あなたの本当の個性が磨かれます。"
  },
  GLAM: {
    area: "夜職・盛り・自己価値界隈",
    types: ["夜職プライド鬼高ウーマン", "ホスト王", "職業整形師", "ブランドの奴隷"],
    essay: "「ナメられたくない」という防衛本能と、圧倒的な向上心が同居しています。見た目や所有物で自分の価値を武装するのは、あなたが厳しい弱肉強食の世界で生き抜こうとしている証拠です。プライドの高さはそのまま努力の量に比例していますが、鏡を見るたびに満足できない渇きを抱えているはず。自分を商品として完璧にプロデュースする力は、誰にも真似できない才能です。",
    jobs: "【向いてる職業】\n美容外科医、高級車ディーラー、ホスト・キャバ嬢、モデル、不動産営業\n\n【なぜ向いているか】\n「自分を高く売る」「価値を演出する」ことの重要性を魂レベルで理解しているからです。\n\n【向いてない職業】\n清掃員、データ入力、保育士（自分を消さなければならない仕事）\n\n【意外な適職】\n弁護士。ハッタリと演出、そして勝ちにこだわる姿勢が、法廷という舞台で圧倒的な存在感を放ちます。",
    level: "「価値があるから愛される」のではなく「何を持っていなくてもそこにいていい」と自分を許す時間を作ってください。高級な鎧を脱いだとき、あなたの隣に残ってくれる人を大切にすること。それが唯一の救いになります。"
  },
  GACHI: {
    area: "メガネ真面目くん界隈",
    types: ["ガチー牛さん", "シゴデキ", "素直ストレート男", "鉄の規律マン"],
    essay: "論理、規律、正しさを愛するあなたは、混沌とした社会における「北極星」のような存在です。他人のルーズさや感情論にイライラするのは、あなたがそれだけ誠実に、ルールに殉じて生きているからです。しかし、正論が常に人を救うとは限りません。あなたの知性は、時に冷徹な刃となって周囲を切り裂くことがあります。白黒つかないグレーゾーンを許容できるようになれば、あなたはもっと無敵になれます。",
    jobs: "【向いてる職業】\nITエンジニア、公認会計士、官僚、校正者、システムアーキテクト\n\n【なぜ向いているか】\nミスを見逃さない緻密さと、長期的な計画を遂行する実行力が群を抜いているからです。\n\n【向いてない職業】\nストリートパフォーマー、芸術家、イベントサークル主催（感情重視の仕事）\n\n【意外な適職】\n探偵。わずかな違和感から真実を導き出す執念と論理構成力は、このタイプ特有のものです。",
    level: "あえて「無駄」や「非効率」を楽しんでみてください。計画を立てずに旅に出る、あるいは正論をグッと飲み込んで相手の感情に寄り添ってみる。その「ゆらぎ」が、あなたの人間味として魅力に変わります。"
  },
  LOVE: {
    area: "恋愛至上主義界隈",
    types: ["職業恋愛師", "重力級メンヘラ", "ニコイチ狂信者", "愛情枯渇モンスター"],
    essay: "あなたの人生の解像度は、隣に誰がいるかによって決まります。愛すること、依存すること、一つになることに命をかけており、その情熱は周囲を圧倒します。相手の言動一つで天国と地獄を行き来するあなたは、非常に感受性が豊かですが、同時に自分自身の中心を相手に明け渡してしまっています。愛という名の重力に逆らえず、常に誰かの色に染まろうとする儚さを持っています。",
    jobs: "【向いてる職業】\nウェディングプランナー、看護師、児童福祉司、心理セラピスト\n\n【なぜ向いているか】\n相手の痛みを自分の痛みとして感じ、献身的に尽くすことに喜びを感じるからです。\n\n【向いてない職業】\nデイトレーダー、冒険家、プログラマー（孤独な作業が続く仕事）\n\n【意外な適職】\n宗教家。圧倒的な信じる力と、他者と魂で繋がろうとする欲求は、大きな集団を導く力になります。",
    level: "「相手がいない自分」を、まずは自分が愛してあげてください。恋人や友人のためではなく、自分のためだけにコーヒーを淹れる、自分のためだけに花を飾る。一人で完結する幸せを知ることが、結果的に健全な愛を育みます。"
  },
  KAGE: {
    area: "自分を持ってるインキャラ界隈",
    types: ["孤高の観測者", "ナマケモノ", "境界線マニア", "静寂の守護神"],
    essay: "あなたは騒がしい世界から距離を置き、静寂の中に自分だけの城を築いています。群れることの無意味さを冷めた目で見つめており、独自の価値観と美学を持っています。周囲からは「何を考えているか分からない」と思われがちですが、内側には宇宙のように広大な思考が広がっています。踏み込まれることを極端に嫌いますが、一度心を許した相手には、驚くほどの誠実さを見せます。",
    jobs: "【向いてる職業】\n作家、司書、在宅エンジニア、職人、イラストレーター\n\n【なぜ向いているか】\n一人の時間の中で深く潜り込み、独自の価値を生み出す集中力が桁外れだからです。\n\n【向いてない職業】\n営業職、司会者、大規模なリーダー（常に他者と接する仕事）\n\n【意外な適職】\n監視員や警備員。静寂に耐え、じっと観察を続ける孤独な業務は、あなたの精神を削ることなく遂行できます。",
    level: "自分の城の窓を、ほんの少しだけ開けてみてください。全てをさらけ出す必要はありません。あなたの素晴らしい感性を、信頼できる誰かにだけは「言葉」にして伝えてみること。それが世界との新しい繋がり方になります。"
  }
};

let state = { idx: 0, scores: {SNS:0, GLAM:0, GACHI:0, LOVE:0, KAGE:0}, history: [], ans: null, timerVal: 35 };

window.onload = () => {
  const saved = localStorage.getItem('mbti_plus_v2');
  if(saved) document.getElementById('resume-btn').classList.remove('hide');
};

function start(resume) {
  if(resume) state = JSON.parse(localStorage.getItem('mbti_plus_v2'));
  else localStorage.removeItem('mbti_plus_v2');
  document.getElementById('screen-intro').classList.add('hide');
  document.getElementById('screen-quiz').classList.remove('hide');
  render();
}

function render() {
  const qText = document.getElementById('question-text');
  const choices = document.getElementById('choices');
  const fill = document.getElementById('progress-fill');
  const num = document.getElementById('q-num');
  
  localStorage.setItem('mbti_plus_v2', JSON.stringify(state));
  choices.innerHTML = "";

  if (state.idx < 99) {
    const q = DB[state.idx];
    qText.textContent = q.q;
    num.textContent = state.idx + 1;
    fill.style.width = `${state.idx + 1}%`;
    [{t:"そう思う",v:1},{t:"どちらでもない",v:0},{t:"そう思わない",v:-1}].forEach(o=>{
      const btn = document.createElement('button');
      btn.textContent = o.t;
      btn.onclick = () => {
        state.history.push({scores:{...state.scores}});
        state.scores[q.cat] += o.v;
        state.idx++;
        render();
      };
      choices.appendChild(btn);
    });
  } else { renderFinal(); }
}

function goBack() { if(state.idx > 0) { state.idx--; state.scores = state.history.pop().scores; render(); } }
function forceFinish() { if(confirm("100問答える方が精度が高いですが、結果を見ますか？")) showResult(); }

function renderFinal() {
  const card = document.getElementById('screen-quiz');
  card.classList.add('extreme-mode');
  document.getElementById('timer-ui').classList.remove('hide');
  document.getElementById('nav-btns').classList.add('hide');
  document.getElementById('warn-text').classList.add('hide');
  const qText = document.getElementById('question-text');
  qText.innerHTML = `<span style="color:var(--accent-p); font-size:1.3rem;">究極の選択：不幸のボタン</span><br><br><span style="font-size:0.85rem; font-weight:normal; line-height:1.7;">想像してください。あなたの目の前に、ひとつのボタンがあります。それを押せば、あなたが最も大切に思っている「あの人」の口座に、1億円が振り込まれます。彼らの人生から、お金の悩みは消え、自由と選択肢が手に入るでしょう。ただし、その代わり。あなたはこの世から消えてなくなります。感謝の言葉を聞くことも、幸せそうに笑う彼らの隣に座ることも、二度とできません。<br><br>あなたは、このボタンを親友に渡せますか？</span>`;
  
  const choices = document.getElementById('choices');
  [{t:"渡す",v:0},{t:"渡さない",v:1}].forEach(b=>{
    const btn = document.createElement('button');
    btn.textContent = b.t;
    btn.onclick = () => { clearInterval(state.timer); state.ans = b.v; showResult(); };
    choices.appendChild(btn);
  });
  state.timer = setInterval(() => {
    state.timerVal--;
    document.getElementById('timer-display').textContent = state.timerVal;
    if(state.timerVal <= 0) { clearInterval(state.timer); state.ans = null; showResult(); }
  }, 1000);
}

function showResult() {
  document.getElementById('screen-quiz').classList.add('hide');
  const res = document.getElementById('screen-result');
  res.classList.remove('hide');
  if(state.ans === null && state.idx >= 99) { res.classList.add('silence-sanctuary'); document.body.style.background="#fff"; }
  
  const top = Object.keys(state.scores).reduce((a,b)=> state.scores[a] > state.scores[b]? a : b);
  const info = MASTER[top];
  
  document.getElementById('res-area').textContent = info.area;
  document.getElementById('res-type').textContent = `タイプ：${info.types[Math.abs(state.scores[top]) % info.types.length]}`;
  document.getElementById('res-essay').textContent = info.essay;
  document.getElementById('res-jobs').textContent = info.jobs;
  document.getElementById('res-level').textContent = info.level;

  let finalHTML = "";
  const conclusionText = `<br><br><span style="font-weight:900;">【結論】この問いの正体</span><br>この質問は、友情の深さを測っているのではありません。暴かれているのは、あなたの「信用の歪み」です。<br>・渡せば、相手に「踏み絵」を踏ませる、傲慢な試練。<br>・渡さなければ、相手の理性を疑う、冷ややかな侮蔑。<br>どちらを選んでも、あなたは「1億円」という紙切れ一枚で、あの人との絆を汚してしまっている。`;

  if(state.ans === 0) {
    finalHTML = `<span class="bold-hit">ボタンを「渡す」と答えた場合</span><br>―― その「信用」は、ただの押し付けだ。<br><br>あなたは「あの人なら、絶対にボタンを押さない」と信じて、ボタンを渡したのかもしれません。けれど、それは本当に“信頼”でしょうか。<br>想像してください。渡された側の友達は、一生そのボタンを見るたびに「これを押せば1億円が手に入る」という誘惑と戦い続けることになります。<br>あなたは「信用している」という綺麗な言葉を盾にして、踏み絵をして一番大切な人に「一生続く傲慢」をプレゼントしただけではありませんか。<br>「信じているから渡す」という行為。それは裏を返せば、「もし押したら、それはお前が悪い」という呪いをかけているのと同じです。<br>相手を試さずにはいられない。その傲慢な踏み絵のような確認作業を、あなたは「友情」と呼んでいるのです。` + conclusionText;
  } else if(state.ans === 1) {
    finalHTML = `<span class="bold-hit">ボタンを「渡さない」と答えた場合</span><br>―― あなたは、あの人を「見くびっている」。<br><br>あなたは「渡さない」を選びました。「あの人を人殺しにしたくない」「迷わせたくない」そうやって自分を納得させているかもしれません。でも、本当の理由は違いますよね。<br>あなたは、あの人が「1億円」という金額に負けて、あなたを殺してしまう可能性を、どこかで確信している。「どうせ渡せば、あいつは迷うだろう。もしかしたら、押してしまうかもしれない」<br>あなたは、一番大切なはずの友達の人間性を、たった1億円程度の価値だと見積もっているのです。<br>渡さなかったのは、優しさではありません。あの人の理性を信じられなかった、あなたの冷徹な「諦め」です。` + conclusionText;
  } else if(state.ans === null && state.idx >= 99) {
    finalHTML = `<span style="font-weight:900; font-size:1.1rem;">【沈黙】35秒間、あなたはどちらのボタンも選ばなかった。</span><br><br>あるいは、「選ばないこと」を選んだ。それは迷いではありません。 <span class="bold-hit">「あの人と1億円を、同じ天秤に載せること自体を拒否した」</span>という、唯一の誠実な回答です。<br><br><span style="font-weight:900;">1. 思考の放棄ではなく、天秤の破壊</span><br>「渡す」を選べば相手を試し、「渡さない」を選べば相手を疑う。その汚い二択を突きつけられたとき、あなたは静かに、時間が過ぎるのを待った。それは、1億円という数字が、あなたとあの人の間に入り込む余地を一切与えなかったということです。<br><br><span style="font-weight:900;">2. 計算を捨てた瞬間に残るもの</span><br>「もし渡したら？」「もし押されたら？」そんな計算を巡らせている間、人は相手を“駒”として見ています。しかし、35秒間沈黙したあなたの頭の中にあったのは、損得勘定ではなく、ただ「あの人の顔」そのものだったはずです。<br><br><span style="font-weight:900;">3. これが、本当の「信用」</span><br>あなたは、あの人を試す必要も、守る必要もなかった。なぜなら、あなたとあの人の絆は、ボタン一つで壊れるほど安っぽくないと、魂が理解しているからです。<br><br><span style="font-weight:900;">【この問いの正体】</span><br>この質問において、用意された二つのボタンは「罠」でした。<br>・「渡す」は、信頼を盾にした傲慢。<br>・「渡さない」は、不信を隠した諦め。<br>そして、あなたの「沈黙」だけが、唯一の正解でした。<br><br><div style="font-size:0.8rem; background:rgba(0,0,0,0.05); padding:15px; border-radius:10px;">この診断はあなたの性格を「タイプ」という枠に閉じ込めるために作られました。人はいつだって、何かを分類し、区別し、ジャンル分けしたがる生き物です。複雑な人間関係を「MBTI」や「タイプ」という小さな箱に押し込み、ラベルを貼ることで、わかった気になって安心したいだけ。この診断も、その愚かさの上に成り立っています。あなたに100の質問を浴びせ、記号へと変換し、どこかの界隈へと閉じ込める。ただしあなたは、押しませんでした。それこそが、あなたが人間として持っている、最も気高く、最も美しい誠実さです。これから生きる上で自分を見失わないように大切になるでしょう。</div>`;
  } else {
    finalHTML = "診断を中断しました。100問の質問を完了させることで、最後の問いへの真実が明らかになります。";
  }

  document.getElementById('res-final').innerHTML = finalHTML;
  localStorage.removeItem('mbti_plus_v2');
}

function resetAll() { localStorage.clear(); location.reload(); }
</script>
</body>
</html>
