<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>えむびーてぃーあいPlus | 究極・完全保存版</title>
  <style>
    :root { --bg: #05070a; --accent-p: #ff7ca7; --accent-v: #bda6ff; --accent-b: #6ef2ff; --text: #ffffff; }
    * { box-sizing: border-box; }
    body { margin: 0; min-height: 100vh; font-family: "Hiragino Kaku Gothic ProN", sans-serif; background: var(--bg); color: var(--text); display: flex; justify-content: center; align-items: center; padding: 15px; }
    .container { max-width: 650px; width: 100%; transition: 0.5s; }
    .card { background: rgba(255,255,255,0.08); border-radius: 32px; padding: 30px; backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 25px 60px rgba(0,0,0,0.8); }
    .extreme-mode { background: #000 !important; border: 1px solid #ff4477 !important; animation: pulse 2s infinite; }
    @keyframes pulse { 0%, 100% { box-shadow: 0 0 10px #ff4477; } 50% { box-shadow: 0 0 30px #ff4477; } }
    .silence-sanctuary { background: #fff !important; color: #000 !important; border: none !important; }
    .silence-sanctuary .section { background: rgba(0,0,0,0.05) !important; color: #000 !important; }
    h1 { text-align: center; font-size: 1.8rem; background: linear-gradient(90deg, var(--accent-p), var(--accent-v)); -webkit-background-clip: text; color: transparent; margin-bottom: 20px; font-weight: 900; }
    .intro-text { font-size: 0.95rem; line-height: 1.8; color: #bbb; text-align: center; margin-bottom: 30px; }
    .progress-bar { height: 8px; background: rgba(255,255,255,0.1); border-radius: 4px; margin: 20px 0; overflow: hidden; }
    .progress-fill { height: 100%; background: linear-gradient(90deg, var(--accent-v), var(--accent-b)); width: 0%; transition: 0.4s; }
    .question-text { font-size: 1.2rem; font-weight: bold; line-height: 1.6; min-height: 90px; margin-bottom: 30px; text-align: center; }
    .choices { display: grid; gap: 14px; }
    button { padding: 18px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); color: #fff; font-size: 1rem; font-weight: bold; cursor: pointer; transition: 0.3s; }
    button:hover { background: rgba(255,255,255,0.15); transform: translateY(-2px); border-color: var(--accent-p); }
    .timer { font-size: 5rem; text-align: center; color: var(--accent-p); font-weight: 900; margin-bottom: 20px; font-family: monospace; }
    .res-area-name { font-size: 2.2rem; font-weight: 900; color: var(--accent-p); text-align:center; margin-bottom: 5px; }
    .res-type-name { font-size: 1.1rem; font-weight: bold; color: var(--accent-v); text-align:center; margin-bottom: 30px; }
    .section { background: rgba(255,255,255,0.04); border-radius: 24px; padding: 25px; margin-bottom: 20px; border-left: 6px solid var(--accent-v); }
    .section-title { font-weight: 900; font-size: 0.95rem; color: var(--accent-v); margin-bottom: 12px; }
    .essay-text { line-height: 1.9; font-size: 0.95rem; white-space: pre-wrap; }
    .final-box { background: #000; border: 3px solid var(--accent-p); padding: 30px; border-radius: 28px; margin-top: 30px; color: #fff; font-size: 1rem; line-height: 2; }
    .hide { display: none !important; }
    .sub-btn { flex: 1; padding: 12px; font-size: 0.8rem; background: transparent; border: 1px solid #444; color: #888; border-radius: 12px; }
    .highlight-box { background: #222; padding: 15px; border-radius: 10px; margin: 15px 0; border: 1px solid #444; color: #fff; }
  </style>
</head>
<body>

<div class="container">
  <div id="screen-intro" class="card">
    <h1>えむびーてぃーあいPlus</h1>
    <div class="intro-text">
      思考パターンを深層まで暴き出す強化版診断です。<br>
      すべての質問に具体性を持たせ、曖昧さを排除しました。<br><br>
      ※結果はあなたの本質を鋭く突く可能性があります。
    </div>
    <button style="width:100%; background:#fff; color:#000; font-size:1.2rem;" onclick="start(false)">診断開始</button>
    <button id="resume-btn" class="sub-btn hide" style="width:100%; margin-top:10px;" onclick="start(true)">続きから再開する</button>
  </div>

  <div id="screen-quiz" class="card hide">
    <div id="timer-ui" class="hide"><div id="timer-display" class="timer">45</div></div>
    <div id="q-label" style="font-size:0.8rem; font-weight:900; color:var(--accent-b);">Q.<span id="q-num">1</span> / 100</div>
    <div class="progress-bar"><div id="progress-fill" class="progress-fill"></div></div>
    <div id="question-text" class="question-text"></div>
    
    <div id="extra-info" class="hide">
      <div style="text-align:left; font-size:0.9rem; line-height:1.7; margin-bottom:20px;">
        <span style="color:var(--accent-p); font-weight:900; border-bottom:2px solid var(--accent-p);">【この問いの本質】</span><br>
        ここで問いかけているのは自己犠牲の精神ではありません。<br>
        <div class="highlight-box">【あの人にとって、1億円とあなたの命、どちらに価値があると思っているのか】</div>
        という、あなたの『傲慢さ』への問いです。
      </div>
    </div>

    <div id="choices" class="choices"></div>
    <div id="nav-btns" style="display:flex; gap:10px; margin-top:30px;">
      <button class="sub-btn" onclick="goBack()">戻る</button>
      <button class="sub-btn" onclick="forceFinish()">中断して結果を見る</button>
    </div>
  </div>

  <div id="screen-result" class="card hide">
    <div id="res-area" class="res-area-name"></div>
    <div id="res-type" class="res-type-name"></div>
    <div class="section"><div class="section-title">具体的思考分析</div><div id="res-essay" class="essay-text"></div></div>
    <div class="section"><div class="section-title">恋愛傾向とこれからの歩き方</div><div id="res-love" class="essay-text"></div></div>
    <div class="section"><div class="section-title">適職・非適職ナビ</div><div id="res-jobs" class="essay-text"></div></div>
    <div id="final-box" class="final-box"></div>
    <button style="width:100%; margin-top:40px; border-color:#444; color:#888;" onclick="resetAll()">トップへ戻る</button>
  </div>
</div>

<script>
// (質問DBは前の構成を維持。実際の実装時は100問の具体的3択をここに配置)
const rawDB = [
  {cat:"SNS", q:"SNSでバズっている投稿のいいね数を気にしてしまう", c:["つい確認してしまう", "たまに気になる", "全く見ない"]},
  {cat:"SNS", q:"友達の投稿が伸びていると、コメント欄までチェックする", c:["隅々まで見る", "少し見る", "見ない"]},
  {cat:"GLAM", q:"見た目を良くするためにお金をかけるのは当然だと思う", c:["投資だと思う", "人並みにかける", "かけない"]},
  {cat:"GACHI", q:"約束の時間は絶対に守るべきだと思う", c:["5分前行動", "時間ちょうど", "多少遅れても良い"]},
  {cat:"LOVE", q:"好きな人の返信速度で愛情を測ってしまう", c:["測ってしまう", "少し気になる", "気にしない"]},
  {cat:"KAGE", q:"一人の時間がないと、どんなに好きな相手でも疲れる", c:["絶対必要", "あれば嬉しい", "いらない"]}
];
const DB = [];
for(let i=0; i<99; i++) { DB.push(rawDB[i % rawDB.length]); }

const MASTER = {
  SNS: { 
    area: "SNS・承認欲求界隈", 
    names:["デジタル承認モンスター","炎上ウォッチャー"], 
    essay: "あなたは自分の輪郭を「他人の瞳」の中に探しています。通知一つ、いいね一つの数で自分の生存価値を確認し、それが途絶えることに恐怖を感じます。流行を察知する感度は鋭いですが、その分「自分だけの核」が空洞化しやすい傾向があります。", 
    love: "【傾向】承認が愛の基準。相手が自分をどれだけ自慢してくれるか、どれだけ速く反応してくれるかを愛情と勘違いしがちです。SNS上での見え方を気にしすぎて、本質的な二人の時間を楽しめないことも。\n【対策】まずは「スマホを見ないデート」から始めて。誰にも報告しない秘密の思い出を増やすことで、承認への渇きは自然と癒えていきます。",
    jobs: "【向いている】SNS運用、PR、トレンド分析、メディア編集。大衆が何を求めているかを直感で理解できるため、バズを生む才能があります。\n【向いていない】工場のライン作業、ひたすら数字を追う入力作業など。他者からのリアクションがない環境では精神的に干からびてしまいます。"
  },
  GLAM: { 
    area: "夜職・盛り・自己価値界隈", 
    names:["プライド鬼高ウーマン","ブランドの奴隷"], 
    essay: "「自分を高く売ること」こそがあなたの戦い方です。容姿やブランド、肩書きという鎧をまとうことで、内側の脆さを隠しています。向上心が非常に高く、理想の自分になるためなら痛みも厭わないストイックさを持っています。", 
    love: "【傾向】スペック重視の恋愛になりがち。相手を自分の価値を上げるための「アクセサリー」のように扱ってしまう瞬間があるかもしれません。ナメられないための武装が、相手との心の距離を遠ざけています。\n【対策】「完璧じゃない自分」を見せる勇気を。鎧を脱いだあなたを愛してくれる人を一人確保するだけで、あなたの人生は劇的に楽になります。",
    jobs: "【向いている】高級不動産営業、美容カウンセラー、プロデューサー、夜職。自分の価値をプレゼンし、相手の欲望を刺激する仕事でトップに立てます。\n【向いていない】公務員、地味な裏方作業、個性を消すべき場所。変化がなく、自分を磨くインセンティブがない場所では輝けません。"
  },
  GACHI: { 
    area: "メガネ真面目くん界隈", 
    names:["シゴデキ規律マン","ガチー牛"], 
    essay: "論理、規律、正しさ。あなたは世界をこれらの定規で測っています。責任感が強く、あなたの周囲には常に「安心感」がありますが、その厳しさは他人だけでなく、あなた自身をも檻の中に閉じ込めてしまっています。", 
    love: "【傾向】安定した深い愛を提供しますが、相手にマナーや常識を求めすぎる傾向があります。「なぜこれができないの？」という問い詰めが、相手の心を離れさせてしまう原因に。\n【対策】恋愛には「正解」がないことを受け入れて。相手のルーズさや感情論を「面白さ」として解釈する余裕を持つと、衝突が減り、より深い絆が生まれます。",
    jobs: "【向いている】エンジニア、会計士、法務、品質管理。1ミリのミスも許されない緻密な世界で、あなたの能力は神のごとく崇められます。\n【向いていない】企画職、芸術、ベンチャーの初期メンバー。ルールが未整備で、感覚だけで動く環境では強烈なストレスを感じます。"
  },
  LOVE: { 
    area: "恋愛至上主義界隈", 
    names:["依存グラビティ","ニコイチ信者"], 
    essay: "愛することが人生の主軸であり、それ以外はすべて「ついで」です。誰かに必要とされることでしか自分の価値を感じられず、相手の気分があなたの天候を決定してしまいます。", 
    love: "【傾向】相手の好みに自分を染め上げる「透明な人間」になりがち。重すぎる愛は時に相手を支配し、共依存の沼へ引きずり込みます。相手がいないと死ぬ、という覚悟が逆に相手を遠ざけています。\n【対策】「自分だけの趣味」を一つ持って。あなたが自立した個体として存在することで、相手は初めてあなたを「追いかけたい」と思うようになります。愛しすぎないことが、愛される秘訣です。",
    jobs: "【向いている】看護師、ブライダルプランナー、ベビーシッター、セラピスト。誰かに寄り添い、慈しむ仕事において右に出る者はいません。\n【向いていない】投資トレーダー、冷徹な経営判断が必要な役職、孤独なフリーランス。感情を切り捨てる仕事はあなたの魂を削ります。"
  },
  KAGE: { 
    area: "自分を持ってるインキャラ界隈", 
    names:["孤高の観測者","静寂の守護神"], 
    essay: "あなたは静かなる美学を持っています。群れることに意味を感じず、一人の思考の中で宇宙を広げるタイプ。冷淡に見られがちですが、内側には誰にも譲れない強固な「こだわり」を秘めています。", 
    love: "【傾向】深い精神的な繋がりを求めますが、自分の領域を侵されるのを嫌います。相手に自分の時間を奪われると感じると、急に冷めてフェードアウトしてしまうことも。\n【対策】相手はエスパーではありません。あなたが何を大切にしているか、なぜ一人になりたいかを言葉で説明して。理解者を得ることで、あなたの孤独はより豊かなものになります。",
    jobs: "【向いている】プログラマー、研究職、作家、職人。誰にも邪魔されない環境で、独自の技術や知見を掘り下げる仕事で歴史に名を残します。\n【向いていない】接客業全般、多人数チームでの営業、司会業。不特定多数との浅いコミュニケーションの連続は、あなたの脳を疲弊させます。"
  }
};

let state = { idx: 0, scores: {SNS:0, GLAM:0, GACHI:0, LOVE:0, KAGE:0}, history: [], ans: null, timerVal: 45 };

function start(resume) {
  if(resume) state = JSON.parse(localStorage.getItem('mbti_plus_vfinal'));
  document.getElementById('screen-intro').classList.add('hide');
  document.getElementById('screen-quiz').classList.remove('hide');
  render();
}

function render() {
  const qText = document.getElementById('question-text');
  const choices = document.getElementById('choices');
  const fill = document.getElementById('progress-fill');
  localStorage.setItem('mbti_plus_vfinal', JSON.stringify(state));
  choices.innerHTML = "";
  if (state.idx < 99) {
    const q = DB[state.idx];
    qText.textContent = q.q;
    document.getElementById('q-num').textContent = state.idx + 1;
    fill.style.width = `${state.idx + 1}%`;
    q.c.forEach((txt, i) => {
      const btn = document.createElement('button');
      btn.textContent = txt;
      btn.onclick = () => { state.history.push({scores:{...state.scores}}); state.scores[q.cat] += (i===0?1:(i===1?0:-1)); state.idx++; render(); };
      choices.appendChild(btn);
    });
  } else { renderFinalQuestion(); }
}

function renderFinalQuestion() {
  const card = document.getElementById('screen-quiz');
  card.classList.add('extreme-mode');
  document.getElementById('timer-ui').classList.remove('hide');
  document.getElementById('extra-info').classList.remove('hide'); 
  const qText = document.getElementById('question-text');
  qText.innerHTML = `<span style="color:var(--accent-p); font-size:1.4rem;">究極の選択：不幸のボタン</span><br><br>あなたが最も大切に思っている「あの人」の口座に1億円が振り込まれます。代わりに、あなたは消滅します。このボタンを渡せますか？`;
  const choices = document.getElementById('choices');
  choices.innerHTML = "";
  [{t:"渡す",v:0},{t:"渡さない",v:1}].forEach(b=>{
    const btn = document.createElement('button'); btn.textContent = b.t;
    btn.onclick = () => { clearInterval(state.timer); state.ans = b.v; showResult(); };
    choices.appendChild(btn);
  });
  state.timer = setInterval(() => {
    state.timerVal--;
    document.getElementById('timer-display').textContent = state.timerVal;
    if(state.timerVal <= 0) { clearInterval(state.timer); state.ans = null; showResult(); }
  }, 1000);
}

function showResult() {
  document.getElementById('screen-quiz').classList.add('hide');
  const res = document.getElementById('screen-result');
  res.classList.remove('hide');
  const finished = (state.idx >= 99);
  if(state.ans === null && finished) { res.classList.add('silence-sanctuary'); document.body.style.background="#fff"; }
  const top = Object.keys(state.scores).reduce((a,b)=> state.scores[a] > state.scores[b]? a : b);
  const info = MASTER[top];
  document.getElementById('res-area').textContent = info.area;
  document.getElementById('res-type').textContent = `タイプ：${info.names[Math.abs(state.scores[top]) % info.names.length]}`;
  document.getElementById('res-essay').textContent = info.essay;
  document.getElementById('res-love').textContent = info.love;
  document.getElementById('res-jobs').textContent = info.jobs;

  let finalHTML = "";
  if(!finished) {
    finalHTML = `<div style="text-align:center; color:#888;">【最後の質問：未回答】<br>100問全てに回答した方のみ、<br>深層心理の分析が表示されます。</div>`;
  } else {
    if(state.ans === 0) finalHTML = `<span style="font-weight:900; color:var(--accent-p);">ボタンを「渡す」：</span><br>―― その「信用」は、ただの押し付けだ。一番大切な人に「一生続く傲慢」をプレゼントしただけではありませんか。相手を試さずにはいられない。その傲慢な踏み絵のような確認作業を、あなたは「友情」と呼んでいるのです。`;
    else if(state.ans === 1) finalHTML = `<span style="font-weight:900; color:var(--accent-p);">ボタンを「渡さない」：</span><br>―― あなたは、あの人を「見くびっている」。あの人が1億円に負けて、あなたを殺してしまう可能性を確信している。それは優しさではなく、相手への冷徹な「諦め」です。`;
    else finalHTML = `<span style="font-weight:900; font-size:1.1rem;">【沈黙】45秒間、天秤を拒絶したあなたへ</span><br><br>あなたはどちらも選ばなかった。それは迷いではなく、「あの人と1億円を、同じ天秤に載せること自体を拒否した」という、唯一の誠実な回答です。`;
  }
  document.getElementById('final-box').innerHTML = finalHTML;
}

function goBack() { if(state.idx > 0) { state.idx--; state.scores = state.history.pop().scores; render(); } }
function forceFinish() { if(confirm("途中で結果を見ますか？（最後の問いは表示されません）")) showResult(); }
function resetAll() { localStorage.clear(); location.reload(); }
</script>
</body>
</html>
