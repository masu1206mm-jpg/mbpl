<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>えむびーてぃーあいPlus | 究極・完全保存版</title>
  <style>
    :root { --bg: #05070a; --accent-p: #ff7ca7; --accent-v: #bda6ff; --accent-b: #6ef2ff; --text: #ffffff; }
    * { box-sizing: border-box; }
    body { margin: 0; min-height: 100vh; font-family: "Hiragino Kaku Gothic ProN", sans-serif; background: var(--bg); color: var(--text); display: flex; justify-content: center; align-items: center; padding: 10px; }
    .container { max-width: 650px; width: 100%; transition: 0.5s; }
    .card { background: rgba(255,255,255,0.08); border-radius: 32px; padding: 25px; backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 25px 60px rgba(0,0,0,0.8); }
    .extreme-mode { background: #000 !important; border: 1px solid #ff4477 !important; animation: pulse 2s infinite; }
    @keyframes pulse { 0%, 100% { box-shadow: 0 0 10px #ff4477; } 50% { box-shadow: 0 0 30px #ff4477; } }
    .silence-sanctuary { background: #fff !important; color: #000 !important; border: none !important; }
    .silence-sanctuary .section { background: rgba(0,0,0,0.05) !important; color: #000 !important; }
    h1 { text-align: center; font-size: 1.6rem; background: linear-gradient(90deg, var(--accent-p), var(--accent-v)); -webkit-background-clip: text; color: transparent; margin-bottom: 20px; font-weight: 900; }
    .intro-text { font-size: 0.9rem; line-height: 1.7; color: #bbb; text-align: center; margin-bottom: 25px; }
    .progress-bar { height: 6px; background: rgba(255,255,255,0.1); border-radius: 4px; margin: 15px 0; overflow: hidden; }
    .progress-fill { height: 100%; background: linear-gradient(90deg, var(--accent-v), var(--accent-b)); width: 0%; transition: 0.4s; }
    .question-text { font-size: 1.1rem; font-weight: bold; line-height: 1.5; min-height: 80px; margin-bottom: 25px; text-align: center; }
    .choices { display: grid; gap: 12px; }
    button { padding: 16px; border-radius: 18px; border: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); color: #fff; font-size: 0.95rem; font-weight: bold; cursor: pointer; transition: 0.3s; width: 100%; }
    button:hover { background: rgba(255,255,255,0.15); transform: translateY(-2px); border-color: var(--accent-p); }
    .timer { font-size: 4rem; text-align: center; color: var(--accent-p); font-weight: 900; margin-bottom: 15px; font-family: monospace; }
    .res-area-name { font-size: 1.8rem; font-weight: 900; color: var(--accent-p); text-align:center; margin-bottom: 5px; word-break: break-all; }
    .res-type-name { font-size: 1rem; font-weight: bold; color: var(--accent-v); text-align:center; margin-bottom: 25px; }
    .section { background: rgba(255,255,255,0.04); border-radius: 20px; padding: 20px; margin-bottom: 15px; border-left: 5px solid var(--accent-v); }
    .section-title { font-weight: 900; font-size: 0.85rem; color: var(--accent-v); margin-bottom: 10px; }
    .essay-text { line-height: 1.8; font-size: 0.9rem; white-space: pre-wrap; word-break: break-all; }
    .final-box { background: #000; border: 2px solid var(--accent-p); padding: 25px; border-radius: 24px; margin-top: 25px; color: #fff; font-size: 0.95rem; line-height: 1.8; }
    .hide { display: none !important; }
    .sub-btn { flex: 1; padding: 10px; font-size: 0.75rem; background: transparent; border: 1px solid #444; color: #888; border-radius: 12px; }
    .highlight-box { background: #222; padding: 12px; border-radius: 10px; margin: 12px 0; border: 1px solid #444; color: #fff; font-size: 0.85rem; }
    .res-char-img { width: 100%; max-width: 260px; aspect-ratio: 1/1; border-radius: 20px; margin: 0 auto 20px; display: block; object-fit: cover; border: 2px solid var(--accent-v); }
    @media (max-width: 480px) { .card { padding: 20px; border-radius: 24px; } h1 { font-size: 1.4rem; } .res-area-name { font-size: 1.5rem; } }
  </style>
</head>
<body>

<div class="container">
  <div id="screen-intro" class="card">
    <h1>えむびーてぃーあいPlus</h1>
    <div class="intro-text">
      思考パターンを深層まで暴き出す強化版診断です。<br>
      すべての質問に具体性を持たせ、曖昧さを排除しました。<br><br>
      ※結果はあなたの本質を鋭く突く可能性があります。
    </div>
    <button style="background:#fff; color:#000;" onclick="start(false)">診断開始</button>
    <button id="resume-btn" class="sub-btn hide" onclick="start(true)">続きから再開する</button>
  </div>

  <div id="screen-quiz" class="card hide">
    <div id="timer-ui" class="hide"><div id="timer-display" class="timer">45</div></div>
    <div id="q-label" style="font-size:0.75rem; font-weight:900; color:var(--accent-b);">Q.<span id="q-num">1</span> / 100</div>
    <div class="progress-bar"><div id="progress-fill" class="progress-fill"></div></div>
    <div id="question-text" class="question-text"></div>
    <div id="extra-info" class="hide">
      <div style="text-align:left; font-size:0.85rem; line-height:1.6; margin-bottom:15px;">
        <span style="color:var(--accent-p); font-weight:900; border-bottom:2px solid var(--accent-p);">【この問いの本質】</span><br>
        ここで問いかけているのは自己犠牲の精神ではありません。<br>
        <div class="highlight-box">【あの人にとって、1億円とあなたの命、どちらに価値があると思っているのか】</div>
        という、あなたの『傲慢さ』への問いです。
      </div>
    </div>
    <div id="choices" class="choices"></div>
    <div id="nav-btns" style="display:flex; gap:8px; margin-top:25px;">
      <button class="sub-btn" onclick="goBack()">戻る</button>
      <button class="sub-btn" onclick="forceFinish()">中断して結果を見る</button>
    </div>
  </div>

  <div id="screen-result" class="card hide">
    <img id="res-image" class="res-char-img" src="" alt="界隈キャラクター">
    <div id="res-area" class="res-area-name"></div>
    <div id="res-type" class="res-type-name"></div>
    <div class="section"><div class="section-title">具体的思考分析</div><div id="res-essay" class="essay-text"></div></div>
    <div class="section"><div class="section-title">恋愛傾向とこれからの歩き方</div><div id="res-love" class="essay-text"></div></div>
    <div class="section"><div class="section-title">適職・非適職ナビ</div><div id="res-jobs" class="essay-text"></div></div>
    <div id="final-box" class="final-box"></div>
    <button style="margin-top:30px; border-color:#444; color:#888;" onclick="resetAll()">トップへ戻る</button>
  </div>
</div>

<script>
// 100問の具体的質問データをすべて展開
const DB = [
  {cat:"SNS", q:"SNSで流れてきた『自分より不幸そうな投稿』を見て、少しだけ安心したことがある", c:["正直、ある", "無意識に見てるかも", "全くない"]},
  {cat:"GLAM", q:"SNSにアップする写真は、納得がいくまで何十枚も撮り直す", c:["当然の儀式", "たまにこだわる", "一発撮り"]},
  {cat:"GACHI", q:"映画館や飲食店で、マナーを守らない客がいると殺意に近い怒りを感じる", c:["許せない、軽蔑する", "イライラする", "気にしない"]},
  {cat:"LOVE", q:"好きな人の『元恋人』のSNSを特定し、こっそりチェックしたことがある", c:["経験済み", "しようと思った事はある", "興味がない"]},
  {cat:"KAGE", q:"休日に誰とも一言も喋らなくても、寂しさより快適さが勝つ", c:["圧倒的快適", "夕方頃に少し寂しい", "耐えられない"]},
  {cat:"SNS", q:"SNSのフォロワーが減ると、原因を本気で分析・反省する", c:["分析する", "少し落ち込む", "気にしない"]},
  {cat:"GLAM", q:"ブランドロゴが大きく入ったアイテムを持つと、自分の格が上がった気がする", c:["自信が出る", "多少意識する", "興味がない"]},
  {cat:"GACHI", q:"『なんとかなる』という言葉は、準備不足な人間が無責任に使う言葉だと思う", c:["その通りだと思う", "時と場合による", "好きな言葉だ"]},
  {cat:"LOVE", q:"相手が自分を好きか確信が持てないと、わざと冷たくして反応を試してしまう", c:["やってしまう", "自制はするが分かる", "したくない"]},
  {cat:"KAGE", q:"『みんなで協力して』と言われると、一人でやった方が早いとまず思う", c:["即座に思う", "心の中で思う", "協力は大事だ"]},
  {cat:"SNS", q:"バズっている投稿のコメント欄で、必死に反論している人を見ると滑稽だと思う", c:["強く思う", "不毛だなと思う", "熱くていいと思う"]},
  {cat:"GLAM", q:"他人と食事に行くとき、味よりも『店の格』や『映え』を優先して選ぶ", c:["それが正義", "多少は考慮する", "味が全て"]},
  {cat:"GACHI", q:"遅刻をしてきた相手が『ごめん』だけで済ませようとすると、誠意を感じず追求したくなる", c:["徹底的に正す", "顔には出す", "許して流す"]},
  {cat:"LOVE", q:"恋人のスマホに通知が来た際、画面をチラ見して誰からか確認してしまう", c:["無意識に見てる", "見たい衝動を抑える", "見ない"]},
  {cat:"KAGE", q:"自分だけの秘密の隠れ家や、誰にも教えたくないお気に入りの場所がある", c:["いくつかある", "一つはある", "特にない"]},
  {cat:"SNS", q:"『自分磨き』の内容をSNSに報告しないのは、やっていないのと同じだと思う", c:["報告までがセット", "たまに報告する", "自分だけでいい"]},
  {cat:"GLAM", q:"美しくないもの、ダサいものに囲まれていると、自分まで汚染される気がする", c:["激しく同意", "少しは気にする", "気にしない"]},
  {cat:"GACHI", q:"感情論で訴えかけてくる人間とは、話が通じないと感じてシャットアウトする", c:["即座に拒絶", "論理に引き戻す", "寄り添おうとする"]},
  {cat:"LOVE", q:"『愛しているなら、全てを犠牲にして私を優先すべきだ』という考えが、心の奥にある", c:["ある", "理解はできる", "エゴだと思う"]},
  {cat:"KAGE", q:"飲み会よりも、深夜に一人で音楽を聴く方が贅沢だと思う", c:["人生の至福", "たまには必要", "飲み会が楽しい"]},
  // ... (以下、100問目まで同様の形式でデータが続きます)
  // スペースの都合上、以下に残り80問を省略せず流し込みます
  {cat:"SNS", q:"「知り合いの不幸」をニュースや投稿で知った時、まずスマホの充電残量を確認した", c:["無意識に確認した", "少し気になった", "そんなことしない"]},
  {cat:"GLAM", q:"自分の顔が映らない鏡の前を通る時でも、無意識に髪を整えている", c:["常に整えている", "たまにやる", "意識していない"]},
  {cat:"GACHI", q:"「やる気が出ない」という言葉を吐く人間を、心の底で見下している", c:["かなり見下している", "甘えだと思う", "共感できる"]},
  {cat:"LOVE", q:"相手が他の異性と親しげに話しているのを見ると、復讐に近い感情が湧く", c:["激しく湧く", "モヤモヤする", "信頼している"]},
  {cat:"KAGE", q:"エレベーターに他人が乗ってきそうになると、密かに「閉」ボタンを連打する", c:["連打する", "少し焦る", "待ってあげる"]},
  {cat:"SNS", q:"自分への批判コメントを見つけると、その相手のプロフィールを執拗にチェックする", c:["徹底的に洗う", "少し見る", "無視する"]},
  {cat:"GLAM", q:"美容整形に対して「メンテナンス」という感覚で抵抗がない", c:["全くない", "少しはある", "抵抗がある"]},
  {cat:"GACHI", q:"説明書を読まずに機械を操作する人間を見ると、知能を疑ってしまう", c:["疑う", "効率悪いと思う", "自分も読まない"]},
  {cat:"LOVE", q:"「重い」と言われることは、それだけ深く愛している証拠だと思っている", c:["その通りだと思う", "少し思う", "迷惑だと思う"]},
  {cat:"KAGE", q:"自動会計機やセルフレジがある店を優先して選ぶ", c:["絶対選ぶ", "あれば選ぶ", "どっちでもいい"]},
  {cat:"SNS", q:"誰かの炎上騒ぎを見ると、正義感よりも「ワクワク」が勝ってしまう", c:["ワクワクする", "少し気になる", "不快に思う"]},
  {cat:"GLAM", q:"安い服を着ている日は、誰にも会いたくないし外も歩きたくない", c:["本当に嫌だ", "少し引け目を感じる", "気にしない"]},
  {cat:"GACHI", q:"「とりあえず謝る」という態度が、議論を放棄しているようで一番腹が立つ", c:["猛烈に腹が立つ", "イライラする", "場が収まるならいい"]},
  {cat:"LOVE", q:"別れた相手のSNSが更新されると、自分より幸せになっていないか確認する", c:["必ず確認する", "たまに見る", "見ない"]},
  {cat:"KAGE", q:"「週末何してた？」という質問に、正直に答えるのが苦痛で嘘をつく", c:["よくある", "たまにある", "普通に答える"]},
  {cat:"SNS", q:"インフルエンサーが勧めている商品は、中身より「持っていること」が重要だ", c:["重要だと思う", "少しは意識する", "中身が大事"]},
  {cat:"GLAM", q:"自分の体型が1kgでも増えると、この世の終わりのような絶望を感じる", c:["絶望する", "かなり焦る", "気にしない"]},
  {cat:"GACHI", q:"「空気を読む」という文化は、無能が有能の足を引っ張るための道具だ", c:["強く同意する", "一理ある", "空気は読むべき"]},
  {cat:"LOVE", q:"恋人の過去の恋愛人数を、自分より少ないことを願っている", c:["強く願う", "少し気になる", "どうでもいい"]},
  {cat:"KAGE", q:"映画やアニメを1.5倍速以上で見るのが当たり前になっている", c:["当たり前", "たまにやる", "等倍で見る"]},
  {cat:"SNS", q:"フォローバックされないと、数日後にそっとフォローを外す", c:["必ず外す", "たまに整理する", "気にしない"]},
  {cat:"GLAM", q:"食事中も自分の写り方を気にして、カトラリーの持ち方を作法より「見栄え」で変える", c:["やる", "無意識に意識する", "作法が大事"]},
  {cat:"GACHI", q:"占いやスピリチュアルを信じている人間とは、深い付き合いができない", c:["絶対無理", "少し距離を置く", "否定はしない"]},
  {cat:"LOVE", q:"「どこに行きたい？」と聞かれ、相手が自分の行きたい場所を当てるのを待っている", c:["待ってしまう", "たまにやる", "自分から言う"]},
  {cat:"KAGE", q:"誕生日のお祝いメッセージへの返信が面倒で、通知を溜め込んでしまう", c:["かなり溜める", "少し遅れる", "すぐ返す"]},
  {cat:"SNS", q:"DMの既読無視をされると、相手がSNSを更新していないか監視し始める", c:["監視する", "少し気になる", "忘れる"]},
  {cat:"GLAM", q:"ハイブランドの紙袋を捨てられずに部屋に飾ったり、サブバッグとして使っている", c:["使っている", "捨てられない", "即捨てる"]},
  {cat:"GACHI", q:"仕事や勉強の計画が10分でもズレると、その日全てのやる気が失せる", c:["失せる", "少しイライラする", "修正すればいい"]},
  {cat:"LOVE", q:"GPSアプリで相手の居場所を常に把握しておきたい（またはしている）", c:["把握したい", "安心材料になる", "束縛だと思う"]},
  {cat:"KAGE", q:"「明日、急に暇になったから遊ぼう」と言われると、たとえ暇でも断る", c:["断る", "理由をつけて回避", "喜んでいく"]},
  {cat:"SNS", q:"グループラインで自分の発言だけスタンプがつかないと、夜も眠れないほど気になる", c:["猛烈に気になる", "少し不安になる", "気にしない"]},
  {cat:"GLAM", q:"加工アプリを通していない自分の顔を、鏡以外で直視できない", c:["直視できない", "あまり見たくない", "平気"]},
  {cat:"GACHI", q:"「普通は〜」という言葉を使う人間を、自分の価値観を押し付ける傲慢な奴だと思う", c:["強く思う", "少し思う", "自分も使う"]},
  {cat:"LOVE", q:"相手が落ち込んでいる時、心配するより先に「自分への愛が減らないか」を心配する", c:["正直思う", "少しよぎる", "相手を優先する"]},
  {cat:"KAGE", q:"美容院やタクシーでは、なるべく会話をしなくて済むように仕向ける", c:["徹底する", "最小限にする", "楽しく話す"]},
  {cat:"SNS", q:"自分の投稿が伸びなかった時、時間帯やハッシュタグのせいにしている", c:["必ず分析する", "たまに思う", "内容が悪かった"]},
  {cat:"GLAM", q:"お金がない時でも、生活費を削って美容やファッションに注ぎ込む", c:["注ぎ込む", "たまにやる", "絶対にしない"]},
  {cat:"GACHI", q:"マニュアル通りに動かない部下や後輩を見ると、指導するより先に呆れてしまう", c:["呆れる", "厳しく注意する", "寄り添う"]},
  {cat:"LOVE", q:"相手の好みに合わせて自分のファッションや趣味を180度変えることができる", c:["余裕で変える", "多少は合わせる", "自分を貫く"]},
  {cat:"KAGE", q:"実家の家族であっても、同じ部屋に長時間いられると苦痛を感じる", c:["かなり苦痛", "少し疲れる", "平気"]},
  {cat:"SNS", q:"「自分だけの特別な体験」も、誰にも言えないなら価値が半分以下になると思う", c:["本当にそう思う", "少しは思う", "自分だけが知ればいい"]},
  {cat:"GLAM", q:"自分より容姿が劣っていると思う人間といると、優越感で居心地が良くなる", c:["正直、そう", "無意識に感じる", "全く思わない"]},
  {cat:"GACHI", q:"「頑張ればできる」という精神論を、無能が使う最も嫌いな言葉の一つだと思っている", c:["嫌いすぎる", "少し嫌い", "努力は大事"]},
  {cat:"LOVE", q:"喧嘩をした時、自分に非があっても相手が謝るまで口を利かない", c:["絶対謝らない", "つい意地を張る", "自分から謝る"]},
  {cat:"KAGE", q:"他人の不幸話を聞いている時、表情だけ悲しそうにして心では別のことを考えている", c:["よくある", "たまにある", "親身に聞く"]},
  {cat:"SNS", q:"有名人と少しでも繋がりがあることを、チャンスがあれば周囲に自慢したい", c:["絶対自慢する", "匂わせる", "隠しておく"]},
  {cat:"GLAM", q:"鏡に映る自分を見る時間が、1日のうちで合計1時間を超えている", c:["超えている", "30分くらい", "数分"]},
  {cat:"GACHI", q:"ルールを守らない奴は、それだけで「社会から排除されても文句を言えない」と思う", c:["当然だと思う", "少し厳しすぎる", "更生の余地はある"]},
  {cat:"LOVE", q:"「結婚」は愛のゴールではなく、相手を一生縛り付けるための契約だと思っている", c:["その通りだ", "一理ある", "愛の形だ"]},
  {cat:"KAGE", q:"人混みの中を歩く時、周囲の人間を「ただの障害物」だと思っている", c:["思っている", "無意識に避けるだけ", "人間として意識する"]},
  {cat:"SNS", q:"「いいね」の数で、その日の自分の機嫌が左右される", c:["完全に左右される", "少し影響する", "関係ない"]},
  {cat:"GLAM", q:"食事中、美味しさよりも「食べている自分の姿」が綺麗かどうかを気にしている", c:["常に気にしている", "少し意識する", "味に集中する"]},
  {cat:"GACHI", q:"自分より能力が低い上司の指示には、たとえ正しくても従いたくない", c:["絶対嫌だ", "嫌々従う", "仕事と割り切る"]},
  {cat:"LOVE", q:"恋人がいない期間が3ヶ月以上続くと、自分の価値が消滅したような恐怖を感じる", c:["恐怖を感じる", "かなり焦る", "独身最高"]},
  {cat:"KAGE", q:"「困った時はお互い様」という言葉を聞くと、依存される予感がして身構える", c:["激しく身構える", "少し警戒する", "いい言葉だ"]},
  {cat:"SNS", q:"SNSで誰かを褒める時は、それによって「性格が良い自分」を演出したい時だ", c:["演出している", "たまにある", "心から褒める"]},
  {cat:"GLAM", q:"トレンドが過ぎたブランド品を持っている人を見ると、心の中で「終わった人」と判定する", c:["判定する", "少しダサいと思う", "何とも思わない"]},
  {cat:"GACHI", q:"「なんとなく」で決断を下す人間は、ギャンブラーと同じで信用できない", c:["信用できない", "危なっかしい", "直感も大事"]},
  {cat:"LOVE", q:"相手に「私と仕事どっちが大事？」という質問を、真剣にぶつけたことがある（またはしたい）", c:["ある/したい", "冗談でなら", "絶対しない"]},
  {cat:"KAGE", q:"自分に万が一のことがあった時、パソコンやスマホの中身を誰にも見られずに消去する術を用意している", c:["完璧に用意済み", "考えたことはある", "気にしない"]},
  {cat:"SNS", q:"誰かの投稿の「粗探し」をして、心の中で突っ込むのが密かな楽しみだ", c:["かなりの楽しみ", "たまにやる", "そんなことしない"]},
  {cat:"GLAM", q:"人前で泣くのは、計算された「演出」であることが多い", c:["ほぼ計算", "たまに混ざる", "常に本心"]},
  {cat:"GACHI", q:"「夢を追いかける」という言葉は、現実逃避の言い換えに過ぎないと思う", c:["その通りだ", "時と場合による", "夢は素晴らしい"]},
  {cat:"LOVE", q:"好きな人の全てを知りたいので、こっそりポケットの中や財布を確認したことがある", c:["ある", "やりたいが我慢", "絶対しない"]},
  {cat:"KAGE", q:"「友達の友達」を紹介される場面が、人生で最も苦痛な時間の一つだ", c:["地獄だと思う", "かなり苦手", "平気"]},
  {cat:"SNS", q:"ストーリーの閲覧履歴（足跡）をチェックして、特定の誰かが見ているか確認する", c:["毎回必ずする", "たまにする", "しない"]},
  {cat:"GLAM", q:"高い買い物をする時、ローンを組んででも「今」の自分を飾り立てることを選ぶ", c:["迷わず選ぶ", "たまにやる", "貯めてから買う"]},
  {cat:"GACHI", q:"予定通りに進まない旅行なら、行かない方がマシだと思っている", c:["本当にそう思う", "少し思う", "ハプニングも楽しい"]},
  {cat:"LOVE", q:"相手の携帯のパスワードを、偶然を装って盗み見ようとしたことがある", c:["ある", "チャンスがあれば", "絶対しない"]},
  {cat:"KAGE", q:"他人に自分の弱みを見せるくらいなら、一人で抱えて自滅する方がマシだ", c:["圧倒的にそう", "少し思う", "相談する"]},
  {cat:"SNS", q:"「SNS断食」を宣言したものの、数時間後には気になって覗いてしまった", c:["よくある", "一度はある", "決めたら通す"]},
  {cat:"GLAM", q:"自分の死後、遺影に使う写真は最高に盛れているものにしてほしいと指定している", c:["指定済み", "考えている", "何でもいい"]},
  {cat:"GACHI", q:"挨拶を返さない人間は、それだけで人間関係を絶つに値する無礼者だ", c:["絶つ", "かなり嫌う", "忘れてただけかも"]},
  {cat:"LOVE", q:"「一生一緒」という言葉を、相手に何度も言わせることで安心を得ている", c:["言わせている", "たまに確認する", "必要ない"]},
  {cat:"KAGE", q:"自分の葬式に誰も来なくても、静かに終わるならそれが理想だと思っている", c:["理想的だ", "少し寂しい", "賑やかにしてほしい"]},
  {cat:"SNS", q:"有名人の不倫やスキャンダルは、正義の鉄槌が下るのをずっと待っていた感覚になる", c:["スカッとする", "自業自得だと思う", "興味ない"]},
  {cat:"GLAM", q:"鏡を見るたび、「自分はもっと評価されるべき特別な人間だ」と確信している", c:["確信している", "たまに思う", "思わない"]},
  {cat:"GACHI", q:"遅刻の理由が「体調不良」であっても、管理不足として減点対象にする", c:["厳しく減点", "少し引く", "お大事にと思う"]},
  {cat:"LOVE", q:"プレゼントの値段が、自分への愛の重さに比例していると信じている", c:["信じている", "少しは比例する", "気持ちが大事"]},
  {cat:"KAGE", q:"世界が明日終わるとしても、今日までと同じように一人で過ごしたい", c:["一人でいたい", "少し迷う", "誰かといたい"]}
];

const MASTER = {
  SNS: { 
    img: "https://r.jina.ai/i/0681335c05c04803960012727a810d7a",
    area: "SNS・承認欲求界隈", 
    names:["デジタル承認モンスター","炎上ウォッチャー"], 
    essay: "あなたは自分の輪郭を「他人の瞳」の中に探しています。通知一つ、いいね一つの数で自分の生存価値を確認し、それが途絶えることに恐怖を感じます。流行を察知する感度は鋭いですが、その分「自分だけの核」が空洞化しやすい傾向があります。", 
    love: "【傾向】承認が愛の基準。相手が自分をどれだけ自慢してくれるか、どれだけ速く反応してくれるかを愛情と勘違いしがちです。SNS上での見え方を気にしすぎて、本質的な二人の時間を楽しめないことも。\n【対策】まずは「スマホを見ないデート」から始めて。誰にも報告しない秘密の思い出を増やすことで、承認への渇きは自然と癒えていきます。",
    jobs: "【向いている】SNS運用、PR、トレンド分析、メディア編集。大衆が何を求めているかを直感で理解できるため、バズを生む才能があります。\n【向いていない】工場のライン作業、ひたすら数字を追う入力作業など。他者からのリアクションがない環境では精神的に干からびてしまいます。"
  },
  GLAM: { 
    img: "https://r.jina.ai/i/6efd9943505748a39a9c80872efd726b",
    area: "夜職・盛り・自己価値界隈", 
    names:["プライド鬼高ウーマン","ブランドの奴隷"], 
    essay: "「自分を高く売ること」こそがあなたの戦い方です。容姿やブランド、肩書きという鎧をまとうことで、内側の脆さを隠しています。向上心が非常に高く、理想の自分になるためなら痛みも厭わないストイックさを持っています。", 
    love: "【傾向】スペック重視の恋愛になりがち。相手を自分の価値を上げるための「アクセサリー」のように扱ってしまう瞬間があるかもしれません。ナメられないための武装が、相手との心の距離を遠ざけています。\n【対策】「完璧じゃない自分」を見せる勇気を。鎧を脱いだあなたを愛してくれる人を一人確保するだけで、あなたの人生は劇的に楽になります。",
    jobs: "【向いている】高級不動産営業、美容カウンセラー、プロデューサー、夜職。自分の価値をプレゼンし、相手の欲望を刺激する仕事でトップに立てます。\n【向いていない】公務員、地味な裏方作業、個性を消すべき場所。変化がなく、自分を磨くインセンティブがない場所では輝けません。"
  },
  GACHI: { 
    img: "https://r.jina.ai/i/7d363583204e43e7b16606a72661852f",
    area: "メガネ真面目くん界隈", 
    names:["シゴデキ規律マン","ガチー牛"], 
    essay: "論理、規律、正しさ。あなたは世界をこれらの定規で測っています。責任感が強く、あなたの周囲には常に「安心感」がありますが、その厳しさは他人だけでなく、あなた自身をも檻の中に閉じ込めてしまっています。", 
    love: "【傾向】安定した深い愛を提供しますが、相手にマナーや常識を求めすぎる傾向があります。「なぜこれができないの？」という問い詰めが、相手の心を離れさせてしまう原因に。\n【対策】恋愛には「正解」がないことを受け入れて。相手のルーズさや感情論を「面白さ」として解釈する余裕を持つと、衝突が減り、より深い絆が生まれます。",
    jobs: "【向いている】エンジニア、会計士、法務、品質管理。1ミリのミスも許されない緻密な世界で、あなたの能力は神のごとく崇められます。\n【向いていない】企画職、芸術、ベンチャーの初期メンバー。ルールが未整備で、感覚だけで動く環境では強烈なストレスを感じます。"
  },
  LOVE: { 
    img: "https://r.jina.ai/i/05727038e235470588657697472097e3",
    area: "恋愛至上主義界隈", 
    names:["依存グラビティ","ニコイチ信者"], 
    essay: "愛することが人生の主軸であり、それ以外はすべて「ついで」です。誰かに必要とされることでしか自分の価値を感じられず、相手の気分があなたの天候を決定してしまいます。", 
    love: "【傾向】相手の好みに自分を染め上げる「透明な人間」になりがち。重すぎる愛は時に相手を支配し、共依存の沼へ引きずり込みます。相手がいないと死ぬ、という覚悟が逆に相手を遠ざけています。\n【対策】「自分だけの趣味」を一つ持って。あなたが自立した個体として存在することで、相手は初めてあなたを「追いかけたい」と思うようになります。愛しすぎないことが、愛される秘訣です。",
    jobs: "【向いている】看護師、ブライダルプランナー、ベビーシッター、セラピスト。誰かに寄り添い、慈しむ仕事において右に出る者はいません。\n【向いていない】投資トレーダー、冷徹な経営判断が必要な役職、孤独なフリーランス。感情を切り捨てる仕事はあなたの魂を削ります。"
  },
  KAGE: { 
    img: "https://r.jina.ai/i/2d49015c92c943f29013915891392652",
    area: "自分を持ってるインキャラ界隈", 
    names:["孤高の観測者","静寂の守護神"], 
    essay: "あなたは静かなる美学を持っています。群れることに意味を感じず、一人の思考の中で宇宙を広げるタイプ。冷淡に見られがちですが、内側には誰にも譲れない強固な「こだわり」を秘めています。", 
    love: "【傾向】深い精神的な繋がりを求めますが、自分の領域を侵されるのを嫌います。相手に自分の時間を奪われると感じると、急に冷めてフェードアウトしてしまうことも。\n【対策】相手はエスパーではありません。あなたが何を大切にしているか、なぜ一人になりたいかを言葉で説明して。理解者を得ることで、あなたの孤独はより豊かなものになります。",
    jobs: "【向いている】プログラマー、研究職、作家、職人。誰にも邪魔されない環境で、独自の技術や知見を掘り下げる仕事で歴史に名を残します。\n【向いていない】接客業全般、多人数チームでの営業、司会業。不特定多数との浅いコミュニケーションの連続は、あなたの脳を疲弊させます。"
  }
};

let state = { idx: 0, scores: {SNS:0, GLAM:0, GACHI:0, LOVE:0, KAGE:0}, history: [], ans: null, timerVal: 45 };

window.onload = () => {
  const saved = localStorage.getItem('mbti_plus_vfinal');
  if (saved) document.getElementById('resume-btn').classList.remove('hide');
};

function start(resume) {
  if(resume) {
    const saved = localStorage.getItem('mbti_plus_vfinal');
    if(saved) state = JSON.parse(saved);
  } else {
    state = { idx: 0, scores: {SNS:0, GLAM:0, GACHI:0, LOVE:0, KAGE:0}, history: [], ans: null, timerVal: 45 };
    localStorage.removeItem('mbti_plus_vfinal');
  }
  document.getElementById('screen-intro').classList.add('hide');
  document.getElementById('screen-quiz').classList.remove('hide');
  render();
}

function render() {
  const qText = document.getElementById('question-text');
  const choices = document.getElementById('choices');
  const fill = document.getElementById('progress-fill');
  localStorage.setItem('mbti_plus_vfinal', JSON.stringify(state));
  
  choices.innerHTML = "";
  if (state.idx < 99 && state.idx < DB.length) {
    const q = DB[state.idx];
    qText.textContent = q.q;
    document.getElementById('q-num').textContent = state.idx + 1;
    fill.style.width = `${((state.idx + 1)/100)*100}%`;
    q.c.forEach((txt, i) => {
      const btn = document.createElement('button');
      btn.textContent = txt;
      btn.onclick = () => { 
        state.history.push({scores:{...state.scores}}); 
        state.scores[q.cat] += (i===0?1:(i===1?0:-1)); 
        state.idx++; 
        render(); 
      };
      choices.appendChild(btn);
    });
  } else { renderFinalQuestion(); }
}

function renderFinalQuestion() {
  const card = document.getElementById('screen-quiz');
  card.classList.add('extreme-mode');
  document.getElementById('timer-ui').classList.remove('hide');
  document.getElementById('extra-info').classList.remove('hide'); 
  const qText = document.getElementById('question-text');
  qText.innerHTML = `<span style="color:var(--accent-p); font-size:1.3rem;">究極の選択：不幸のボタン</span><br><br>あなたが最も大切に思っている「あの人」の口座に1億円が振り込まれます。代わりに、あなたは消滅します。このボタンを渡せますか？`;
  const choices = document.getElementById('choices');
  choices.innerHTML = "";
  [{t:"渡す",v:0},{t:"渡さない",v:1}].forEach(b=>{
    const btn = document.createElement('button'); btn.textContent = b.t;
    btn.onclick = () => { clearInterval(state.timer); state.ans = b.v; showResult(); };
    choices.appendChild(btn);
  });
  state.timer = setInterval(() => {
    state.timerVal--;
    document.getElementById('timer-display').textContent = state.timerVal;
    if(state.timerVal <= 0) { clearInterval(state.timer); state.ans = null; showResult(); }
  }, 1000);
}

function showResult() {
  document.getElementById('screen-quiz').classList.add('hide');
  const res = document.getElementById('screen-result');
  res.classList.remove('hide');
  const finished = (state.idx >= 99);
  if(state.ans === null && finished) { res.classList.add('silence-sanctuary'); document.body.style.background="#fff"; }
  const top = Object.keys(state.scores).reduce((a,b)=> state.scores[a] > state.scores[b]? a : b);
  const info = MASTER[top];
  document.getElementById('res-image').src = info.img;
  document.getElementById('res-area').textContent = info.area;
  document.getElementById('res-type').textContent = `タイプ：${info.names[Math.abs(state.scores[top]) % info.names.length]}`;
  document.getElementById('res-essay').textContent = info.essay;
  document.getElementById('res-love').textContent = info.love;
  document.getElementById('res-jobs').textContent = info.jobs;
  let finalHTML = "";
  if(!finished) {
    finalHTML = `<div style="text-align:center; color:#888;">【最後の質問：未回答】<br>100問全てに回答した方のみ、<br>深層心理の分析が表示されます。</div>`;
  } else {
    if(state.ans === 0) finalHTML = `<span style="font-weight:900; color:var(--accent-p);">ボタンを「渡す」：</span><br>―― その「信用」は、ただの押し付けだ。一番大切な人に「一生続く傲慢」をプレゼントしただけではありませんか。相手を試さずにはいられない。その傲慢な踏み絵のような確認作業を、あなたは「友情」と呼んでいるのです。`;
    else if(state.ans === 1) finalHTML = `<span style="font-weight:900; color:var(--accent-p);">ボタンを「渡さない」：</span><br>―― あなたは、あの人を「見くびっている」。あの人が1億円に負けて、あなたを殺してしまう可能性を確信している。それは優しさではなく、相手への冷徹な「諦め」です。`;
    else finalHTML = `<span style="font-weight:900; font-size:1.1rem;">【沈黙】45秒間、天秤を拒絶したあなたへ</span><br><br>あなたはどちらも選ばなかった。それは迷いではなく、「あの人と1億円を、同じ天秤に載せること自体を拒否した」という、唯一の誠実な回答です。`;
  }
  document.getElementById('final-box').innerHTML = finalHTML;
}

function goBack() { if(state.idx > 0) { state.idx--; state.scores = state.history.pop().scores; render(); } }
function forceFinish() { if(confirm("途中で結果を見ますか？")) showResult(); }
function resetAll() { localStorage.removeItem('mbti_plus_vfinal'); location.reload(); }
</script>
</body>
</html>
