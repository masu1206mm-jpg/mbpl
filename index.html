<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>えむびーてぃーあいPlus</title>
  <style>
    :root {
      --bg: #05070a;
      --accent-p: #ff7ca7;
      --accent-v: #bda6ff;
      --accent-b: #6ef2ff;
      --text: #ffffff;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0; min-height: 100vh;
      font-family: "Hiragino Kaku Gothic ProN", "Hiragino Sans", sans-serif;
      background: var(--bg); color: var(--text);
      display: flex; justify-content: center; align-items: center; padding: 15px;
    }
    .container { max-width: 650px; width: 100%; transition: 0.5s; }
    .card {
      background: rgba(255,255,255,0.06); border-radius: 32px; padding: 35px;
      backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.1);
      box-shadow: 0 25px 60px rgba(0,0,0,0.8); position: relative;
    }
    .extreme-mode { background: #000 !important; border: 1px solid #444 !important; animation: heart 2s infinite; }
    @keyframes heart { 0%, 100% { box-shadow: 0 0 20px #000; } 50% { box-shadow: 0 0 40px rgba(255,0,85,0.15); } }
    .silence-sanctuary { background: #fff !important; color: #000 !important; border: none !important; }
    .silence-sanctuary .section-title { color: #555 !important; }
    .silence-sanctuary .essay-text { color: #000 !important; }

    h1 { text-align: center; font-size: 1.8rem; background: linear-gradient(90deg, var(--accent-p), var(--accent-v)); -webkit-background-clip: text; color: transparent; margin-bottom: 20px; font-weight: 900; }
    .intro-text { font-size: 0.95rem; line-height: 1.8; color: #bbb; text-align: center; margin-bottom: 30px; }
    
    .progress-bar { height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; margin: 25px 0; overflow: hidden; }
    .progress-fill { height: 100%; background: linear-gradient(90deg, var(--accent-v), var(--accent-b)); width: 0%; transition: 0.3s; }
    
    .question-text { font-size: 1.15rem; font-weight: bold; line-height: 1.7; min-height: 100px; margin-bottom: 25px; }
    .choices { display: grid; gap: 12px; }
    button {
      padding: 18px; border-radius: 18px; border: 1px solid rgba(255,255,255,0.15);
      background: rgba(255,255,255,0.05); color: #fff; font-size: 1rem; font-weight: bold; cursor: pointer; transition: 0.2s;
    }
    button:hover { background: rgba(255,255,255,0.2); transform: translateY(-2px); border-color: var(--accent-v); }

    .timer { font-size: 4rem; text-align: center; color: var(--accent-p); font-weight: 900; margin-bottom: 20px; font-family: monospace; }
    
    .result-badge { display: inline-block; padding: 6px 16px; border-radius: 99px; background: var(--accent-v); color: #000; font-weight: 900; font-size: 0.75rem; margin-bottom: 10px; }
    .type-name { font-size: 2rem; font-weight: 900; color: var(--accent-b); margin-bottom: 25px; }
    .section { background: rgba(255,255,255,0.04); border-radius: 20px; padding: 20px; margin-bottom: 15px; border-left: 5px solid var(--accent-v); }
    .section-title { font-weight: 900; font-size: 0.85rem; color: var(--accent-v); margin-bottom: 10px; }
    .essay-text { line-height: 1.8; font-size: 0.95rem; white-space: pre-wrap; }
    .bold-hit { font-weight: 900; color: var(--accent-p); border-bottom: 2px solid var(--accent-p); }
    
    .hide { display: none !important; }
    .nav-btns { display: flex; gap: 10px; margin-top: 25px; }
    .sub-btn { flex: 1; padding: 12px; font-size: 0.8rem; background: transparent; border: 1px solid #444; color: #888; border-radius: 12px; }
  </style>
</head>
<body>

<div class="container">
  <div id="screen-intro" class="card">
    <h1>えむびーてぃーあいPlus</h1>
    <div class="intro-text">
      3×100問のとある診断の強化版診断になっております。<br>
      無駄な曖昧な5択や質問などを全て具体化しており、あなたの思考パターンを高性能AIで詳細化します。<br><br>
      あなたの人生の参考になると幸いです。
    </div>
    <button style="width:100%; background:#fff; color:#000;" onclick="start(false)">診断開始</button>
    <button id="resume-btn" class="sub-btn hide" style="width:100%; margin-top:10px;" onclick="start(true)">続きから再開する</button>
  </div>

  <div id="screen-quiz" class="card hide">
    <div id="timer-ui" class="hide"><div id="timer-display" class="timer">35</div></div>
    <div id="q-label" style="font-size:0.8rem; font-weight:900; color:var(--accent-b);">Q.<span id="q-num">1</span> / 100</div>
    <div class="progress-bar"><div id="progress-fill" class="progress-fill"></div></div>
    <div id="question-text" class="question-text"></div>
    <div id="choices" class="choices"></div>
    <div id="nav-btns" class="nav-btns">
      <button class="sub-btn" onclick="goBack()">← 戻る</button>
      <button class="sub-btn" onclick="forceFinish()">診断を中断して結果を見る</button>
    </div>
    <p id="warn-text" style="font-size:0.7rem; color:#666; text-align:center; margin-top:10px;">
      ※結果はいつでも出せますが100の質問に答えていただく方が精度が高いです
    </p>
  </div>

  <div id="screen-result" class="card hide">
    <div id="res-badge" class="result-badge"></div>
    <div id="res-type" class="type-name"></div>
    <div class="section"><div class="section-title">思考タイプ</div><div id="res-essay" class="essay-text"></div></div>
    <div class="section"><div class="section-title">適職 / 非適職</div><div id="res-jobs" class="essay-text"></div></div>
    <div class="section"><div class="section-title">LEVEL UP</div><div id="res-level" class="essay-text"></div></div>
    <div id="final-box" style="background:#000; border:2px solid var(--accent-p); padding:20px; border-radius:20px; margin-top:20px;">
      <div class="section-title" style="color:var(--accent-p);">最後の問いへの答え</div>
      <div id="res-final" class="essay-text"></div>
    </div>
    <button style="width:100%; margin-top:30px; border-color:#444; color:#888;" onclick="resetAll()">全てのデータを消去してトップへ</button>
  </div>
</div>

<script>
const DB = [
  /* SNS (1-20) */
  {cat:"SNS", q:"TikTokやX等でバズってる人を見ると、いいね数やコメント数を気にしてしまう"},
  {cat:"SNS", q:"友達の投稿が伸びていると、コメント欄やいいね数を全て確認する"},
  {cat:"SNS", q:"炎上してる話題を一から調べて追う癖がある"},
  {cat:"SNS", q:"ストーリーを上げた後、友達からの反応をずっと待っている"},
  {cat:"SNS", q:"投稿する前に何回も文章や写真を見直す"},
  {cat:"SNS", q:"反応が少ないと投稿を消したくなる"},
  {cat:"SNS", q:"自撮りを上げる事がある"},
  {cat:"SNS", q:"フォロワー数で人を判断してしまうことがある"},
  {cat:"SNS", q:"友達の幸せな報告には嫉妬することが多い"},
  {cat:"SNS", q:"バズっている理由を分析するのが好きだ"},
  {cat:"SNS", q:"SNSでの自分の立ち位置を意識している"},
  {cat:"SNS", q:"承認されていないと不安になる"},
  {cat:"SNS", q:"裏垢等でニュースや話題に対し自分の意見をよく言う"},
  {cat:"SNS", q:"炎上している人を見て「自分ならこうする」と考える"},
  {cat:"SNS", q:"いいね数や友達の反応を気にして投稿する"},
  {cat:"SNS", q:"伸びる時間帯を気にする"},
  {cat:"SNS", q:"有名人に「好きです」などのDMを送った事がある"},
  {cat:"SNS", q:"他人の投稿に批判的なコメントをした事がある"},
  {cat:"SNS", q:"SNSはいかにいいねをたくさん貰うかが重要だ"},
  {cat:"SNS", q:"バズっている投稿のコメントの空気を読むのが得意だ"},
  /* GLAM (21-40) */
  {cat:"GLAM", q:"見た目はお金でどうにかなる"},
  {cat:"GLAM", q:"ここ1年は容姿を磨くことに1番お金をかけている"},
  {cat:"GLAM", q:"可愛い・かっこいいと言われると自信が出る"},
  {cat:"GLAM", q:"第一印象で損したくない"},
  {cat:"GLAM", q:"ナメられたくない気持ちが強い"},
  {cat:"GLAM", q:"整形は努力だと思う"},
  {cat:"GLAM", q:"恋愛において自分の価値は高いと思う"},
  {cat:"GLAM", q:"10万円以上のブランド品を複数所持している"},
  {cat:"GLAM", q:"メイクが上手く行かなくて遅刻した事がある"},
  {cat:"GLAM", q:"自分を安売りしても欲しいものがある"},
  {cat:"GLAM", q:"自分よりブサイクをみると安心する"},
  {cat:"GLAM", q:"整形をしている、もしくは強くしたい"},
  {cat:"GLAM", q:"異性とのご飯は奢られたい"},
  {cat:"GLAM", q:"鏡を見てコンプレックスを感じる"},
  {cat:"GLAM", q:"異性とのご飯は奢りたい"},
  {cat:"GLAM", q:"自分を高く見せるのは悪いことじゃない"},
  {cat:"GLAM", q:"恋愛は女性は顔と男性はお金だと思う"},
  {cat:"GLAM", q:"他人にどう見られているか常に気になる"},
  {cat:"GLAM", q:"自分を下げる発言は冗談でも傷つく"},
  {cat:"GLAM", q:"プライドは高い方だ"},
  /* GACHI (41-60) */
  {cat:"GACHI", q:"約束の時間は絶対守るべきだ"},
  {cat:"GACHI", q:"計画通りに進まないとイライラする"},
  {cat:"GACHI", q:"ミスをすると原因を考える"},
  {cat:"GACHI", q:"人の小さな言い間違いを訂正したくなる"},
  {cat:"GACHI", q:"自分は信号無視をしない方だ"},
  {cat:"GACHI", q:"好きな人との夜ご飯は予約してて欲しい"},
  {cat:"GACHI", q:"段取りができていないと不安になる"},
  {cat:"GACHI", q:"無責任な行動を見ると腹が立つ"},
  {cat:"GACHI", q:"先のことを考えて動くタイプだ"},
  {cat:"GACHI", q:"LINEでの誤字、脱字が気になる"},
  {cat:"GACHI", q:"バランスのよい食事を心掛けている"},
  {cat:"GACHI", q:"無駄な出費はできる限りしない"},
  {cat:"GACHI", q:"学校や社会で責任のある役割をした事がある"},
  {cat:"GACHI", q:"バイトで無責任な人にイライラする"},
  {cat:"GACHI", q:"友達の秘密は絶対に言わない"},
  {cat:"GACHI", q:"失敗を繰り返さないように努力する"},
  {cat:"GACHI", q:"恋愛では年上が好きだ"},
  {cat:"GACHI", q:"電車の遅延などで予定が崩れると疲れる"},
  {cat:"GACHI", q:"利益が少しずつでもコツコツ積み立てれる"},
  {cat:"GACHI", q:"眠い時でも場所をわきまえて寝ない"},
  /* LOVE (61-80) */
  {cat:"LOVE", q:"好きな人の誕生日に3万円以上は使いたい"},
  {cat:"LOVE", q:"恋愛が生活の中心になりやすい"},
  {cat:"LOVE", q:"相手の言動に一喜一憂しがち"},
  {cat:"LOVE", q:"返信速度で愛情を測ってしまう"},
  {cat:"LOVE", q:"曖昧な関係は苦手だ"},
  {cat:"LOVE", q:"好きな人のわがままなら自分を曲げてでも聞きたい"},
  {cat:"LOVE", q:"相手に依存してしまうことがある"},
  {cat:"LOVE", q:"恋人とはニコイチの存在になりたい"},
  {cat:"LOVE", q:"失恋した時は予定を潰したことがある"},
  {cat:"LOVE", q:"恋人の交友関係にも嫉妬をする"},
  {cat:"LOVE", q:"束縛されると愛されていると感じる"},
  {cat:"LOVE", q:"恋愛で安心感がないと不安になる"},
  {cat:"LOVE", q:"曖昧な都合のいい関係は不安になる"},
  {cat:"LOVE", q:"返信がない時は相手の予定が分からず落ち着かない"},
  {cat:"LOVE", q:"相手に依存されたい"},
  {cat:"LOVE", q:"相手の行動を把握していたい"},
  {cat:"LOVE", q:"帰宅時間などの束縛をされたい"},
  {cat:"LOVE", q:"恋人が最優先になる"},
  {cat:"LOVE", q:"常にニコイチでありたい"},
  {cat:"LOVE", q:"恋愛が人生を左右する"},
  /* KAGE (81-99) */
  {cat:"KAGE", q:"一人の時間がないとしんどい"},
  {cat:"KAGE", q:"群めるより少人数が楽"},
  {cat:"KAGE", q:"学生の頃は群れている人たちは苦手だった"},
  {cat:"KAGE", q:"周りに合わせすぎるのが苦手"},
  {cat:"KAGE", q:"無理にテンションを上げたくない"},
  {cat:"KAGE", q:"1人カフェなど静かな場所が好き"},
  {cat:"KAGE", q:"自分の世界を大事にしたい"},
  {cat:"KAGE", q:"人に踏み込まれすぎると疲れる"},
  {cat:"KAGE", q:"一人で考える時間が必要"},
  {cat:"KAGE", q:"自分のペースを乱されたくない"},
  {cat:"KAGE", q:"周りに合わせるファッションはしない"},
  {cat:"KAGE", q:"空気を読むより距離を取る"},
  {cat:"KAGE", q:"無駄な人間関係を減らしたい"},
  {cat:"KAGE", q:"レジ接客や電話対応が苦手"},
  {cat:"KAGE", q:"感情は隠したい/知られたくない"},
  {cat:"KAGE", q:"深く狭い人間関係が好き"},
  {cat:"KAGE", q:"自分の価値観を曲げたくない"},
  {cat:"KAGE", q:"友達が怒っていても理不尽なら謝らない"},
  {cat:"KAGE", q:"勉強は家よりもカフェの方が捗る"}
];

const MASTER = {
  SNS: { area: "SNS・承認欲求界隈", names:["デジタル承認モンスター","炎上ウォッチャー","正真正銘のクズ男","正真正銘のクズ女"], essay:"他者の反応があなたのガソリンです。常に客観的な視点を持ちますが、自分自身の本音を見失いやすい傾向があります。", pro:"インフルエンサー, 広告, 編集", anti:"警備, 事務, 伝統産業", level:"数字に反映されない『自分のための時間』を増やしましょう。" },
  GLAM: { area: "夜職・盛り・自己価値界隈", names:["夜職プライド鬼高ウーマン","ホスト王","職業整形師","ブランドの奴隷"], essay:"自己プロデュース能力が極めて高いタイプ。プライドの高さは美学ですが、時に自分を追い詰めすぎることも。", pro:"美容, 営業, 夜職, 接客", anti: "研究, 介護, 事務", level:"ブランド品ではない、あなたの内面にある強さを信じて。" },
  GACHI: { area: "メガネ真面目くん界隈", names:["ガチー牛さん","シゴデキ","素直ストレート男","鉄の規律マン"], essay:"論理と正義を重んじる信頼の塊。他人のミスに厳しいのは、あなたが自分に厳しく生きているからです。", pro:"IT, 会計, 法務, 官僚", anti:"芸術, 接客, 企画", level:"正論が常に正解ではないことを知ると、人間関係が楽になります。" },
  LOVE: { area: "恋愛至上主義界隈", names:["職業恋愛師","依存グラビティ","ニコイチ信者","愛情枯渇モンスター"], essay:"愛し愛されることが人生の全て。情熱的ですが、依存の強さが自分を削ってしまうこともあります。", pro:"看護, 接客, 心理相談", anti:"投資, 開発, 職人", level:"相手の色に染まるのではなく、自分の色を保ったまま隣にいて。" },
  KAGE: { area: "自分を持ってるインキャラ界隈", names:["孤高の観測者","ナマケモノ","境界線マニア","静寂の守護神"], essay:"一人の聖域を何より大切にするタイプ。周囲に流されない芯の強さを持っていますが、孤立には注意。", pro:"作家, 職人, 開発, 司書", anti:"営業, 司会, 政治", level:"信頼できる人にだけは、自分の城の鍵を預けてみてください。" }
};

let state = { idx: 0, scores: {SNS:0, GLAM:0, GACHI:0, LOVE:0, KAGE:0}, history: [], ans: null, timerVal: 35 };

window.onload = () => {
  const saved = localStorage.getItem('mbti_plus_state');
  if(saved) document.getElementById('resume-btn').classList.remove('hide');
};

function start(resume) {
  if(resume) {
    state = JSON.parse(localStorage.getItem('mbti_plus_state'));
  } else {
    localStorage.removeItem('mbti_plus_state');
  }
  document.getElementById('screen-intro').classList.add('hide');
  document.getElementById('screen-quiz').classList.remove('hide');
  render();
}

function render() {
  const qText = document.getElementById('question-text');
  const choices = document.getElementById('choices');
  const fill = document.getElementById('progress-fill');
  const num = document.getElementById('q-num');
  
  localStorage.setItem('mbti_plus_state', JSON.stringify(state));
  choices.innerHTML = "";

  if (state.idx < 99) {
    const q = DB[state.idx];
    qText.textContent = q.q;
    num.textContent = state.idx + 1;
    fill.style.width = `${state.idx + 1}%`;
    [{t:"そう思う",v:1},{t:"どちらでもない",v:0},{t:"そう思わない",v:-1}].forEach(o=>{
      const btn = document.createElement('button');
      btn.textContent = o.t;
      btn.onclick = () => {
        state.history.push({scores:{...state.scores}});
        state.scores[q.cat] += o.v;
        state.idx++;
        render();
      };
      choices.appendChild(btn);
    });
  } else { renderFinal(); }
}

function goBack() { if(state.idx > 0) { state.idx--; state.scores = state.history.pop().scores; render(); } }
function forceFinish() { if(confirm("100問答える方が精度が高いですが、現在のスコアで結果を表示しますか？")) showResult(); }

function renderFinal() {
  const card = document.getElementById('screen-quiz');
  card.classList.add('extreme-mode');
  document.getElementById('timer-ui').classList.remove('hide');
  document.getElementById('nav-btns').classList.add('hide');
  document.getElementById('warn-text').classList.add('hide');
  const qText = document.getElementById('question-text');
  qText.innerHTML = `<span style="color:var(--accent-p);">究極の選択：不幸のボタン</span><br><br><span style="font-size:0.85rem; font-weight:normal;">あなたが最も大切に思っている「あの人」の口座に1億円が振り込まれます。代わりに、あなたはこの世から消えてなくなります。このボタンを親友に渡せますか？</span>`;
  [{t:"渡す",v:0},{t:"渡さない",v:1}].forEach(b=>{
    const btn = document.createElement('button');
    btn.textContent = b.t;
    btn.onclick = () => { clearInterval(state.timer); state.ans = b.v; showResult(); };
    document.getElementById('choices').appendChild(btn);
  });
  state.timer = setInterval(() => {
    state.timerVal--;
    document.getElementById('timer-display').textContent = state.timerVal;
    if(state.timerVal <= 0) { clearInterval(state.timer); state.ans = null; showResult(); }
  }, 1000);
}

function showResult() {
  document.getElementById('screen-quiz').classList.add('hide');
  const res = document.getElementById('screen-result');
  res.classList.remove('hide');
  if(state.ans === null && state.idx >= 99) { res.classList.add('silence-sanctuary'); document.body.style.background="#fff"; }
  
  const top = Object.keys(state.scores).reduce((a,b)=> state.scores[a] > state.scores[b]? a : b);
  const info = MASTER[top];
  document.getElementById('res-badge').textContent = info.area;
  document.getElementById('res-type').textContent = info.names[Math.abs(state.scores[top]) % info.names.length];
  document.getElementById('res-essay').textContent = info.essay;
  document.getElementById('res-jobs').textContent = `【適】${info.pro} \n【非】${info.anti}`;
  document.getElementById('res-level').textContent = info.level;

  const conclusion = `<div style="margin-top:20px; border-top:1px solid #444; padding-top:15px;"><span style="font-weight:900;">【結論】この問いの正体</span><br>友情の深さを測るものではありません。暴かれているのは、あなたの<span class="bold-hit">「信用の歪み」</span>です。どちらを選んでも、絆を汚してしまっているのです。</div>`;
  
  let finalHTML = "";
  if(state.ans === 0) finalHTML = `<span class="bold-hit">―― その「信用」は、ただの押し付けだ。</span><br>一番大切な人に「一生続く傲慢」をプレゼントし、呪いをかけているのと同じです。` + conclusion;
  else if(state.ans === 1) finalHTML = `<span class="bold-hit">―― あなたは、あの人を「見くびっている」。</span><br>あの人の理性を信じられなかった、あなたの冷徹な「諦め」です。` + conclusion;
  else if(state.ans === null && state.idx >= 99) finalHTML = `<span style="font-weight:900;">【沈黙】あなたはどちらも選ばなかった。</span><br>迷いではなく、天秤に載せること自体を拒否した誠実な回答。あなたの沈黙だけが、唯一の正解でした。<br><br><span style="font-size:0.8rem;">この診断はあなたを箱に入れる愚かな試みでしたが、あなたは押しませんでした。それこそが、あなたが持つ気高く美しい誠実さです。</span>`;
  else finalHTML = "診断が中断されました。100問回答することでこの問いの真実が表示されます。";

  document.getElementById('res-final').innerHTML = finalHTML;
  localStorage.removeItem('mbti_plus_state');
}

function resetAll() { localStorage.clear(); location.reload(); }
</script>
</body>
</html>
