// 2位の要素に基づき、元の文章に「加筆」するための拡張データ
// 元の文章（MASTER）は一切書き換えません。
const EXTENSION = {
  SNS: {
    GLAM: "\n\n【補足分析：SNS×夜職】\nあなたはSNSを「自分という商品のカタログ」として運用しています。一見華やかですが、その裏では常に他者からの査定に晒される恐怖と戦っています。美容やブランド品への投資は、もはや趣味ではなく「市場価値」を維持するための死活問題となっており、画面の中の自分と現実の自分との乖離に、人知れず深い虚無感を抱いています。",
    GACHI: "\n\n【補足分析：SNS×真面目】\nSNSを使いながらも、どこかで「こんなことをしていていいのか」という罪悪感を抱えています。情報の正確性や自分の立ち振る舞いに潔癖なため、炎上やマナー違反に対して人一倍敏感です。承認欲求と「ちゃんとしていたい」という理性の板挟みにあい、投稿一つに何時間も推敲を重ねるような、非常に疲れやすい精神構造です。",
    LOVE: "\n\n【補足分析：SNS×恋愛】\nあなたのSNSは、特定の誰かへのメッセージ、あるいは「愛されている証明」の展示場です。恋人のリアクション一つで投稿の頻度が変わったり、過去の投稿を整理したりします。デジタルの繋がりがそのまま愛情の温度計になっているため、通知が来ない時間は存在を否定されたような感覚に陥り、スマホが手放せない重度の依存状態にあります。",
    KAGE: "\n\n【補足分析：SNS×インキャラ】\nあなたは「繋がっていたいけれど、踏み込まれたくない」という矛盾をSNSで解消しようとしています。現実の人間関係よりも、顔の見えないフォロワーとの適度な距離感に心地よさを感じており、自分のマニアックなこだわりや内面を、匿名性の高い空間でだけ解放しています。リアルな社交を避けるための防壁としてSNSを利用している側面があります。"
  },
  GLAM: {
    SNS: "\n\n【補足分析：夜職×SNS】\n「高く売れる自分」を演出するために、SNSを戦略的な武器として徹底利用しています。フォロワー数や『いいね』は、あなたにとって単なる人気指標ではなく、自分のランクを証明する数字そのものです。常にトレンドの最先端に身を置こうとしますが、それは純粋な興味ではなく、ナメられないための武装であるため、心が休まる瞬間がありません。",
    GACHI: "\n\n【補足分析：夜職×真面目】\n派手な外見や環境とは裏腹に、非常に計算高く、現実的な思考を持っています。美への投資も、感情に流された浪費ではなく「将来への布石」として捉える冷静さがあります。規律に厳しい自分が、混沌とした世界で浮いている感覚を持っており、プロとして完璧に演じきることで自分自身を守っています。",
    LOVE: "\n\n【補足分析：夜職×恋愛】\n「金や外見がすべて」と口では言いながら、心の底では無償の愛を誰よりも激しく渇望しています。仕事や対人関係で見せている強気な仮面を、たった一人の理解者の前でだけ脱ぎ捨てたいと願っていますが、その「弱さ」を見せることが負けだという恐怖心が、幸せな恋愛を遠ざけています。",
    KAGE: "\n\n【補足分析：夜職×インキャラ】\nあなたは、華やかな世界に身を置きながらも、本質的には一人の時間を愛する「はぐれ者」です。人前に出るときの自分は、高度に作り込まれた『作品』であり、本当の自分は誰にも見せない静かな場所に隠しています。周囲の喧騒をどこか冷めた目で見つめており、稼いだ金で孤独を買い取るような生き方を選びがちです。"
  },
  GACHI: {
    SNS: "\n\n【補足分析：真面目×SNS】\n情報の真偽や論理的整合性にこだわりすぎるあまり、SNSのノリや勢いについていけず、密かにストレスを感じています。他人のデタラメな投稿が伸びているのを見ると、世の中の不条理を感じて憤慨することも。デジタルな世界でも「正しさ」を追求しようとして、周囲から煙たがられることを恐れています。",
    GLAM: "\n\n【補足分析：真面目×夜職】\n規律を重んじる性質が、自分磨きに対しても「修行」のような厳しさとして現れます。美しくあることは義務であり、そのための努力を怠る人間を容赦なく切り捨てます。一見すると近寄りがたい完璧主義者ですが、それは自分の内側にある不安定な感情を、強固な外見と秩序で押さえつけている結果です。",
    LOVE: "\n\n【補足分析：真面目×恋愛】\n恋愛を、ルールと責任に基づいた「契約」のように捉える傾向があります。誠実さはピカイチですが、相手の感情的な揺れを「非効率」と切り捨ててしまうため、情緒的な繋がりが希薄になりがちです。計画通りにいかない愛の不確かさに、人知れず恐怖と苛立ちを感じています。",
    KAGE: "\n\n【補足分析：真面目×インキャラ】\n誰にも迷惑をかけず、自分の責任を全うして静かに生きたいと願っています。組織の中では最も信頼されるタイプですが、本音では誰とも関わりたくないと考えています。秩序だった孤独を愛しており、自分の思考ルーチンを乱されることを極端に嫌う、堅物な職人気質です。"
  },
  LOVE: {
    SNS: "\n\n【補足分析：恋愛×SNS】\nあなたの世界は、スマホの画面越しに見る「相手の動向」に支配されています。SNSは愛情を確認するためのツールであり、同時に嫉妬を燃やすための燃料でもあります。自分の幸せを投稿して承認を得ることでしか、愛の実感を確認できない危うさを持っており、常に誰かと比較しては病むサイクルを繰り返しています。",
    GLAM: "\n\n【補足分析：恋愛×夜職】\n「愛されたい」という欲求が、自分を美しく飾り立てる動機になっています。相手に選ばれるために容姿やステータスを磨きますが、その努力が報われないと、激しい自己嫌悪と攻撃性に変わります。自分を安売りしてでも愛を繋ぎ止めようとする、献身という名の執着に囚われています。",
    GACHI: "\n\n【補足分析：恋愛×真面目】\n一度好きになった相手には、狂気的なまでの忠誠心と責任感を持ちます。「愛する＝守る、管理する」という思考が強く、相手の生活すべてを正しい方向へ導こうとして、結果的に重すぎる支配になってしまうことも。裏切りを絶対に許さない、潔癖な愛の形です。",
    KAGE: "\n\n【補足分析：恋愛×インキャラ】\n大勢の前では無口ですが、愛する一人の前でだけは感情が爆発する「秘密の共有」を好みます。二人だけの世界に閉じこもることを理想としており、外部の人間を極端に排除します。閉鎖的な関係ゆえに、一度歯車が狂うと逃げ場がなくなり、共倒れしてしまうリスクを常に抱えています。"
  },
  KAGE: {
    SNS: "\n\n【補足分析：インキャラ×SNS】\n現実でのコミュニケーションを諦めた代わりに、SNSで自分だけの聖域を作っています。顔を出さない発信や、特定の趣味に特化したアカウントで、リアルでは決して見せない熱量を発揮します。デジタルの海に流す独り言だけが、あなたの唯一の呼吸法であり、ネットが切れると本当の孤独が襲ってきます。",
    GLAM: "\n\n【補足分析：インキャラ×夜職】\n美意識という名の高い壁を築き、その中に引きこもっています。自分を磨くのは他人のためではなく、鏡に映る自分だけが納得するため。他人から褒められても「自分のこだわりとは違う」と冷めた反応を示し、理解されないことに逆に安堵を感じるような、屈折した美学を持っています。",
    GACHI: "\n\n【補足分析：インキャラ×真面目】\n「正解のない対人関係」を極端に避け、読書や作業、勉強などの「答えがある世界」に逃げ込みます。非常に理知的で、自分の感情さえも客観的に分析しようとしますが、そのせいで心が動くような実体験を逃しています。感情を殺してシステムの一部になることに適応しすぎています。",
    LOVE: "\n\n【補足分析：インキャラ×恋愛】\n「誰にも理解されなくていい」と強がりながらも、たった一人だけ、自分の沈黙の意味を理解してくれる救世主を待っています。自分からは動かないため、チャンスは少ないですが、一度心を開いた相手には、底なしの信頼と執着を見せます。そのギャップが、相手に取っては神秘的でもあり、重荷にもなります。"
  }
};

function showResult() {
  document.getElementById('screen-quiz').classList.add('hide');
  document.getElementById('screen-result').classList.remove('hide');
  
  // スコア順にソートして1位(top)と2位(sub)を特定
  const sortedKeys = Object.keys(state.scores).sort((a,b) => state.scores[b] - state.scores[a]);
  const top = sortedKeys[0];
  const sub = sortedKeys[1];
  
  const topScore = state.scores[top];
  const catData = MASTER[top];
  const pattern = catData.patterns.find(p => topScore >= p.min);

  // 1. 元々の文章（1文字も変えない）を反映
  document.getElementById('res-area').textContent = catData.area;
  document.getElementById('res-type').textContent = pattern.type;
  
  // 2位との組み合わせ文章を取得（存在する場合のみ）
  const extThinking = (EXTENSION[top] && EXTENSION[top][sub]) ? EXTENSION[top][sub] : "";

  // 2. 文章をセット（元の文章 + 拡張文章）
  document.getElementById('res-thinking').textContent = pattern.thinking + extThinking;
  document.getElementById('res-love').textContent = pattern.love;
  document.getElementById('res-job-yes').textContent = pattern.jobYes;
  document.getElementById('res-job-no').textContent = pattern.jobNo;
  document.getElementById('res-levelup').textContent = pattern.levelup;

  // 3. 運命のボタン判定（既存ロジック）
  let finalMsg = "";
  if(state.ans === 'yes') {
    finalMsg = `<span style="color:#ff4477; font-weight:900;">【運命のボタン：預けると答えたあなた】</span><br><br>
    その「信用」は、ただの押し付けなのではないでしょうか。<br>
    あなたは「あの人なら、絶対にボタンを押さない」と信じて、ボタンを渡したのかもしれません。でも、それは本当の信頼ですか？<br>
    想像してください。渡された側の友達は、一生そのボタンを見るたびに「これを押せば1億円が手に入る」という誘惑と戦い続けることになります。<br>
    あなたは「信用している」という綺麗な言葉を盾にして、一番大切な人に「一生続く拷慢」をプレゼントしただけではないですか？<br>
    「信じているから渡す」という行為。それは裏を返せば、「もし押したら、お前が悪い」という呪いをかけているのと同じです。相手を試さずにはいられない。その傲慢な確認作業を、あなたは「友情」と呼んでいるのです。<br><br>
    <strong>【結論：この問いの正体】</strong><br>
    この質問は、友情の深さなんて聞いていません。暴かれているのは、あなたの<strong>「傲慢さ」</strong>です。<br>
    ・渡せば、相手に「踏み絵」を迫る、傲慢な試練。<br>
    ・渡さなければ、相手の理性を疑う、冷ややかな侮蔑。<br>
    どちらを選んでも、あなたは「1億円」という紙切れ一枚で、あの人との絆を汚してしまった。`;
  } else if(state.ans === 'no') {
    finalMsg = `<span style="color:#ff4477; font-weight:900;">【運命のボタン：預けないと答えたあなた】</span><br><br>
    あなたは、あの人を「見くびって」いるのではありませんか？<br>
    あなたは「預けない」を選びました。「あの人を人殺しにしたくない」「迷わせたくない」と、自分を納得させているかもしれません。でも、本当の理由は違いますよね。<br>
    あなたは、あの人が「1億円」という金額に負けて、あなたを殺してしまうことを確信している。<br>
    「どうせ渡せば、あいつは迷うだろう。もしかしたら、押してしまうかもしれない」<br>
    あなたは、一番大切なはずの友達関係を、たった1億円程度の価値の関係だと見積もっているのです。<br><br>
    <strong>【結論：この問いの正体】</strong><br>
    この質問は、友情の深さなんて聞いていません。暴かれているのは、あなたの<strong>「傲慢さ」</strong>です。<br>
    ・渡せば、相手に「踏み絵」を迫る、傲慢な試練。<br>
    ・渡さなければ、相手の理性を疑う、冷ややかな侮蔑。<br>
    どちらを選んでも、あなたは「1億円」という紙切れ一枚で、友人との絆を汚してしまったのです。`;
  } else if(state.ans === 'silence') {
    finalMsg = `<span style="color:#ff4477; font-weight:900;">【沈黙したあなた】</span><br><br>
    あなたは、どちらのボタンも選べなかった。あるいは、選ばないことを選んだ。それは「迷い」ではありません。<br>
    <strong>「あの人と1億円を、同じ天秤に載せること自体を拒否した」</strong>という、唯一の誠実な回答です。<br><br>
    「渡す」を選れば相手を試し、「渡さない」を選べば相手を疑うことになる。その汚い二択を突きつけられたとき、あなたはただ静かに、時間が過ぎるのを待った。それは、1億円という数字が、あなたとあの人の間に入り込む余地を一切与えなかったということです。<br><br>
    <strong>【この問いの正体】</strong><br>
    この質問において、用意された二つのボタンは「罠」でした。<br>
    ・「渡す」は、信頼を盾にした傲慢。<br>
    ・「渡さない」は、不信を隠した諦め。<br>
    そして、あなたの「沈黙」だけが、唯一の「誠実」です。<br><br>
    <strong>【最後に】</strong><br>
    答えは、用意された選択肢の中にはありません。ですが、世の中は、いつだってあなたに「二択」を迫ります。しかし、本当に大切なものほど, 天秤には載りません。あなたが選んだ<strong>「沈黙」</strong>という回答は、その汚い天秤を根底から否定するものでした。<br><br>
    世の中はアルファベットや点数であなたを分類、区別ジャンル分けしようとしてきます。皮肉なことに、この診断もあなたの性格を「タイプ」という枠に閉じ込めるために作られました。でもこの問題では、あなたは誰にも分類できない「あなた自身」だったのです。<br><br>
    人生は、二択のようで、二択ではない問題が存在し、ヒトはあなたを分類しようとしてきます。ですがヒトはもっと繊細で不明瞭なのではないでしょうか。<br><br>
    その不器用で、優しくて、曖昧で不明瞭な感性を、どうか一生大切にしていてください。`;
  } else {
    finalMsg = "【中断された結果】<br>全質問に回答していないため、深層分析はロックされています。";
  }
  document.getElementById('final-box').innerHTML = finalMsg;
}
