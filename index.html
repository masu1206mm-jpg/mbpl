<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>(偽)えむびーてぃーあいPlus</title>
  <meta name="description" content="3択×100問の超具体派 性格診断。(偽)えむびーてぃーあいPlus" />
  <style>
    :root{
      --bg:#0b0f19;
      --card: rgba(255,255,255,.07);
      --card2: rgba(255,255,255,.10);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.68);
      --line: rgba(255,255,255,.14);
      --shadow: 0 18px 60px rgba(0,0,0,.45);
      --r: 18px;
      --max: 980px;

      --accent:#B99CFF;
      --accent2:#6EF2FF;
      --accent3:#FF7C9E;

      --btn: rgba(255,255,255,.10);
      --btn2: rgba(255,255,255,.18);
      --good:#7CFFB2;
      --warn:#FFD37C;
      --bad:#FF7C9E;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Hiragino Sans", "Noto Sans JP", "Helvetica Neue", Arial;
      color: var(--text);
      background:
        radial-gradient(1200px 600px at 20% 10%, rgba(185,156,255,.22), transparent 60%),
        radial-gradient(900px 500px at 85% 20%, rgba(110,242,255,.18), transparent 60%),
        radial-gradient(900px 600px at 50% 100%, rgba(255,124,158,.10), transparent 60%),
        linear-gradient(180deg, #070a12 0%, #0b0f19 45%, #070a12 100%);
      min-height:100vh;
      padding: 16px;
      padding-bottom: 40px;
    }
    .wrap{max-width:var(--max); margin:0 auto;}
    .top{
      display:flex; align-items:flex-start; justify-content:space-between;
      gap: 12px; margin-top: 6px; margin-bottom: 12px;
    }
    .brand{display:flex; flex-direction:column; gap:6px;}
    .title{
      font-weight: 1000;
      letter-spacing: .02em;
      line-height: 1.08;
      font-size: clamp(20px, 3.5vw, 34px);
      margin:0;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      -webkit-background-clip:text;
      background-clip:text;
      color: transparent;
    }
    .subtitle{
      margin:0;
      font-size: 13px;
      color: var(--muted);
      line-height: 1.5;
    }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.06);
      padding: 8px 10px;
      border-radius: 999px;
      font-size: 12px;
      color: var(--muted);
      user-select:none;
      backdrop-filter: blur(8px);
      white-space:nowrap;
    }
    .card{
      background: var(--card);
      border:1px solid var(--line);
      border-radius: var(--r);
      box-shadow: var(--shadow);
      overflow:hidden;
      backdrop-filter: blur(10px);
    }
    .cardHead{
      padding: 14px 14px 10px;
      border-bottom:1px solid var(--line);
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    .progressWrap{display:flex; flex-direction:column; gap:6px; width:100%;}
    .metaRow{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      color: var(--muted);
      font-size: 12px;
    }
    .bar{
      height: 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.08);
      overflow:hidden;
      border: 1px solid rgba(255,255,255,.10);
    }
    .bar > div{
      height: 100%;
      width: 0%;
      border-radius: 999px;
      background: linear-gradient(90deg, rgba(185,156,255,.95), rgba(110,242,255,.95));
      transition: width .22s ease;
    }
    .content{padding: 14px;}
    .q{
      font-size: clamp(16px, 2.7vw, 20px);
      line-height: 1.45;
      font-weight: 900;
      margin:0 0 12px 0;
    }
    .choices{display:grid; grid-template-columns:1fr; gap:10px;}
    .btn{
      width:100%;
      padding: 14px 14px;
      border-radius: 14px;
      border:1px solid var(--line);
      background: var(--btn);
      color: var(--text);
      text-align:left;
      font-size: 16px;
      line-height: 1.25;
      cursor:pointer;
      transition: transform .06s ease, background .16s ease, border-color .16s ease;
      display:flex; align-items:flex-start; gap:10px;
    }
    .btn:hover{background: var(--btn2); border-color: rgba(255,255,255,.24);}
    .btn:active{transform: scale(.995);}
    .tag{
      font-size: 12px;
      color: rgba(255,255,255,.78);
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.06);
      padding: 3px 8px;
      border-radius: 999px;
      margin-top: 2px;
      flex: 0 0 auto;
    }
    .btnText{flex:1}
    .help{
      margin-top: 10px;
      color: var(--muted);
      font-size: 12px;
      line-height: 1.5;
    }
    .controls{
      margin-top: 14px;
      display:flex; flex-wrap:wrap; gap:10px;
      justify-content:space-between;
      align-items:center;
    }
    .smallBtns{display:flex; gap:10px; flex-wrap:wrap;}
    .ghost{
      padding: 10px 12px;
      border-radius: 999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.06);
      color: var(--muted);
      cursor:pointer;
      font-size: 13px;
    }
    .ghost:hover{background: rgba(255,255,255,.10); color: rgba(255,255,255,.78);}
    .primary{
      padding: 10px 14px;
      border-radius: 999px;
      border: none;
      background: linear-gradient(90deg, rgba(185,156,255,.95), rgba(110,242,255,.95));
      color: #0b0f19;
      font-weight: 1000;
      cursor:pointer;
      font-size: 13px;
    }
    .primary:hover{filter: brightness(1.03);}
    .hide{display:none !important;}

    .grid2{display:grid; grid-template-columns:1fr 1fr; gap:12px;}
    @media (max-width: 760px){ .grid2{grid-template-columns:1fr;} }

    .panel{
      border:1px solid var(--line);
      background: rgba(255,255,255,.06);
      border-radius: 16px;
      padding: 12px;
    }
    .panel h3{
      margin:0 0 8px 0;
      font-size: 14px;
      letter-spacing:.02em;
      color: rgba(255,255,255,.88);
    }
    .panel p, .panel li{
      color: var(--muted);
      font-size: 13px;
      line-height: 1.55;
    }

    .resultTitle{
      font-size: clamp(20px, 4vw, 34px);
      font-weight: 1000;
      margin: 4px 0 10px;
      line-height: 1.12;
      background: linear-gradient(90deg, var(--accent3), var(--accent), var(--accent2));
      -webkit-background-clip:text;
      background-clip:text;
      color: transparent;
    }
    .badgeRow{display:flex; flex-wrap:wrap; gap:8px; margin: 6px 0 12px;}
    .badge{
      display:inline-flex; align-items:center; gap:8px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.08);
      padding: 7px 10px;
      border-radius: 999px;
      font-size: 12px;
      color: rgba(255,255,255,.80);
    }

    .toast{
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%);
      background: rgba(0,0,0,.75);
      color: rgba(255,255,255,.9);
      border: 1px solid rgba(255,255,255,.18);
      border-radius: 999px;
      padding: 10px 14px;
      font-size: 12px;
      opacity: 0;
      pointer-events: none;
      transition: opacity .18s ease, transform .18s ease;
      backdrop-filter: blur(8px);
      z-index: 50;
    }
    .toast.show{
      opacity: 1;
      transform: translateX(-50%) translateY(-4px);
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <div class="brand">
        <h1 class="title">(偽)えむびーてぃーあいPlus</h1>
        <p class="subtitle">3択×100問／全部「具体的な場面」。<b>否定・中立・肯定</b>でサクサク答えるやつ。</p>
      </div>
      <div class="pill">📱スマホ最適化 / 途中保存あり</div>
    </div>

    <div class="card" id="app">
      <div class="cardHead">
        <div class="progressWrap">
          <div class="metaRow">
            <div id="stepText">準備中…</div>
            <div id="saveText">保存: ON</div>
          </div>
          <div class="bar"><div id="barFill"></div></div>
        </div>
      </div>

      <!-- Intro -->
      <div class="content" id="screenIntro">
        <p class="q">ルールは簡単。ぜんぶ “自分が主人公” で想像して選ぶだけ。</p>

        <div class="grid2">
          <div class="panel">
            <h3>✅ 回答形式（3択）</h3>
            <ul>
              <li><b>否定</b>：やらん／避ける／黙る 等</li>
              <li><b>中立</b>：様子見る／相談する／状況次第 等</li>
              <li><b>肯定</b>：やる／向き合う／言う 等</li>
            </ul>
          </div>
          <div class="panel">
            <h3>📌 この診断の狙い</h3>
            <p>
              「性格＝気分」じゃなく、<b>やらかし・緊急・人間関係</b>みたいな場面で出る
              “反応パターン”を拾う。だから質問は多め（100問）。
            </p>
            <p style="margin-top:8px; font-size:11px; color:rgba(255,255,255,.52);">
              ※これは娯楽コンテンツ。医療・心理の専門判断の代わりにはならんよ。
            </p>
          </div>
        </div>

        <div class="controls">
          <div class="smallBtns">
            <button class="ghost" id="resetAll">最初から（データ削除）</button>
          </div>
          <button class="primary" id="startBtn">開始する（100問）</button>
        </div>
      </div>

      <!-- Quiz -->
      <div class="content hide" id="screenQuiz">
        <p class="q" id="qText">質問</p>

        <div class="choices" id="choices"></div>

        <div class="help" id="helpText">
          迷ったら「中立」でOK。盛らなくていい。普段の自分で選んでな。
        </div>

        <div class="controls">
          <div class="smallBtns">
            <button class="ghost" id="backBtn">ひとつ戻る</button>
            <button class="ghost" id="skipBtn">保留（中立で進む）</button>
          </div>
          <button class="primary" id="toResultBtn">結果を見る</button>
        </div>
      </div>

      <!-- Result -->
      <div class="content hide" id="screenResult">
        <div class="badgeRow" id="badges"></div>
        <div class="resultTitle" id="resultTitle">結果</div>

        <div class="grid2">
          <div class="panel">
            <h3>あなたはこういう人物</h3>
            <p id="desc"></p>
          </div>
          <div class="panel">
            <h3>恋愛で向いてる相手</h3>
            <p id="love"></p>
          </div>
          <div class="panel">
            <h3>向いてる職業</h3>
            <p id="job"></p>
          </div>
          <div class="panel">
            <h3>好きそうなYouTube/娯楽</h3>
            <p id="media"></p>
          </div>
        </div>

        <div class="controls">
          <div class="smallBtns">
            <button class="ghost" id="shareBtn">結果テキストをコピー</button>
            <button class="ghost" id="restartBtn">もう一回やる</button>
          </div>
          <button class="primary" id="homeBtn">トップへ</button>
        </div>
      </div>

    </div>
  </div>

  <div class="toast" id="toast">コピーしたで</div>

  <script>
    // ========== 設定 ==========
    const STORAGE_KEY = "fake_mbtiai_plus_v1";

    const $ = (id) => document.getElementById(id);

    function toast(msg){
      const t = $("toast");
      t.textContent = msg;
      t.classList.add("show");
      setTimeout(()=>t.classList.remove("show"), 1200);
    }

    function saveState(state){
      try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }catch(e){}
    }
    function loadState(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        return raw ? JSON.parse(raw) : null;
      }catch(e){ return null; }
    }
    function clearState(){
      try{ localStorage.removeItem(STORAGE_KEY); }catch(e){}
    }

    function showScreen(which){
      $("screenIntro").classList.add("hide");
      $("screenQuiz").classList.add("hide");
      $("screenResult").classList.add("hide");
      $(which).classList.remove("hide");
    }

    function setProgress(i, total){
      const pct = total ? Math.round((i/total)*100) : 0;
      $("barFill").style.width = pct + "%";
      $("stepText").textContent = total ? `Q${Math.min(i+1,total)} / ${total}` : "準備中…";
    }

    // ここから下は「質問100問」「タイプ30個」「採点ロジック」を入れる
    // → パート2で追加する！

    // ========== 仮のデータ（パート2で上書き） ==========
    const QUESTIONS = []; // パート2で100問入れる
    const TYPES = [];     // パート2で30タイプ入れる

    let state = {
      idx: 0,
      answers: [], // -1:否定 / 0:中立 / +1:肯定
      scores: {},  // 各軸の点数（パート2で使う）
      finished: false
    };

    function boot(){
      const saved = loadState();
      if(saved && saved.answers && typeof saved.idx === "number"){
        state = saved;
        $("saveText").textContent = "保存: ON（復元）";
        if(state.finished){
          showScreen("screenResult");
          setProgress(QUESTIONS.length ? QUESTIONS.length-1 : 0, QUESTIONS.length || 100);
        }else if(state.idx > 0 || (state.answers && state.answers.length)){
          showScreen("screenQuiz");
        }else{
          showScreen("screenIntro");
        }
      }else{
        showScreen("screenIntro");
      }
      setProgress(state.idx, QUESTIONS.length || 100);
    }

    // ボタン
    $("resetAll").addEventListener("click", ()=>{
      clearState();
      state = {idx:0, answers:[], scores:{}, finished:false};
      toast("データ消したで");
      showScreen("screenIntro");
      setProgress(0, QUESTIONS.length || 100);
    });

    $("startBtn").addEventListener("click", ()=>{
      showScreen("screenQuiz");
      // 実描画はパート2で実装
      toast("スタート！");
    });

    $("homeBtn").addEventListener("click", ()=>{
      showScreen("screenIntro");
      toast("トップへ");
    });

    $("restartBtn").addEventListener("click", ()=>{
      clearState();
      state = {idx:0, answers:[], scores:{}, finished:false};
      showScreen("screenQuiz");
      toast("リスタート！");
      // 実描画はパート2で
    });

    $("shareBtn").addEventListener("click", async ()=>{
      const text =
`(偽)えむびーてぃーあいPlus 結果
・${$("resultTitle").textContent}
・${$("desc").textContent}`;
      try{
        await navigator.clipboard.writeText(text);
        toast("結果コピーしたで");
      }catch(e){
        toast("コピー失敗…");
      }
    });

    // 戻る/保留/結果 はパート2で動作追加
    $("backBtn").addEventListener("click", ()=> toast("（パート2で実装）"));
    $("skipBtn").addEventListener("click", ()=> toast("（パート2で実装）"));
    $("toResultBtn").addEventListener("click", ()=> toast("（パート2で実装）"));

    boot();
  </script>

  <!-- ここにパート2を貼る -->
  <script>
/* =========================
   (偽)えむびーてぃーあいPlus - PART2
   100問 / 3択 / 保存 / 戻る / 保留 / 結果表示まで
   ※タイプ30種の最終判定＆超長文結果はPART3で
========================= */

(function(){
  // ---------- 100問：全部「具体的な場面」＋3択（否定/中立/肯定）
  // 形式：{ q: "質問文", a: "否定の選択肢", b: "中立の選択肢", c: "肯定の選択肢", axes: {A:1, B:1 ...} }
  // axes は後でスコア計算に使う（PART3で本格利用）。ここでは入れつつ、動作はシンプルにする。

  const QUESTIONS = [
    // 1-10：ミス/やらかし
    { q:"好きな人の前で、盛大におならした。", a:"無言でなかったことにする", b:"笑ってごまかして話題変える", c:"素直に謝って自虐で回収する", axes:{C:1,E:1} },
    { q:"バイト中、お客さんにコーヒーをこぼした。", a:"固まって店長に丸投げ", b:"まず謝って指示を仰ぐ", c:"即謝罪→応急処置→代替案まで提案", axes:{C:1} },
    { q:"LINEを誤爆して、変なスタンプを先生に送った。", a:"既読つく前に消して祈る", b:"軽く謝ってスルーする", c:"ちゃんと謝って用件も一緒に送る", axes:{C:1} },
    { q:"友達の前で滑って転んだ。", a:"痛くないフリして無言", b:"笑って『今の無し』で流す", c:"『今の撮れた？』ってネタにする", axes:{E:1} },
    { q:"大事な提出物、締切1時間前に気づいた。", a:"諦める（言い訳を考える）", b:"とりあえず出来るだけ出す", c:"最速で仕上げて追記説明も添える", axes:{C:1} },
    { q:"遅刻確定。電車が止まった。", a:"今日はもう行かない", b:"親/友達/AIに相談して決める", c:"遅れてでも行く（連絡して向かう）", axes:{C:1} },
    { q:"飲食で、注文を間違えて出した。", a:"バレないなら放置", b:"様子見て、言われたら対応", c:"自分から言って作り直す", axes:{C:1} },
    { q:"友達に『さっきの言い方キツい』と言われた。", a:"『は？』って反発する", b:"一旦黙って落ち着く", c:"謝って、どう言えばよかったか聞く", axes:{A:1} },
    { q:"会話中、相手が明らかにテンション下がった。", a:"気づかないフリで進める", b:"距離感を調整する", c:"『今の嫌やった？』って確認する", axes:{A:1} },
    { q:"大勢の前で名前を呼び間違えた。", a:"スルーする", b:"軽く『ごめん』で済ます", c:"ちゃんと謝って言い直す", axes:{C:1} },

    // 11-20：対人/空気/人間関係
    { q:"グループLINEで自分だけ返事が遅れてる。", a:"放置する", b:"スタンプだけ送る", c:"用件＋一言添えて返す", axes:{A:1} },
    { q:"友達が明らかに病んでそう。", a:"触れない（面倒は避ける）", b:"軽く様子を聞く", c:"時間作ってちゃんと話聞く", axes:{A:1} },
    { q:"悪口大会が始まった。", a:"ノリで参加する", b:"聞くだけで流す", c:"話題変える/離脱する", axes:{A:1} },
    { q:"友達が嘘ついてるっぽい。", a:"証拠集めて詰める", b:"一旦様子見る", c:"優しく確認する", axes:{A:1} },
    { q:"誘いを断りたいけど角が立ちそう。", a:"既読無視で逃げる", b:"やんわり理由つける", c:"正直に理由言って代案出す", axes:{A:1,C:1} },
    { q:"飲み会で輪に入れない人がいる。", a:"気づいてないフリ", b:"様子見ながらちょい話す", c:"こっちから話題振って巻き込む", axes:{A:1,E:1} },
    { q:"自分の話を遮られがち。", a:"黙る（諦める）", b:"隙を見て言い直す", c:"『今の続きいい？』って取り戻す", axes:{E:1} },
    { q:"相手が約束を守らないタイプ。", a:"即切る", b:"距離置く", c:"ルール作って改善試す", axes:{C:1} },
    { q:"恋人が『話聞いてない』って怒ってる。", a:"逆ギレする", b:"謝るけど深掘りしない", c:"何が嫌だったか具体的に聞く", axes:{A:1} },
    { q:"友達に借りた物を壊した。", a:"黙って返す", b:"正直に言って謝る", c:"謝罪＋弁償/代替案を先に出す", axes:{C:1} },

    // 21-30：判断/行動の速さ
    { q:"初めての場所で迷った。", a:"勘で突っ走る", b:"地図見てから動く", c:"人に聞く/確実ルート取る", axes:{C:1} },
    { q:"予定が急に空いた。", a:"家でダラダラする", b:"気分で決める", c:"やることリストを進める", axes:{C:1} },
    { q:"明日テスト、今夜ゲーム誘い。", a:"行く（テストは運）", b:"少しだけ参加", c:"断って勉強する", axes:{C:1} },
    { q:"買うか迷う高い服。", a:"勢いで買う", b:"一晩寝かせる", c:"レビュー/予算/用途で検証して買う", axes:{C:1} },
    { q:"知らん番号から電話。", a:"即出る", b:"一旦出ずに検索する", c:"出ずに留守電/公式へ確認", axes:{C:1} },
    { q:"上司（先生）に質問したいが怖い。", a:"諦める", b:"友達/AIに聞いてから行く", c:"要点まとめて質問しに行く", axes:{E:1,C:1} },
    { q:"人前で発表、直前に緊張MAX。", a:"逃げたい", b:"深呼吸して淡々とやる", c:"むしろテンション上げていく", axes:{E:1} },
    { q:"旅行の計画。", a:"ノープランで行く", b:"ざっくりだけ決める", c:"時刻/予算/予約まで詰める", axes:{C:1} },
    { q:"レストラン、行列が長い。", a:"諦める", b:"周辺候補を探す", c:"並びながら最適化（予約/代替）", axes:{C:1} },
    { q:"新しい趣味始めたい。", a:"まず道具から揃える", b:"体験だけして判断", c:"目的→必要最低限で始める", axes:{C:1} },

    // 31-40：価値観/正義感/こだわり
    { q:"ルール違反して得してる人を見る。", a:"自分もやる", b:"気にしない", c:"納得いかず注意/通報する", axes:{A:1} },
    { q:"友達がズルした。", a:"笑って見逃す", b:"やめときって言う", c:"ちゃんと怒る/距離置く", axes:{A:1} },
    { q:"自分だけ損な役回り。", a:"我慢する", b:"次からは避ける", c:"最初から分担を提案する", axes:{E:1} },
    { q:"人に『それ非常識』と言われた。", a:"ムカつく", b:"一応考える", c:"理由を聞いて調整する", axes:{A:1} },
    { q:"服や髪型、流行より自分。", a:"流行に寄せる", b:"半々にする", c:"自分の軸で決める", axes:{E:1} },
    { q:"SNSで叩かれてる人を見る。", a:"一緒に叩く", b:"スルーする", c:"事実確認して擁護/冷静化する", axes:{A:1} },
    { q:"誰も見てない場所のゴミ。", a:"放置", b:"気分次第", c:"拾って捨てる", axes:{A:1} },
    { q:"友達が陰で悪口言ってたと知る。", a:"晒す/やり返す", b:"距離置く", c:"本人と話して整理する", axes:{A:1} },
    { q:"損得よりも『筋』を通したい。", a:"そんなの要らん", b:"場合による", c:"筋優先で動く", axes:{A:1} },
    { q:"自分のミスを他人に押し付けられた。", a:"我慢する", b:"その場は飲むが後で言う", c:"その場で冷静に訂正する", axes:{E:1} },

    // 41-50：感情の扱い
    { q:"怒りが湧いた時の処理。", a:"即ぶつける", b:"一旦距離置く", c:"言語化して落ち着かせる", axes:{A:1} },
    { q:"落ち込んだ時。", a:"誰にも言わない", b:"仲良い人にだけ言う", c:"積極的に相談する", axes:{E:1} },
    { q:"泣きそうになる場面。", a:"隠す", b:"耐える", c:"出る時は出る（無理しない）", axes:{A:1} },
    { q:"失恋した。", a:"引きずる", b:"時間で回復", c:"切り替えて次行く", axes:{C:1} },
    { q:"褒められた。", a:"照れて否定", b:"ありがとうだけ言う", c:"素直に受け取って喜ぶ", axes:{E:1} },
    { q:"否定された。", a:"すぐ凹む/攻撃する", b:"一旦考える", c:"根拠を聞いて改善する", axes:{C:1} },
    { q:"不安で眠れない夜。", a:"スマホで逃げる", b:"音楽/風呂で落ち着く", c:"原因整理→明日の手順を作る", axes:{C:1} },
    { q:"気まずい空気。", a:"放置", b:"軽い話題で流す", c:"自分から整える", axes:{E:1} },
    { q:"自分の欠点を指摘された。", a:"反発する", b:"半分受け取る", c:"改善策まで聞く", axes:{C:1} },
    { q:"誰かに嫉妬した。", a:"攻撃/悪口", b:"距離置く", c:"自分の課題として分析する", axes:{C:1} },

    // 51-60：リスク/挑戦
    { q:"新しいバイト、時給高いが未知。", a:"怖いから行かない", b:"情報集めて検討", c:"まず応募してみる", axes:{E:1} },
    { q:"投資で含み損。", a:"怖くて全部売る", b:"様子見", c:"理由確認してルール通り動く", axes:{C:1} },
    { q:"友達に起業の誘い。", a:"即断る", b:"条件を聞く", c:"小さく試す", axes:{C:1} },
    { q:"初対面の集まり。", a:"行かない", b:"顔だけ出す", c:"普通に参加して広げる", axes:{E:1} },
    { q:"運転/スポーツで危ない挑戦。", a:"やる", b:"やらない寄り", c:"安全確認してからやる", axes:{C:1} },
    { q:"秘密の告白を聞いた。", a:"誰かに言う", b:"迷う", c:"守る", axes:{A:1} },
    { q:"バイトで責任ある役を任された。", a:"避ける", b:"相談して受ける", c:"受けてやり切る", axes:{C:1} },
    { q:"苦手な人と同じ班。", a:"避ける", b:"必要最低限", c:"役割決めて上手く回す", axes:{C:1,A:1} },
    { q:"苦手科目、単位が危ない。", a:"祈る", b:"最低限やる", c:"計画立てて追い込む", axes:{C:1} },
    { q:"SNSで顔出しするか。", a:"しない", b:"限定で", c:"戦略的にやる", axes:{E:1} },

    // 61-70：コミュ力/表現
    { q:"初対面で何話す？", a:"相手に任せる", b:"共通点探す", c:"自分から話題出す", axes:{E:1} },
    { q:"会議/ゼミで黙ってしまう。", a:"ずっと黙る", b:"終盤だけ言う", c:"早めに一回は発言する", axes:{E:1} },
    { q:"話が長いと言われた。", a:"ムカつく", b:"意識する", c:"結論から言う練習する", axes:{C:1} },
    { q:"謝罪する時。", a:"軽く済ます", b:"必要最小限", c:"原因/再発防止まで言う", axes:{C:1} },
    { q:"誘い文句を考える時。", a:"雑に送る", b:"様子見の文面", c:"相手がYES出しやすい提案", axes:{C:1} },
    { q:"場を盛り上げたい。", a:"無理", b:"相手次第", c:"テンション上げて回す", axes:{E:1} },
    { q:"相手が落ち込んでる。", a:"放置", b:"一言だけ", c:"時間作って寄り添う", axes:{A:1} },
    { q:"ツッコミ/ボケ。", a:"どっちも苦手", b:"たまに", c:"やれる方で回す", axes:{E:1} },
    { q:"知らない話題が出た。", a:"黙る", b:"聞き役", c:"質問して吸収する", axes:{C:1} },
    { q:"褒め方。", a:"あんまり褒めない", b:"たまに", c:"具体的に褒める", axes:{A:1} },

    // 71-80：生活/セルフ管理
    { q:"財布落としたかも。", a:"諦める", b:"探すけど焦らない", c:"即カード停止→警察→ルート確認", axes:{C:1} },
    { q:"部屋が散らかる。", a:"放置", b:"気が向いたら片付ける", c:"ルール作って維持", axes:{C:1} },
    { q:"課題は締切いつ？", a:"当日", b:"前日", c:"余裕持って終わらす", axes:{C:1} },
    { q:"朝型にしたい。", a:"無理", b:"気分で", c:"仕組みで変える", axes:{C:1} },
    { q:"ダイエット/筋トレ。", a:"続かない", b:"ゆるくやる", c:"数値管理でやる", axes:{C:1} },
    { q:"急な体調不良。", a:"気合で行く", b:"様子見", c:"休む/受診/対策する", axes:{C:1} },
    { q:"寝る前スマホ。", a:"2時間", b:"少し", c:"なるべく避ける", axes:{C:1} },
    { q:"支出管理。", a:"してない", b:"ざっくり", c:"記録/予算組む", axes:{C:1} },
    { q:"嫌なタスク。", a:"先延ばし", b:"ギリで", c:"先に片付ける", axes:{C:1} },
    { q:"予定が崩れた。", a:"イラつく", b:"切り替える", c:"代替案を即作る", axes:{C:1} },

    // 81-90：SNS/承認欲求/界隈
    { q:"投稿の反応が少ない。", a:"消す", b:"気にしない", c:"改善して再挑戦", axes:{E:1} },
    { q:"炎上してる話題。", a:"乗る", b:"眺める", c:"距離取る", axes:{A:1} },
    { q:"裏垢で愚痴りたい。", a:"やる", b:"たまに", c:"やらない（別の方法）", axes:{A:1} },
    { q:"キラキラ投稿を見る。", a:"病む", b:"無", c:"参考にする/モチベにする", axes:{C:1} },
    { q:"整形・美容にお金かける？", a:"否定", b:"必要なら", c:"投資としてガッツリ", axes:{E:1} },
    { q:"他人の成功がムカつく。", a:"叩きたくなる", b:"スルー", c:"分析して自分に活かす", axes:{C:1} },
    { q:"バズる企画思いついた。", a:"言うだけで終わる", b:"様子見", c:"すぐ試作して出す", axes:{C:1} },
    { q:"自撮りを上げる頻度。", a:"ほぼ無い", b:"たまに", c:"割と上げる", axes:{E:1} },
    { q:"DMで知らん人から褒め。", a:"無視", b:"短く返す", c:"丁寧に返す", axes:{A:1} },
    { q:"悪口系の流れが来た。", a:"参戦", b:"傍観", c:"止める/離脱", axes:{A:1} },

    // 91-100：恋愛/将来/決断
    { q:"告白するなら。", a:"しない", b:"タイミング待つ", c:"行く", axes:{E:1} },
    { q:"相手が返信遅い。", a:"詰める", b:"様子見", c:"自分のペース保つ", axes:{A:1} },
    { q:"恋人が嫉妬してきた。", a:"面倒で冷める", b:"一旦落ち着かせる", c:"ルール作って安心させる", axes:{C:1,A:1} },
    { q:"将来やりたいことが曖昧。", a:"考えない", b:"そのうち", c:"仮でも目標置く", axes:{C:1} },
    { q:"大事な決断、怖い。", a:"避ける", b:"相談して決める", c:"情報集めて腹括る", axes:{C:1} },
    { q:"ミスを繰り返す自分。", a:"自己嫌悪で止まる", b:"気をつけるで終わる", c:"仕組みを変える", axes:{C:1} },
    { q:"周りに流されがち。", a:"流される", b:"半々", c:"自分の軸で選ぶ", axes:{E:1} },
    { q:"成功者の話を聞いた。", a:"嫉妬", b:"ふーん", c:"取り入れる", axes:{C:1} },
    { q:"『お前って結局どんな人？』と言われた。", a:"答えられん", b:"ざっくり言う", c:"言語化して言う", axes:{C:1} },
    { q:"100問終えた自分に一言。", a:"疲れた、もう無理", b:"まあ頑張った", c:"自分の傾向わかった", axes:{C:1} },
  ];

  // パート1の仮配列を上書き
  window.QUESTIONS = QUESTIONS;

  // ---------- UI描画 ----------
  function renderQuestion(){
    const total = QUESTIONS.length;
    if(state.idx >= total){
      state.idx = total-1;
    }
    setProgress(state.idx, total);

    const qObj = QUESTIONS[state.idx];
    $("qText").textContent = qObj.q;

    const wrap = $("choices");
    wrap.innerHTML = "";

    const opts = [
      { tag:"否定", text:qObj.a, val:-1 },
      { tag:"中立", text:qObj.b, val: 0 },
      { tag:"肯定", text:qObj.c, val:+1 },
    ];

    opts.forEach((o)=>{
      const btn = document.createElement("button");
      btn.className = "btn";
      btn.innerHTML = `<span class="tag">${o.tag}</span><div class="btnText">${escapeHtml(o.text)}</div>`;
      btn.addEventListener("click", ()=> choose(o.val));
      wrap.appendChild(btn);
    });

    // 進捗文言
    $("toResultBtn").textContent = state.idx >= total-1 ? "結果を見る（確定）" : "結果を見る（途中でも可）";
  }

  function escapeHtml(s){
    return String(s).replace(/[&<>"']/g, m => ({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
    }[m]));
  }

  // ---------- 採点（PART3で本格化するけど、今は軸を軽く積む） ----------
  function addScore(qObj, val){
    const axes = qObj.axes || {};
    for(const k in axes){
      state.scores[k] = (state.scores[k] || 0) + axes[k]*val;
    }
  }

  // ---------- 回答 ----------
  function choose(val){
    const qObj = QUESTIONS[state.idx];
    const prev = state.answers[state.idx];

    // もし戻って選び直しなら、前の分を差し引き
    if(typeof prev === "number"){
      addScore(qObj, -prev);
    }
    state.answers[state.idx] = val;
    addScore(qObj, val);

    // 次へ
    if(state.idx < QUESTIONS.length-1){
      state.idx++;
      saveState(state);
      renderQuestion();
    }else{
      // 最後までいったら結果へ（結果はPART3で豪華になる）
      saveState(state);
      goResult();
    }
  }

  // ---------- 戻る / 保留 ----------
  function back(){
    if(state.idx <= 0) return toast("これ以上戻れん");
    state.idx--;
    saveState(state);
    renderQuestion();
  }

  function skipNeutral(){
    // 今の問題を「中立」で確定して進む
    choose(0);
  }

  // ---------- 結果（暫定） ----------
  function goResult(){
    state.finished = true;
    saveState(state);

    showScreen("screenResult");

    // PART3で30タイプ＆長文出力に差し替える
    const answered = state.answers.filter(v=>typeof v==="number").length;
    $("badges").innerHTML =
      `<div class="badge">回答数 ${answered} / ${QUESTIONS.length}</div>` +
      `<div class="badge">保存ON</div>` +
      `<div class="badge">結果はPART3で超強化</div>`;

    $("resultTitle").textContent = "暫定：診断準備OK（PART3で完成）";
    $("desc").textContent =
      "ここまでで100問の回答・保存・戻る・保留が動く状態になった。次のPART3で、30タイプ（アホい名前）と、恋愛/職業/YouTube嗜好までの超長文結果を確定させる。";
    $("love").textContent = "（PART3で出す）";
    $("job").textContent  = "（PART3で出す）";
    $("media").textContent= "（PART3で出す）";
  }

  // ---------- ボタン配線（PART1の仮を上書き） ----------
  $("startBtn").addEventListener("click", ()=>{
    // 途中復帰したい場合
    if(state.answers && state.answers.length){
      showScreen("screenQuiz");
      renderQuestion();
      toast("続きから再開");
      return;
    }
    state.idx = 0;
    state.answers = [];
    state.scores = {};
    state.finished = false;
    saveState(state);
    showScreen("screenQuiz");
    renderQuestion();
    toast("スタート！");
  });

  $("restartBtn").addEventListener("click", ()=>{
    clearState();
    state = {idx:0, answers:[], scores:{}, finished:false};
    saveState(state);
    showScreen("screenQuiz");
    renderQuestion();
    toast("最初から！");
  });

  $("backBtn").addEventListener("click", back);
  $("skipBtn").addEventListener("click", skipNeutral);

  $("toResultBtn").addEventListener("click", ()=>{
    goResult();
  });

  // ---------- boot後に復元描画 ----------
  // PART1のbootで画面だけ切り替わってるから、クイズ画面なら描画する
  setTimeout(()=>{
    if(!$("screenQuiz").classList.contains("hide")){
      renderQuestion();
    }
    if(state.finished){
      goResult();
    }
  }, 0);

})();
</script>
  <!-- ここにパート3を貼る -->
  <script>
/* =========================
   (偽)えむびーてぃーあいPlus - PART3（完成版）
   ・結果が出ないバグ修正（toResultBtnのクリックが関数化されてない問題）
   ・5界隈×6タイプ=30タイプ
   ・E/C/A（外向・計画・共感）スコア + 界隈推定
========================= */
(function(){
  // ---- もしPART2がwindow.QUESTIONSを生やしてるなら優先 ----
  const Q = (window.QUESTIONS && window.QUESTIONS.length) ? window.QUESTIONS : (typeof QUESTIONS !== "undefined" ? QUESTIONS : []);
  if(!Q || !Q.length){
    console.warn("QUESTIONSが見つからん。PART2が先に読み込まれてるか確認してな。");
  }

  // ---- 5界隈×6タイプ（30）----
  // ※名前は「映え」優先やけど、いつでも差し替えOK
  const CATS = [
    { key:"SNS",  name:"SNS界隈" },
    { key:"GLAM", name:"夜職・盛り界隈" },
    { key:"GACHI",name:"堅実ガチ勢界隈" },
    { key:"LOVE", name:"恋愛脳界隈" },
    { key:"KAGE", name:"省エネ隠居界隈" },
  ];

  // 6タイプ/界隈（合計30）
  const TYPES = [
    // --- SNS界隈 6 ---
    {cat:"SNS", name:"Twitter裏垢悪口マシーン", badges:["SNS界隈","言語化強め"], desc:"感情を心の中で腐らせず、言葉にして処理するタイプ。良くも悪くも“言語”が武器。面白いけど、疲れてる時は言葉が鋭くなる。",
      love:"一言で傷つかず、ちゃんと会話で整えてくれる人。境界線（言っていいこと/ダメなこと）を一緒に作れる相手が相性◎。",
      job:"編集/ライター/運用/リサーチ。『言葉で価値を作る』系の仕事に向く。",
      media:"考察・解説・炎上分析・ディベート系。コメント欄も読む。" },
    {cat:"SNS", name:"インプレ古事記（戦略型）", badges:["SNS界隈","最適化"], desc:"数字・反応・見せ方を“ゲーム”として捉えやすい。伸ばすために試行錯誤できるし、勝ち筋を見つけるのが早い。",
      love:"応援しつつ、暴走しそうな時にブレーキを踏める人。『現実も大事』と言ってくれる相手。",
      job:"マーケ/広告/企画/データ分析。ABテストが得意。",
      media:"伸びる理由解説、マーケ系YouTube、ビジネスバラエティ。" },
    {cat:"SNS", name:"自撮り研究所（研究員）", badges:["SNS界隈","改善癖"], desc:"“映え”をセンスじゃなく研究で作るタイプ。盛り方・光・角度・文章を改善して強くなる。",
      love:"褒め上手で、努力をちゃんと見てくれる人。外見だけじゃなく中身の頑張りも拾ってくれる相手。",
      job:"デザイン/撮影/編集/美容系。改善→反映が早い。",
      media:"美容・垢抜け・検証系、ビフォアフ系、短尺も好き。" },
    {cat:"SNS", name:"炎上回避の危機管理人", badges:["SNS界隈","慎重派"], desc:"やらかしを極端に嫌う。人の地雷も察しやすいから守りが固い。安全運転で信用を積むタイプ。",
      love:"安心感のある人。情緒が安定してて、話し合いができる相手が向く。",
      job:"総務/法務寄り、CS、リスク管理、運用保守。",
      media:"ニュース、ガジェット、丁寧な解説系。" },
    {cat:"SNS", name:"リプ欄の王（コミュ強）", badges:["SNS界隈","外向寄り"], desc:"“人の温度”で場を回せるタイプ。会話の回転が速く、反応も早い。空気を明るくできる。",
      love:"一緒にノれる人。やきもち焼きすぎない相手が◎。",
      job:"営業/広報/イベント/接客。人前で強い。",
      media:"バラエティ、配信、街ブラ、即興トーク系。" },
    {cat:"SNS", name:"ROM専の観測者", badges:["SNS界隈","内省"], desc:"情報は見るけど、出すのは慎重。言葉を出す前に頭の中で何回も検証するタイプ。深い洞察が出やすい。",
      love:"静かな時間を尊重してくれる人。詰めすぎず待ってくれる相手。",
      job:"分析/研究/企画/エンジニア寄り。深掘りが強い。",
      media:"ドキュメンタリー、考察、長尺の解説。" },

    // --- 夜職・盛り界隈 6 ---
    {cat:"GLAM", name:"夜職女級プライドウーマン", badges:["夜職・盛り","自尊心MAX"], desc:"舐められたくない、雑に扱われたくないが強い。自分の価値を守るために言葉も行動も強くなれるタイプ。",
      love:"誠実で筋が通ってる人。駆け引きより“ちゃんと向き合う”相手。",
      job:"接客/販売/美容/ブランディング。自分を商品にするのが上手い。",
      media:"恋愛リアリティ/美容/垢抜け/ホスト密着（観察含む）。" },
    {cat:"GLAM", name:"カリスマホスト（営業脳）", badges:["夜職・盛り","外向寄り"], desc:"人の欲しい言葉・安心・テンションを読んで出せる。空気で勝てるタイプ。使い方次第で最強にも最悪にもなる。",
      love:"依存させるより、対等に笑える相手。自分も相手も壊さない距離感が鍵。",
      job:"営業/交渉/広報/司会。『相手に合わせて勝つ』のが得意。",
      media:"トーク番組、接客術、心理テク系（好き）。" },
    {cat:"GLAM", name:"整形マシーン（改善鬼）", badges:["夜職・盛り","改善癖"], desc:"コンプレックスを“行動”で潰すタイプ。努力の方向が明確で、変化が早い。",
      love:"努力をバカにしない人。見た目だけじゃなく中身も見てくれる相手が◎。",
      job:"美容/デザイン/編集/フィットネス。改善の積み上げが活きる。",
      media:"美容医療、検証、ビフォアフ、整う系。" },
    {cat:"GLAM", name:"ブランド脳（世界観）", badges:["夜職・盛り","こだわり"], desc:"“雰囲気・世界観”に価値を感じる。雑さが無理。美意識が強いぶん疲れやすい。",
      love:"丁寧で、嘘が少ない人。適当な扱いをしない相手。",
      job:"クリエイティブ/ディレクション/店舗作り。世界観づくりに向く。",
      media:"Vlog、ルーティン、ルームツアー、映像美。" },
    {cat:"GLAM", name:"盛り耐性ゼロ（正直者）", badges:["夜職・盛り","誠実"], desc:"盛る文化は好きだけど嘘は苦手。素直で不器用。『自分は自分』で勝ちたいタイプ。",
      love:"安心して素直でいられる相手。比較や評価を持ち込まない人。",
      job:"専門職/職人気質の仕事。正直さが信頼になる。",
      media:"手元作業、職人、料理、ゆるい日常。" },
    {cat:"GLAM", name:"ギャップ姫（内側堅実）", badges:["夜職・盛り","二面性"], desc:"外は派手でも中身は計画的。無駄に見える努力も裏で回してるタイプ。",
      love:"表面だけで判断しない人。内側の堅実さを見抜いてくれる相手。",
      job:"企画/運営/マネジメント。表と裏を両方回せる。",
      media:"バラエティ+学び系のハイブリッド。" },

    // --- 堅実ガチ勢界隈 6 ---
    {cat:"GACHI", name:"ガチ予定表マン", badges:["堅実ガチ勢","計画性"], desc:"締切・段取り・リスク回避が得意。『先に詰めて勝つ』タイプ。周りから頼られやすい。",
      love:"約束を守る人。誠実で生活が整ってる相手が相性◎。",
      job:"事務/PM/経理/運用。仕組み化が強い。",
      media:"勉強/解説/作業用BGM。効率厨。" },
    {cat:"GACHI", name:"ミス0教（再発防止）", badges:["堅実ガチ勢","慎重"], desc:"やらかしを“事件”として処理できる。原因分析→再発防止が自然に出る。",
      love:"安心感のある人。感情の波が少ない相手が向く。",
      job:"品質管理/保守/監査/医療事務寄り。ミス潰しが武器。",
      media:"検証、レビュー、比較動画。" },
    {cat:"GACHI", name:"コスパ神（最適化）", badges:["堅実ガチ勢","合理性"], desc:"損得と効率で判断しがち。感情より仕組みで勝つタイプ。無駄が嫌い。",
      love:"合理性を理解してくれる人。感情の説明を求めすぎない相手。",
      job:"データ/金融/購買/分析。比較して決めるのが得意。",
      media:"ビジネス、投資、節約、ガジェット。" },
    {cat:"GACHI", name:"責任感モンスター", badges:["堅実ガチ勢","背負う"], desc:"人が逃げる場面で逃げない。抱え込みやすいけど、チームにいると最強。",
      love:"『休んでいい』と言ってくれる人。背負いすぎを止めてくれる相手。",
      job:"リーダー職/現場管理/教育係。信頼で回す。",
      media:"スポーツ、挑戦ドキュメンタリー、努力系。" },
    {cat:"GACHI", name:"静かな努力家", badges:["堅実ガチ勢","内向寄り"], desc:"派手に言わずに淡々と積むタイプ。結果で黙らせる。メンタルは静かに強い。",
      love:"落ち着いてて、干渉しすぎない人。信頼で繋がれる相手。",
      job:"研究/技術/制作。黙々と強い。",
      media:"長尺、作業、解説、ドキュメンタリー。" },
    {cat:"GACHI", name:"逆転狙いの追い込み職人", badges:["堅実ガチ勢","土壇場強い"], desc:"普段はゆるいのに、締切前に覚醒するタイプ。短期集中の火力が高い。",
      love:"波を許してくれる人。責めずに見守ってくれる相手。",
      job:"締切がある制作/編集/ライティング。追い込み適性◎。",
      media:"短期集中系、受験/筋トレ企画、ストーリー性。" },

    // --- 恋愛脳界隈 6 ---
    {cat:"LOVE", name:"恋愛裁判官（白黒）", badges:["恋愛脳","筋通す"], desc:"曖昧が嫌い。言葉の責任・約束の重みが大きい。好きになると本気で向き合う。",
      love:"誠実で、話し合いができる人。逃げ癖がある人は相性悪め。",
      job:"交渉/法務寄り/相談業務。筋と整合性に強い。",
      media:"恋愛リアリティ、討論、心理解説。" },
    {cat:"LOVE", name:"重めの一途（積み上げ型）", badges:["恋愛脳","深い"], desc:"好きになると深い。雑に扱われると一気に冷める。信頼が恋愛の土台。",
      love:"言葉と行動が一致する人。浮つかない相手が◎。",
      job:"教育/ケア/対人支援。信頼の積み上げが得意。",
      media:"ストーリー重視の作品、恋愛ドラマ、長編。" },
    {cat:"LOVE", name:"好きバレ職人（匂わせ）", badges:["恋愛脳","表現"], desc:"直接言わずに空気で伝えがち。察して欲しい欲がある。上手くいくとロマン、ズレると事故。",
      love:"察し力高い人 or ちゃんと確認してくれる人。",
      job:"接客/広報/表現系。雰囲気づくりが上手い。",
      media:"恋愛系ショート、Vlog、共感系。" },
    {cat:"LOVE", name:"秒速切り替えマン", badges:["恋愛脳","回復早い"], desc:"失恋しても立ち直りが早い。反省はするけど引きずらない。恋愛を人生の一部として扱える。",
      love:"重くなりすぎない相手。テンポが合う人が◎。",
      job:"営業/企画/挑戦系。切替力が強い。",
      media:"バラエティ、旅行、企画ドッキリ。" },
    {cat:"LOVE", name:"安心供給装置", badges:["恋愛脳","共感"], desc:"相手の不安を減らすのが得意。優しいが、優しさが“義務”になると疲れる。",
      love:"感謝を言える人。甘えすぎない相手が◎。",
      job:"看護/福祉/カウンター業務/CS。安心を作る仕事。",
      media:"癒し、日常、料理、動物。" },
    {cat:"LOVE", name:"恋愛より自分軸", badges:["恋愛脳","自立"], desc:"恋愛は大事やけど、人生の主導権は自分に置く。依存が苦手。尊重がテーマ。",
      love:"自立してる人。束縛しない相手。",
      job:"個人で成果を出す仕事、クリエイティブ、専門職。",
      media:"自己成長、学び、ルーティン、作業。" },

    // --- 省エネ隠居界隈 6 ---
    {cat:"KAGE", name:"省エネ仙人", badges:["省エネ隠居","体力温存"], desc:"無駄な争いを避け、平和に生きるのが上手い。刺激より安定。心は穏やか。",
      love:"落ち着いてて、静かな時間を共有できる人。",
      job:"集中作業、裏方、制作、事務。静かに強い。",
      media:"ASMR、作業、散歩、落ち着くやつ。" },
    {cat:"KAGE", name:"人見知りのプロ", badges:["省エネ隠居","慎重"], desc:"最初は固いけど、信頼するとめっちゃ深い。少数精鋭で生きるタイプ。",
      love:"距離を詰めすぎない人。信頼構築ができる相手。",
      job:"研究/制作/職人。少人数で強い。",
      media:"考察、解説、淡々系。" },
    {cat:"KAGE", name:"メンタル防壁（ガード硬）", badges:["省エネ隠居","防御"], desc:"傷つくのが嫌で先に守る。悪く言うと壁、良く言うと自己管理。安全圏で強い。",
      love:"安心感くれる人。詰めずに理解してくれる相手。",
      job:"リスク低めの安定職、運用、保守。",
      media:"レビュー、比較、検証、静かなバラエティ。" },
    {cat:"KAGE", name:"空気読む観察者", badges:["省エネ隠居","察し"], desc:"喋らないけど見てる。人の変化に気づきやすい。沈黙が苦じゃないタイプ。",
      love:"沈黙を気まずくしない人。自然体の相手。",
      job:"調整役、サポート、裏方、編集。",
      media:"ドキュメンタリー、雰囲気Vlog、映画。" },
    {cat:"KAGE", name:"静かな反骨", badges:["省エネ隠居","芯"], desc:"表では波風立てないのに、内側は芯が強い。理不尽はちゃんと覚えてるタイプ。",
      love:"誠実で筋が通る人。尊重ができる相手。",
      job:"専門職、品質、改善、監査。",
      media:"社会系、考察、討論（見る専）。" },
    {cat:"KAGE", name:"気分の波サーファー", badges:["省エネ隠居","波"], desc:"気分と体力で出力が変わる。無理すると壊れるから、波を前提に設計すると強い。",
      love:"波を責めない人。休むのを許してくれる相手。",
      job:"自由度ある仕事、制作、編集、在宅寄り。",
      media:"短尺→長尺を気分で行き来。ゆるい企画。" },
  ];

  // ---- util ----
  const $ = (id)=>document.getElementById(id);

  function clamp(n,a,b){ return Math.max(a, Math.min(b,n)); }

  // ---- 軸スコア（E/C/A） + 界隈推定 ----
  function calcScores(){
    const sum = {E:0, C:0, A:0};
    const catScore = {SNS:0, GLAM:0, GACHI:0, LOVE:0, KAGE:0};

    (state.answers||[]).forEach((v,i)=>{
      const ax = Q[i] && Q[i].axes ? Q[i].axes : null;
      if(ax){
        Object.keys(ax).forEach(k=>{
          if(sum[k] != null) sum[k] += v * (ax[k]||1);
        });
      }

      // 質問文キーワードで界隈推定（雑だけど“当たりやすい”）
      const text = (Q[i] && Q[i].q) ? Q[i].q : "";
      if(/SNS|インスタ|裏垢|炎上|顔出し|フォロ|リプ|X|ツイ/i.test(text)) catScore.SNS += Math.abs(v)+1;
      if(/夜職|ホスト|整形|ブランド|盛り|美容|垢抜け/i.test(text)) catScore.GLAM += Math.abs(v)+1;
      if(/提出|締切|計画|予算|予約|テスト|単位|運用|最適|検証|ルール/i.test(text)) catScore.GACHI += Math.abs(v)+1;
      if(/恋人|好きな人|失恋|嫉妬|告白/i.test(text)) catScore.LOVE += Math.abs(v)+1;
      if(/疲|眠|不安|気まず|距離|黙|放置/i.test(text)) catScore.KAGE += Math.abs(v)+1;
    });

    // cat 決定
    let best = "SNS", bestV = -1;
    Object.keys(catScore).forEach(k=>{
      if(catScore[k] > bestV){ bestV = catScore[k]; best = k; }
    });

    return {sum, bestCat: best};
  }

  // ---- 6タイプの選び方：E/C/Aの符号と強さで決める ----
  function pickType(bestCat, sum){
    const pack = TYPES.filter(t=>t.cat===bestCat);
    // 0..5 に落とす：E/C/Aで“勢い・計画・共感”のどれが強いか
    const aE = Math.abs(sum.E), aC = Math.abs(sum.C), aA = Math.abs(sum.A);
    const maxAxis = (aE>=aC && aE>=aA) ? "E" : (aC>=aE && aC>=aA) ? "C" : "A";

    // “方向”で2択、強い軸で3択 → 合計6
    // dir: +なら攻め / -なら守り（ざっくり）
    const dir = (sum[maxAxis] >= 0) ? 0 : 1; // 0 or 1
    const which = (maxAxis==="E") ? 0 : (maxAxis==="C") ? 1 : 2; // 0..2
    const idx = dir*3 + which; // 0..5

    return pack[idx] || pack[0];
  }

  function renderBadges(bestCat, sum){
    const wrap = $("badges");
    if(!wrap) return;
    wrap.innerHTML = "";
    const catName = (CATS.find(c=>c.key===bestCat)||{name:bestCat}).name;

    const b1 = document.createElement("span"); b1.className="badge"; b1.textContent = "界隈: " + catName;
    const b2 = document.createElement("span"); b2.className="badge"; b2.textContent = `E(外向) ${sum.E>=0?"+":""}${sum.E}`;
    const b3 = document.createElement("span"); b3.className="badge"; b3.textContent = `C(計画) ${sum.C>=0?"+":""}${sum.C}`;
    const b4 = document.createElement("span"); b4.className="badge"; b4.textContent = `A(共感) ${sum.A>=0?"+":""}${sum.A}`;

    wrap.appendChild(b1); wrap.appendChild(b2); wrap.appendChild(b3); wrap.appendChild(b4);
  }

  function calcResult(){
    const {sum, bestCat} = calcScores();
    const t = pickType(bestCat, sum);

    $("resultTitle").textContent = t.name;
    $("desc").textContent  = t.desc;
    $("love").textContent  = t.love;
    $("job").textContent   = t.job;
    $("media").textContent = t.media;

    renderBadges(bestCat, sum);
  }

  // ✅ ここが“結果出ない”原因の修正ポイント：クリックは関数で包む
  const btn = $("toResultBtn");
  if(btn){
    btn.addEventListener("click", ()=>{
      state.finished = true;
      try{ saveState(state); }catch(e){}
      calcResult();
      showScreen("screenResult");
    });
  }

  // 既にfinishedなら復元して結果出す
  setTimeout(()=>{
    if(state && state.finished){
      calcResult();
      showScreen("screenResult");
    }
  }, 0);

  // windowに出しておく（デバッグ用）
  window.__EMBTI_PLUS_TYPES = TYPES;
})();
</script>
  
