<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>えむびーてぃーあいPlus | 究極保存版</title>
  <style>
    :root { --bg: #05070a; --accent-p: #ff7ca7; --accent-v: #bda6ff; --accent-b: #6ef2ff; --text: #ffffff; }
    * { box-sizing: border-box; }
    body { margin: 0; min-height: 100vh; font-family: "Hiragino Kaku Gothic ProN", sans-serif; background: var(--bg); color: var(--text); display: flex; justify-content: center; align-items: center; padding: 15px; }
    .container { max-width: 650px; width: 100%; transition: 0.5s; }
    .card { background: rgba(255,255,255,0.08); border-radius: 32px; padding: 30px; backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 25px 60px rgba(0,0,0,0.8); }
    .extreme-mode { background: #000 !important; border: 1px solid #ff4477 !important; animation: pulse 2s infinite; }
    @keyframes pulse { 0%, 100% { box-shadow: 0 0 10px #ff4477; } 50% { box-shadow: 0 0 30px #ff4477; } }
    .silence-sanctuary { background: #fff !important; color: #000 !important; border: none !important; }
    .silence-sanctuary .section { background: rgba(0,0,0,0.05) !important; color: #000 !important; }
    
    /* イラスト表示用のスタイル */
    .res-char-img { width: 100%; max-width: 300px; height: 300px; object-fit: cover; border-radius: 20px; border: 3px solid var(--accent-v); margin: 0 auto 20px; display: block; box-shadow: 0 0 20px rgba(189,166,255,0.4); }

    h1 { text-align: center; font-size: 1.8rem; background: linear-gradient(90deg, var(--accent-p), var(--accent-v)); -webkit-background-clip: text; color: transparent; margin-bottom: 20px; font-weight: 900; }
    .intro-text { font-size: 0.95rem; line-height: 1.8; color: #bbb; text-align: center; margin-bottom: 30px; }
    .progress-bar { height: 8px; background: rgba(255,255,255,0.1); border-radius: 4px; margin: 20px 0; overflow: hidden; }
    .progress-fill { height: 100%; background: linear-gradient(90deg, var(--accent-v), var(--accent-b)); width: 0%; transition: 0.4s; }
    .question-text { font-size: 1.2rem; font-weight: bold; line-height: 1.6; min-height: 90px; margin-bottom: 30px; text-align: center; }
    .choices { display: grid; gap: 14px; }
    button { padding: 18px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); color: #fff; font-size: 1rem; font-weight: bold; cursor: pointer; transition: 0.3s; }
    button:hover { background: rgba(255,255,255,0.15); transform: translateY(-2px); border-color: var(--accent-p); }
    .timer { font-size: 5rem; text-align: center; color: var(--accent-p); font-weight: 900; margin-bottom: 20px; font-family: monospace; }
    .res-area-name { font-size: 2.2rem; font-weight: 900; color: var(--accent-p); text-align:center; margin-bottom: 5px; }
    .res-type-name { font-size: 1.1rem; font-weight: bold; color: var(--accent-v); text-align:center; margin-bottom: 30px; }
    .section { background: rgba(255,255,255,0.04); border-radius: 24px; padding: 25px; margin-bottom: 20px; border-left: 6px solid var(--accent-v); }
    .section-title { font-weight: 900; font-size: 0.95rem; color: var(--accent-v); margin-bottom: 12px; }
    .essay-text { line-height: 1.9; font-size: 0.95rem; white-space: pre-wrap; }
    .final-box { background: #000; border: 3px solid var(--accent-p); padding: 30px; border-radius: 28px; margin-top: 30px; color: #fff; font-size: 1rem; line-height: 2; }
    .hide { display: none !important; }
    .sub-btn { flex: 1; padding: 12px; font-size: 0.8rem; background: transparent; border: 1px solid #444; color: #888; border-radius: 12px; }
    .highlight-box { background: #222; padding: 15px; border-radius: 10px; margin: 15px 0; border: 1px solid #444; color: #fff; }
  </style>
</head>
<body>

<div class="container">
  <div id="screen-intro" class="card">
    <h1>えむびーてぃーあいPlus</h1>
    <div class="intro-text">深層心理を暴き出す100問の問い。<br>具体的3択であなたの本質を可視化します。</div>
    <button style="width:100%; background:#fff; color:#000; font-size:1.2rem;" onclick="start(false)">診断開始</button>
  </div>

  <div id="screen-quiz" class="card hide">
    <div id="timer-ui" class="hide"><div id="timer-display" class="timer">45</div></div>
    <div id="q-label" style="font-size:0.8rem; font-weight:900; color:var(--accent-b);">Q.<span id="q-num">1</span> / 100</div>
    <div class="progress-bar"><div id="progress-fill" class="progress-fill"></div></div>
    <div id="question-text" class="question-text"></div>
    <div id="extra-info" class="hide">
      <div style="text-align:left; font-size:0.9rem; line-height:1.7; margin-bottom:20px;">
        <span style="color:var(--accent-p); font-weight:900; border-bottom:2px solid var(--accent-p);">【この問いの本質】</span><br>
        <div class="highlight-box">【あの人にとって、1億円とあなたの命、どちらに価値があると思っているのか】</div>
      </div>
    </div>
    <div id="choices" class="choices"></div>
    <div id="nav-btns" style="display:flex; gap:10px; margin-top:30px;"><button class="sub-btn" onclick="forceFinish()">中断して結果を見る</button></div>
  </div>

  <div id="screen-result" class="card hide">
    <img id="res-img" class="res-char-img" src="" alt="界隈キャラ">
    <div id="res-area" class="res-area-name"></div>
    <div id="res-type" class="res-type-name"></div>
    <div class="section"><div class="section-title">具体的思考分析</div><div id="res-essay" class="essay-text"></div></div>
    <div class="section"><div class="section-title">恋愛傾向とこれからの歩き方</div><div id="res-love" class="essay-text"></div></div>
    <div class="section"><div class="section-title">適職・非適職ナビ</div><div id="res-jobs" class="essay-text"></div></div>
    <div id="final-box" class="final-box"></div>
    <button style="width:100%; margin-top:40px; border-color:#444; color:#888;" onclick="location.reload()">トップへ戻る</button>
  </div>
</div>

<script>
// 質問データ（中略：以前の100問のロジックを保持）
const DB = []; 
const rawQ = [{cat:"SNS",q:"SNSの通知が気になる",c:["即見る","たまに見る","無視"]},{cat:"GLAM",q:"見た目は大事だ",c:["最優先","それなり","中身重視"]},{cat:"GACHI",q:"時間は守るべきだ",c:["絶対","なるべく","自由がいい"]},{cat:"LOVE",q:"束縛は愛だ",c:["嬉しい","少しなら","嫌だ"]},{cat:"KAGE",q:"一人が好きだ",c:["大好き","たまに一人","寂しがり"]}];
for(let i=0; i<99; i++) { DB.push(rawQ[i % rawQ.length]); }

const MASTER = {
  SNS: { 
    img: "https://r.jina.ai/i/87e8be2337d14d238f8f203874384b6f", // SNSウサギ(仮)
    area: "SNS・承認欲求界隈", names:["デジタル承認モンスター"],
    essay: "他人の瞳の中に自分を探しています...",
    love: "【傾向】承認が愛の基準。映えを気にしすぎ...",
    jobs: "【適】インフルエンサー 【非】事務職"
  },
  GLAM: { 
    img: "https://r.jina.ai/i/e00f12457c634c069b2d8f668749457c", // キャバ嬢キツネ(仮)
    area: "夜職・盛り・自己価値界隈", names:["プライド鬼高ウーマン"],
    essay: "「自分を高く売ること」が戦い方です...",
    love: "【傾向】スペック重視。鎧を脱ぐのが怖い...",
    jobs: "【適】夜職、美容営業 【非】公務員"
  },
  GACHI: { 
    img: "https://r.jina.ai/i/a12b3c4d5e6f7g8h9i0j", // 真面目フクロウ(仮イメージURL)
    area: "メガネ真面目くん界隈", names:["シゴデキ規律マン"],
    essay: "論理と正義で世界を測っています...",
    love: "【傾向】誠実ですが正論で詰めがち...",
    jobs: "【適】エンジニア 【非】芸術家"
  },
  LOVE: { 
    img: "https://r.jina.ai/i/k1l2m3n4o5p6q7r8s9t0", // 執着クマ(仮イメージURL)
    area: "恋愛至上主義界隈", names:["依存グラビティ"],
    essay: "愛することが人生の主軸です...",
    love: "【傾向】相手に染まりすぎる透明人間...",
    jobs: "【適】セラピスト 【非】投資家"
  },
  KAGE: { 
    img: "https://r.jina.ai/i/u1v2w3x4y5z6a7b8c9d0", // 孤高の黒猫(仮イメージURL)
    area: "自分を持ってるインキャラ界隈", names:["孤高の観測者"],
    essay: "静かなる美学と城を持っています...",
    love: "【傾向】領域を侵されるのを嫌う...",
    jobs: "【適】職人、研究職 【非】接客業"
  }
};

let state = { idx: 0, scores: {SNS:0, GLAM:0, GACHI:0, LOVE:0, KAGE:0}, history: [], ans: null, timerVal: 45 };

function start() { document.getElementById('screen-intro').classList.add('hide'); document.getElementById('screen-quiz').classList.remove('hide'); render(); }

function render() {
  const qText = document.getElementById('question-text');
  const choices = document.getElementById('choices');
  choices.innerHTML = "";
  if (state.idx < 99) {
    const q = DB[state.idx];
    qText.textContent = q.q;
    document.getElementById('q-num').textContent = state.idx + 1;
    q.c.forEach((txt, i) => {
      const btn = document.createElement('button'); btn.textContent = txt;
      btn.onclick = () => { state.scores[q.cat] += (i===0?1:(i===1?0:-1)); state.idx++; render(); };
      choices.appendChild(btn);
    });
  } else { renderFinalQuestion(); }
}

function renderFinalQuestion() {
  const card = document.getElementById('screen-quiz'); card.classList.add('extreme-mode');
  document.getElementById('timer-ui').classList.remove('hide'); document.getElementById('extra-info').classList.remove('hide');
  const qText = document.getElementById('question-text');
  qText.innerHTML = `究極の選択：あの人に1億円入る代わりに、あなたは消滅します。ボタンを渡せますか？`;
  const choices = document.getElementById('choices'); choices.innerHTML = "";
  [{t:"渡す",v:0},{t:"渡さない",v:1}].forEach(b=>{
    const btn = document.createElement('button'); btn.textContent = b.t;
    btn.onclick = () => { state.ans = b.v; showResult(); };
    choices.appendChild(btn);
  });
}

function showResult() {
  document.getElementById('screen-quiz').classList.add('hide');
  document.getElementById('screen-result').classList.remove('hide');
  const top = Object.keys(state.scores).reduce((a,b)=> state.scores[a] > state.scores[b]? a : b);
  const info = MASTER[top];

  // 【重要】ここでイラストを流し込んでいます
  document.getElementById('res-img').src = info.img;
  document.getElementById('res-area').textContent = info.area;
  document.getElementById('res-type').textContent = `タイプ：${info.names[0]}`;
  document.getElementById('res-essay').textContent = info.essay;
  document.getElementById('res-love').textContent = info.love;
  document.getElementById('res-jobs').textContent = info.jobs;

  // 100問回答時の結果テキスト（以前のコピペ内容を保持）
  let finalHTML = "";
  if(state.ans === 0) finalHTML = `ボタンを「渡す」：その「信用」は、ただの押し付けだ...`;
  else if(state.ans === 1) finalHTML = `ボタンを「渡さない」：あなたは、あの人を「見くびっている」...`;
  document.getElementById('final-box').innerHTML = finalHTML;
}

function forceFinish() { showResult(); }
</script>
</body>
</html>
